<!DOCTYPE html><html><head><meta charset="UTF-8"><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-bash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-http.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markup.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-none.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-ts.min.js"></script><style>
        .article {
            position: relative;
            padding-bottom: 24px;
        }
        

        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        

        .center-text {
            text-align: center;
        }
        

        .code-block {
            overflow: hidden;
            position: relative;
            padding: 0;
            border-radius: 8px;
            font-variant-ligatures: none;
            background-color: rgba(25, 25, 28, .05);
            word-break: break-all;
        }
        

        .container {
            max-width: 100%;
            overflow: hidden;
            page-break-inside: avoid;
            display: block;
        }
        

        .control {
            color: #19191c;
            font-size: 16px;
            font-weight: 670;
        }
        

        .detached {
            margin-block-start: 0;
            margin-block-end: 0;
            margin-bottom: 8px;
        }
        

        .image {
            max-width: 100%;
            max-height: 90vh;
            height: auto;
        }
        

        .image-container {
            max-width: 100vw;
        }
        

        .image-size {
            height: auto;
        }
        

        .inline-code {
            border-radius: 4px;
            display: inline;
            padding: 2px 1px;
            font-family: JetBrains Sans,monospace;
            background: #e6e6e6;
        }
        

        .list {
            list-style-type: disc;
            padding-left: 0;
            margin-left: 15px;
        }
        

        .list-decimal {
            list-style-type: decimal;
        }
        

        .list-item {
            margin-top: 6px;
            margin-bottom: 6px;
            margin-left: 4px;
        }
        

        .main-title {
            padding-bottom: 24px;
            margin-top: 0;
            font-size: 40px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        

        .prism {
            page-break-inside: avoid;
        }
        
        /* PrismJS 1.29.0
https://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript+abap+abnf+actionscript+ada+agda+al+antlr4+apacheconf+apex+apl+applescript+aql+arduino+arff+armasm+arturo+asciidoc+aspnet+asm6502+asmatmel+autohotkey+autoit+avisynth+avro-idl+awk+bash+basic+batch+bbcode+bbj+bicep+birb+bison+bnf+bqn+brainfuck+brightscript+bro+bsl+c+csharp+cpp+cfscript+chaiscript+cil+cilkc+cilkcpp+clojure+cmake+cobol+coffeescript+concurnas+csp+cooklang+coq+crystal+css-extras+csv+cue+cypher+d+dart+dataweave+dax+dhall+diff+django+dns-zone-file+docker+dot+ebnf+editorconfig+eiffel+ejs+elixir+elm+etlua+erb+erlang+excel-formula+fsharp+factor+false+firestore-security-rules+flow+fortran+ftl+gml+gap+gcode+gdscript+gedcom+gettext+gherkin+git+glsl+gn+linker-script+go+go-module+gradle+graphql+groovy+haml+handlebars+haskell+haxe+hcl+hlsl+hoon+http+hpkp+hsts+ichigojam+icon+icu-message-format+idris+ignore+inform7+ini+io+j+java+javadoc+javadoclike+javastacktrace+jexl+jolie+jq+jsdoc+js-extras+json+json5+jsonp+jsstacktrace+js-templates+julia+keepalived+keyman+kotlin+kumir+kusto+latex+latte+less+lilypond+liquid+lisp+livescript+llvm+log+lolcode+lua+magma+makefile+markdown+markup-templating+mata+matlab+maxscript+mel+mermaid+metafont+mizar+mongodb+monkey+moonscript+n1ql+n4js+nand2tetris-hdl+naniscript+nasm+neon+nevod+nginx+nim+nix+nsis+objectivec+ocaml+odin+opencl+openqasm+oz+parigp+parser+pascal+pascaligo+psl+pcaxis+peoplecode+perl+php+phpdoc+php-extras+plant-uml+plsql+powerquery+powershell+processing+prolog+promql+properties+protobuf+pug+puppet+pure+purebasic+purescript+python+qsharp+q+qml+qore+r+racket+cshtml+jsx+tsx+reason+regex+rego+renpy+rescript+rest+rip+roboconf+robotframework+ruby+rust+sas+sass+scss+scala+scheme+shell-session+smali+smalltalk+smarty+sml+solidity+solution-file+soy+sparql+splunk-spl+sqf+sql+squirrel+stan+stata+iecst+stylus+supercollider+swift+systemd+t4-templating+t4-cs+t4-vb+tap+tcl+tt2+textile+toml+tremor+turtle+twig+typescript+typoscript+unrealscript+uorazor+uri+v+vala+vbnet+velocity+verilog+vhdl+vim+visual-basic+warpscript+wasm+web-idl+wgsl+wiki+wolfram+wren+xeora+xml-doc+xojo+xquery+yaml+yang+zig&plugins=highlight-keywords */
code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:16px;margin:0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}

        

        :root {
            width: 95%;
            max-width: 95vw;
            padding: 0 0 0 30px;
        }
        
        body {
            font-family: JetBrains Sans,serif;
        }
        
        a {
            overflow-wrap: anywhere;
            width: 100vw;
        }
        
        
        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Light.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Light.woff) format("woff");
            font-weight: 300;
            font-style: normal;
        }

        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Regular.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Regular.woff) format("woff");
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-SemiBold.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-SemiBold.woff) format("woff");
            font-weight: 600;
            font-style: normal;
        }
        
        
        code {
            display: inline;
            word-break: break-word;
            font-size: 15px;
            line-height: inherit;
            font-variant-ligatures: none;
            font-family: JetBrains Sans,monospace;
            white-space: pre-line;
            overflow-wrap: break-word;
        }
        
        figcaption {
            margin-top: 5px;
        }
        
        h2 {
            padding-top: 16px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        h3 {
            padding-top: 8px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        h4 {
            padding-top: 4px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        p {
            padding: 0;
            border: 0;
            line-height: 25px;
            margin-block-start: 0;
            margin-block-end: 0;
            padding-bottom: 8px;
        }
        
        div {
            display: block;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            page-break-inside: avoid;
        }
        
        th, td {
            border: 1px solid #c4c4c4;
            padding: 10px;
            text-align: left;
            word-break: break-all;
        }
        
        .entry {
            display: grid;
            grid-template-columns: auto max-content;
            grid-template-areas: "chapter page";
            align-items: end;
            gap: 0 .25rem;
            line-height: 25px;
        }
        
        .toc-link-container{
            grid-area: chapter;
            position: relative;
            overflow: hidden;
        }
        
        .toc-link{
            text-decoration: none;
            color: black;
        }
        
        .toc-link-container::after {
            position: absolute;
            padding-left: .25ch;
            content: " . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
            ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
            ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ";
            text-align: right;
        }
        
        .page {
            grid-area: page;
            width: 30px;
            text-align: right;
        }
        

        .topic {
            page-break-before: always;
        }
        </style><title>pdfSourceIN</title></head><body><div><section class="topic"><div><article class="article"><h1 class="main-title">Table of contents</h1><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1897185137">Introduction</a></div><div class="page">2</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#2111190712">Getting Started</a></div><div class="page">4</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1027831262">App Object (Express Object)</a></div><div class="page">11</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-884366211">Request Object</a></div><div class="page">17</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1569161803">Response Object</a></div><div class="page">23</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1338146957">Routing (Express.Router())</a></div><div class="page">29</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#224957591">Serving static files &amp; Uploading files</a></div><div class="page">38</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#2110734593">Middlewares</a></div><div class="page">47</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#329692679">Schema Validation (Zod)</a></div><div class="page">57</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-407583414">JWT (Authentication &amp; Authorization)</a></div><div class="page">66</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-2125346110">Developing An API</a></div><div class="page">76</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1688204177">Sending Emails Programmatically</a></div><div class="page">105</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1923585412">Managing Cron Jobs and Background Services</a></div><div class="page">111</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1670429095">EJS Templating Engine</a></div><div class="page">119</div></div></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1897185137">Introduction</h1><div class="container"><figure class="image-container"><img class="center image image-size" id="-1897185137#iu8dci_3" alt="Expressts" title="Expressts" src="E:/curiculum/Express-Typescript-Docs/Writerside/images/expressts.png" width="1400" height="558"><figcaption class="center-text">Expressts</figcaption></figure></div><section><h2 id="-1897185137#express-js-typescript-documentation" data-toc="express-js-typescript-documentation#starter.md-express-js-typescript-documentation">Express.js + TypeScript Documentation</h2><section><h3 id="-1897185137#a-what-is-express-js" data-toc="a-what-is-express-js#starter.md-a-what-is-express-js">a. What is Express.js?</h3><p id="-1897185137#iu8dci_11">Express.js is a lightweight, unopinionated Node.js framework for building server-side applications. It abstracts away the complexity of setting up a server with HTTP, streamlining the process of handling routing, middleware, and HTTP requests.</p></section><section><h3 id="-1897185137#b-why-express-js-and-not-node-js" data-toc="b-why-express-js-and-not-node-js#starter.md-b-why-express-js-and-not-node-js">b. Why Express.js and not Node.js?</h3><p id="-1897185137#iu8dci_14">Node.js is a runtime that allows JavaScript to run on the server, but lacks built-in features for routing, request handling, and middleware. Express.js builds on Node.js, providing:</p><ul class="list" id="-1897185137#iu8dci_15" start="1"><li class="list-item" id="-1897185137#iu8dci_17"><p><span class="control" id="-1897185137#iu8dci_20">Simplicity</span>: Easy to use with minimal setup.</p></li><li class="list-item" id="-1897185137#iu8dci_18"><p><span class="control" id="-1897185137#iu8dci_21">Middleware support</span>: Enable adding custom logic to requests at various stages.</p></li><li class="list-item" id="-1897185137#iu8dci_19"><p><span class="control" id="-1897185137#iu8dci_22">Routing</span>: Simplified handling of HTTP requests like GET, POST, PUT, DELETE.</p></li></ul></section><section><h3 id="-1897185137#c-what-can-express-js-do" data-toc="c-what-can-express-js-do#starter.md-c-what-can-express-js-do">c. What Can Express.js Do?</h3><ul class="list" id="-1897185137#iu8dci_24" start="1"><li class="list-item" id="-1897185137#iu8dci_27"><p>Serve <span class="control" id="-1897185137#iu8dci_32">static files</span> like HTML, CSS, and images.</p></li><li class="list-item" id="-1897185137#iu8dci_28"><p>Build <span class="control" id="-1897185137#iu8dci_33">RESTful APIs</span>.</p></li><li class="list-item" id="-1897185137#iu8dci_29"><p>Handle <span class="control" id="-1897185137#iu8dci_34">middleware</span> for tasks like authentication, logging, and error handling.</p></li><li class="list-item" id="-1897185137#iu8dci_30"><p>Integrate with <span class="control" id="-1897185137#iu8dci_35">templating engines</span> (e.g., EJS, Pug) for dynamic web pages.</p></li><li class="list-item" id="-1897185137#iu8dci_31"><p>Support real-time applications with WebSockets or libraries like <span class="control" id="-1897185137#iu8dci_36">Socket.io</span>.</p></li></ul></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="2111190712">Getting Started</h1><section><h2 id="2111190712#a-create-an-express-app" data-toc="a-create-an-express-app#Getting-Started.md-a-create-an-express-app">a. Create an Express App</h2><ol class="list list-decimal" id="2111190712#-i3a88n_8" type="1" start="1"><li class="list-item" id="2111190712#-i3a88n_16"><p id="2111190712#-i3a88n_19"><span class="control" id="2111190712#-i3a88n_21">Initialize a Node project:</span></p><div class="detached code-block" id="2111190712#-i3a88n_20"><pre><code class="language-bash">npm init -y</code></pre></div></li><li class="list-item" id="2111190712#-i3a88n_17"><p id="2111190712#-i3a88n_22"><span class="control" id="2111190712#-i3a88n_24">Install Express and TypeScript:</span></p><div class="detached code-block" id="2111190712#-i3a88n_23"><pre><code class="language-bash">npm install express
npm install --save-dev typescript @types/express tsx</code></pre></div></li><li class="list-item" id="2111190712#-i3a88n_18"><p id="2111190712#-i3a88n_25"><span class="control" id="2111190712#-i3a88n_26">Set up TypeScript:</span> Create a <span class="inline-code" id="2111190712#-i3a88n_27">tsconfig.json</span>: and add</p></li></ol><div class="detached code-block" id="2111190712#-i3a88n_9"><pre><code class="language-json">{
   &quot;compilerOptions&quot;: {
      &quot;target&quot;: &quot;ESNext&quot;,   // Target ES6 or later to support modern JavaScript features
      &quot;module&quot;: &quot;Node16&quot;,    // Use node modules version 16
      &quot;rootDir&quot;: &quot;./src&quot;,       // Source files location
      &quot;outDir&quot;: &quot;./dist&quot;,          // Output directory for compiled files
      &quot;esModuleInterop&quot;: true,        // Enables support for `import` in CommonJS
      &quot;strict&quot;: true,                     // Enables strict type-checking options
      &quot;skipLibCheck&quot;: true,             // Skips type checking of declaration files
      &quot;moduleResolution&quot;: &quot;Node16&quot;,        // For resolving node modules
      &quot;resolveJsonModule&quot;: true,              // Enable importing `.json` files
      &quot;allowSyntheticDefaultImports&quot;: true,    // Allow default imports from modules
      &quot;forceConsistentCasingInFileNames&quot;: true   // Ensure consistent casing in file names
   },
   &quot;include&quot;: [&quot;src/**/*.ts&quot;],          // Include all TypeScript files in the `src` folder
   &quot;exclude&quot;: [&quot;node_modules&quot;]          // Exclude `node_modules`
}</code></pre></div><ol class="list list-decimal" id="2111190712#-i3a88n_10" type="1" start="4"><li class="list-item" id="2111190712#-i3a88n_28"><p id="2111190712#-i3a88n_31"><span class="control" id="2111190712#-i3a88n_33">Create a basic Express server:</span> In <span class="inline-code" id="2111190712#-i3a88n_34">src/server.ts</span>:</p><div class="detached code-block" id="2111190712#-i3a88n_32"><pre><code class="language-javascript">import express, { Request, Response } from 'express';

const app = express();
const port = 8000;

app.use(express.json()); // Middleware to parse JSON requests

app.get('/', (req: Request, res: Response) =&gt; {
  res.send('Hello, Express with TypeScript!');
});

app.listen(port, () =&gt; {
  console.log(`Server is running on http://localhost:${port}`);
});</code></pre></div></li><li class="list-item" id="2111190712#-i3a88n_29"><p id="2111190712#-i3a88n_35"><span class="control" id="2111190712#-i3a88n_37">Run the server:</span> Add this to <span class="inline-code" id="2111190712#-i3a88n_38">package.json</span> scripts:</p><div class="detached code-block" id="2111190712#-i3a88n_36"><pre><code class="language-json">&quot;scripts&quot;: {
  &quot;dev&quot;: &quot;tsx watch src/app.ts&quot;,
   &quot;start&quot;: &quot;node dist/index.js&quot;
}</code></pre></div></li><li class="list-item" id="2111190712#-i3a88n_30"><p id="2111190712#-i3a88n_39">Test the app, install the REST Client vs code extension. create <span class="inline-code" id="2111190712#-i3a88n_40">app.http</span> and add</p></li></ol><div class="detached code-block" id="2111190712#-i3a88n_11"><pre><code class="language-http">### HTTP/1.1

GET http://localhost:8000/</code></pre></div><p id="2111190712#-i3a88n_12">Start the server :</p><div class="detached code-block" id="2111190712#-i3a88n_13"><pre><code class="language-bash">npm start</code></pre></div></section><section><h2 id="2111190712#b-frameworks-built-on-express" data-toc="b-frameworks-built-on-express#Getting-Started.md-b-frameworks-built-on-express">b. Frameworks Built on Express</h2><p id="2111190712#-i3a88n_42">Several frameworks extend Express to provide additional features and structure:</p><ul class="list" id="2111190712#-i3a88n_43" start="1"><li class="list-item" id="2111190712#-i3a88n_46"><p id="2111190712#-i3a88n_49"><span class="control" id="2111190712#-i3a88n_50">NestJS</span>: A framework built with TypeScript, offering a modular architecture similar to Angular. It enhances Express with dependency injection, strong typing, and structured patterns for scalable applications.</p></li><li class="list-item" id="2111190712#-i3a88n_47"><p id="2111190712#-i3a88n_51"><span class="control" id="2111190712#-i3a88n_52">Loopback</span>: Extends Express to build APIs rapidly, with built-in connectors for databases, auto-generated REST APIs, and strong TypeScript support.</p></li><li class="list-item" id="2111190712#-i3a88n_48"><p id="2111190712#-i3a88n_53"><span class="control" id="2111190712#-i3a88n_54">Sails.js</span>: Another Express-based framework, which provides a MVC architecture and supports real-time features out of the box.</p></li></ul></section><section><h2 id="2111190712#c-proper-express-folder-structure-for-rest-api" data-toc="c-proper-express-folder-structure-for-rest-api#Getting-Started.md-c-proper-express-folder-structure-for-rest-api">c. Proper Express Folder Structure for REST API</h2><p id="2111190712#-i3a88n_56">A well-structured folder organization is essential for scalability and maintainability. Here is an ideal folder structure:</p><div class="detached code-block" id="2111190712#-i3a88n_57"><pre><code class="language-none">src/
  ├── controllers/        # Handles the business logic
  ├── routes/             # Defines routes for each resource
  ├── models/             # Database models or data definitions
  ├── services/           # Handles data processing and calls to external APIs
  ├── middleware/         # Custom middleware logic (auth, logging, etc.)
  ├── config/             # Environment variables, configuration settings
  ├── utils/              # Helper functions and utility classes
  ├── types/              # Custom TypeScript types/interfaces
  ├── app.ts              # Express application initialization
  └── server.ts           # Server startup file</code></pre></div></section><section><h2 id="2111190712#example-breakdown" data-toc="example-breakdown#Getting-Started.md-example-breakdown">Example Breakdown:</h2><section><h3 id="2111190712#i-model-routes-controllers" data-toc="i-model-routes-controllers#Getting-Started.md-i-model-routes-controllers">i. Model, Routes, Controllers</h3><ol class="list list-decimal" id="2111190712#-i3a88n_62" type="1" start="1"><li class="list-item" id="2111190712#-i3a88n_74"><p><span class="control" id="2111190712#-i3a88n_75">Models</span>: Defines the structure of your database schema or data interfaces.</p></li></ol><div class="detached code-block" id="2111190712#-i3a88n_63"><pre><code class="language-javascript">// src/models/User.ts
export interface User {
  id: string;
  name: string;
  email: string;
}</code></pre></div><ol class="list list-decimal" id="2111190712#-i3a88n_64" type="1" start="2"><li class="list-item" id="2111190712#-i3a88n_76"><p><span class="control" id="2111190712#-i3a88n_77">Controllers</span>: Implements the core business logic, processing requests and sending appropriate responses.</p></li></ol><div class="detached code-block" id="2111190712#-i3a88n_65"><pre><code class="language-javascript">// src/controllers/userController.ts
import { Request, Response } from 'express';

export const getUsers = (req: Request, res: Response): void =&gt; {
  const users = [{ id: '1', name: 'John Doe', email: 'john@example.com' }];
  res.json(users);
};</code></pre></div><ol class="list list-decimal" id="2111190712#-i3a88n_66" type="1" start="3"><li class="list-item" id="2111190712#-i3a88n_78"><p><span class="control" id="2111190712#-i3a88n_79">Routes</span>: Maps routes to corresponding controllers.</p></li></ol><div class="detached code-block" id="2111190712#-i3a88n_67"><pre><code class="language-javascript">// src/routes/userRoutes.ts
import express from 'express';
import { getUsers } from '../controllers/userController';

const router = express.Router();

router.get('/users', getUsers);

export default router;</code></pre></div><ol class="list list-decimal" id="2111190712#-i3a88n_68" type="1" start="4"><li class="list-item" id="2111190712#-i3a88n_80"><p><span class="control" id="2111190712#-i3a88n_81">Middleware</span>: Add custom logic between request and response.</p></li></ol><div class="detached code-block" id="2111190712#-i3a88n_69"><pre><code class="language-javascript">// src/middleware/authMiddleware.ts
import { Request, Response, NextFunction } from 'express';

export const authMiddleware = (req: Request, res: Response, next: NextFunction) =&gt; {
  const authToken = req.headers['authorization'];

  if (authToken) {
    // Do some token verification here
    next(); // Proceed to the next middleware/controller
  } else {
    res.status(401).json({ message: 'Unauthorized' });
  }
};</code></pre></div><ol class="list list-decimal" id="2111190712#-i3a88n_70" type="1" start="5"><li class="list-item" id="2111190712#-i3a88n_82"><p><span class="control" id="2111190712#-i3a88n_83">Server and App Initialization:</span></p></li></ol><div class="detached code-block" id="2111190712#-i3a88n_71"><pre><code class="language-javascript">// src/app.ts
import express from 'express';
import userRoutes from './routes/userRoutes';

const app = express();
app.use(express.json());

app.use('/api', userRoutes);

export default app;

// src/server.ts
import app from './app';

const PORT = process.env.PORT || 3000;

app.listen(PORT, () =&gt; {
  console.log(`Server running on http://localhost:${PORT}`);
});</code></pre></div></section><section><h3 id="2111190712#ii-model-routes-controllers-services" data-toc="ii-model-routes-controllers-services#Getting-Started.md-ii-model-routes-controllers-services">ii. Model, Routes, Controllers, Services</h3><ol class="list list-decimal" id="2111190712#-i3a88n_85" type="1" start="1"><li class="list-item" id="2111190712#-i3a88n_91"><p><span class="control" id="2111190712#-i3a88n_92">Services</span>: Contains logic for database operations, external API calls, or complex data manipulation. Services abstract the business logic and keep the controller lean.</p></li></ol><div class="detached code-block" id="2111190712#-i3a88n_86"><pre><code class="language-javascript">// src/services/userService.ts
import { User } from '../models/User';

export const getAllUsers = async (): Promise&lt;User[]&gt; =&gt; {
  // Simulate fetching data from a database
  return [{ id: '1', name: 'John Doe', email: 'john@example.com' }];
};</code></pre></div><ol class="list list-decimal" id="2111190712#-i3a88n_87" type="1" start="2"><li class="list-item" id="2111190712#-i3a88n_93"><p><span class="control" id="2111190712#-i3a88n_94">Controller using a Service</span>:</p></li></ol><div class="detached code-block" id="2111190712#-i3a88n_88"><pre><code class="language-javascript">// src/controllers/userController.ts
import { Request, Response } from 'express';
import { getAllUsers } from '../services/userService';

export const getUsers = async (req: Request, res: Response) =&gt; {
  try {
    const users = await getAllUsers();
    res.status(200).json(users);
  } catch (error) {
    res.status(500).json({ message: 'Internal Server Error' });
  }
};</code></pre></div></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1027831262">App Object (Express Object)</h1><p id="1027831262#dghhwj_3">The <span class="inline-code" id="1027831262#dghhwj_11">app</span> object in Express represents the core of your Express application. It is an instance of the <span class="inline-code" id="1027831262#dghhwj_12">express()</span> function, and it provides methods to define routes, middleware, and configure various settings for your web application or API.</p><section><h2 id="1027831262#basic-express-application-setup" data-toc="basic-express-application-setup#App-Object-Express-Object.md-basic-express-application-setup">Basic Express Application Setup</h2><p id="1027831262#dghhwj_13">Before diving into the specific methods, here&rsquo;s a simple example of how to initialize the <span class="inline-code" id="1027831262#dghhwj_17">app</span> object.</p><div class="detached code-block" id="1027831262#dghhwj_14"><pre><code class="language-javascript">import express from 'express';

const app = express();
const port = 3000;

app.listen(port, () =&gt; {
  console.log(`Server is running on http://localhost:${port}`);
});</code></pre></div><p id="1027831262#dghhwj_15">The <span class="inline-code" id="1027831262#dghhwj_18">app</span> object provides several HTTP methods that map to HTTP request verbs (<span class="inline-code" id="1027831262#dghhwj_19">GET</span>, <span class="inline-code" id="1027831262#dghhwj_20">POST</span>, <span class="inline-code" id="1027831262#dghhwj_21">PUT</span>, <span class="inline-code" id="1027831262#dghhwj_22">DELETE</span>, <span class="inline-code" id="1027831262#dghhwj_23">PATCH</span>, etc.). Additionally, <span class="inline-code" id="1027831262#dghhwj_24">app.use()</span> allows you to mount middleware and handle requests before they reach the route handler.</p></section><section><h2 id="1027831262#a-app-get" data-toc="a-app-get#App-Object-Express-Object.md-a-app-get">a. app.get()</h2><p id="1027831262#dghhwj_26"><span class="inline-code" id="1027831262#dghhwj_33">app.get()</span> handles HTTP <span class="control" id="1027831262#dghhwj_34">GET</span> requests to a specific route. This is typically used to retrieve or read data from the server.</p><div class="detached code-block" id="1027831262#dghhwj_27"><pre><code class="language-javascript">app.get('/users', (req, res) =&gt; {
  res.json([{ id: 1, name: 'John Doe' }]);
});</code></pre></div><section><h3 id="1027831262#parameters" data-toc="parameters#App-Object-Express-Object.md-parameters">Parameters:</h3><ul class="list" id="1027831262#dghhwj_35" start="1"><li class="list-item" id="1027831262#dghhwj_36"><p><span class="control" id="1027831262#dghhwj_38">Path (string)</span>: The URL or endpoint you want to handle (e.g., <span class="inline-code" id="1027831262#dghhwj_39">/users</span>).</p></li><li class="list-item" id="1027831262#dghhwj_37"><p><span class="control" id="1027831262#dghhwj_40">Callback Function (middleware)</span>: A function that receives the <span class="inline-code" id="1027831262#dghhwj_41">Request</span> and <span class="inline-code" id="1027831262#dghhwj_42">Response</span> objects. It contains logic to process the request and return the response.</p></li></ul></section><section><h3 id="1027831262#example-with-route-parameters" data-toc="example-with-route-parameters#App-Object-Express-Object.md-example-with-route-parameters">Example with Route Parameters:</h3><div class="detached code-block" id="1027831262#dghhwj_43"><pre><code class="language-javascript">app.get('/users/:id', (req, res) =&gt; {
  const userId = req.params.id;
  res.json({ id: userId, name: 'John Doe' });
});</code></pre></div></section><section><h3 id="1027831262#example-with-query-parameters" data-toc="example-with-query-parameters#App-Object-Express-Object.md-example-with-query-parameters">Example with Query Parameters:</h3><div class="detached code-block" id="1027831262#dghhwj_44"><pre><code class="language-javascript">app.get('/search', (req, res) =&gt; {
  const query = req.query.q; // Example: /search?q=express
  res.json({ message: `Searching for ${query}` });
});</code></pre></div></section></section><section><h2 id="1027831262#b-app-post" data-toc="b-app-post#App-Object-Express-Object.md-b-app-post">b. app.post()</h2><p id="1027831262#dghhwj_47"><span class="inline-code" id="1027831262#dghhwj_53">app.post()</span> handles HTTP <span class="control" id="1027831262#dghhwj_54">POST</span> requests. It is commonly used to send data to the server, typically for creating new resources (e.g., user registration, creating a blog post).</p><div class="detached code-block" id="1027831262#dghhwj_48"><pre><code class="language-javascript">app.post('/users', (req, res) =&gt; {
  const { name, email } = req.body; // Assuming body-parser middleware is used
  res.status(201).json({ id: 1, name, email });
});</code></pre></div><section><h3 id="1027831262#parameters" data-toc="parameters#App-Object-Express-Object.md-parameters">Parameters:</h3><ul class="list" id="1027831262#dghhwj_55" start="1"><li class="list-item" id="1027831262#dghhwj_56"><p><span class="control" id="1027831262#dghhwj_58">Path (string)</span>: The URL or endpoint you want to handle (e.g., <span class="inline-code" id="1027831262#dghhwj_59">/users</span>).</p></li><li class="list-item" id="1027831262#dghhwj_57"><p><span class="control" id="1027831262#dghhwj_60">Callback Function</span>: Receives the <span class="inline-code" id="1027831262#dghhwj_61">Request</span> and <span class="inline-code" id="1027831262#dghhwj_62">Response</span> objects. The <span class="inline-code" id="1027831262#dghhwj_63">req.body</span> contains data sent from the client (usually in JSON format).</p></li></ul></section><section><h3 id="1027831262#example-posting-form-data" data-toc="example-posting-form-data#App-Object-Express-Object.md-example-posting-form-data">Example: Posting Form Data</h3><div class="detached code-block" id="1027831262#dghhwj_64"><pre><code class="language-javascript">app.use(express.json()); // Parse incoming JSON data
app.use(express.urlencoded({ extended: true })); // Parse URL-encoded data

app.post('/users', (req, res) =&gt; {
  const { username, password } = req.body;
  res.status(201).json({ message: 'User created', username });
});</code></pre></div></section></section><section><h2 id="1027831262#c-app-put" data-toc="c-app-put#App-Object-Express-Object.md-c-app-put">c. app.put()</h2><p id="1027831262#dghhwj_67"><span class="inline-code" id="1027831262#dghhwj_73">app.put()</span> handles HTTP <span class="control" id="1027831262#dghhwj_74">PUT</span> requests. This is used to update a resource completely (replacing it with the new data). The client typically sends the full resource, and the server updates the record.</p><div class="detached code-block" id="1027831262#dghhwj_68"><pre><code class="language-javascript">app.put('/users/:id', (req, res) =&gt; {
  const userId = req.params.id;
  const { name, email } = req.body;
  // Update the user in the database here
  res.json({ message: `User ${userId} updated`, name, email });
});</code></pre></div><section><h3 id="1027831262#parameters" data-toc="parameters#App-Object-Express-Object.md-parameters">Parameters:</h3><ul class="list" id="1027831262#dghhwj_75" start="1"><li class="list-item" id="1027831262#dghhwj_76"><p><span class="control" id="1027831262#dghhwj_78">Path (string)</span>: The URL or endpoint, often with a dynamic parameter (e.g., <span class="inline-code" id="1027831262#dghhwj_79">/users/:id</span>).</p></li><li class="list-item" id="1027831262#dghhwj_77"><p><span class="control" id="1027831262#dghhwj_80">Callback Function</span>: <span class="inline-code" id="1027831262#dghhwj_81">req.body</span> contains the updated data sent by the client.</p></li></ul></section><section><h3 id="1027831262#example-full-update" data-toc="example-full-update#App-Object-Express-Object.md-example-full-update">Example: Full Update</h3><div class="detached code-block" id="1027831262#dghhwj_82"><pre><code class="language-javascript">app.put('/articles/:id', (req, res) =&gt; {
  const articleId = req.params.id;
  const { title, content } = req.body;
  // Replace the old article with the new one
  res.json({ message: `Article ${articleId} updated`, title, content });
});</code></pre></div></section></section><section><h2 id="1027831262#d-app-delete" data-toc="d-app-delete#App-Object-Express-Object.md-d-app-delete">d. app.delete()</h2><p id="1027831262#dghhwj_85"><span class="inline-code" id="1027831262#dghhwj_91">app.delete()</span> handles HTTP <span class="control" id="1027831262#dghhwj_92">DELETE</span> requests, used to delete a resource on the server.</p><div class="detached code-block" id="1027831262#dghhwj_86"><pre><code class="language-javascript">app.delete('/users/:id', (req, res) =&gt; {
  const userId = req.params.id;
  // Remove the user from the database here
  res.status(204).json({ message: `User ${userId} deleted` });
});</code></pre></div><section><h3 id="1027831262#parameters" data-toc="parameters#App-Object-Express-Object.md-parameters">Parameters:</h3><ul class="list" id="1027831262#dghhwj_93" start="1"><li class="list-item" id="1027831262#dghhwj_94"><p><span class="control" id="1027831262#dghhwj_96">Path (string)</span>: The URL or endpoint, often with a dynamic parameter (e.g., <span class="inline-code" id="1027831262#dghhwj_97">/users/:id</span>).</p></li><li class="list-item" id="1027831262#dghhwj_95"><p><span class="control" id="1027831262#dghhwj_98">Callback Function</span>: The request usually only contains the ID of the resource to delete.</p></li></ul></section><section><h3 id="1027831262#example-delete-request-with-confirmation" data-toc="example-delete-request-with-confirmation#App-Object-Express-Object.md-example-delete-request-with-confirmation">Example: Delete Request with Confirmation</h3><div class="detached code-block" id="1027831262#dghhwj_99"><pre><code class="language-javascript">app.delete('/posts/:id', (req, res) =&gt; {
  const postId = req.params.id;
  // Logic to delete post by postId
  res.status(200).json({ message: `Post ${postId} deleted` });
});</code></pre></div></section></section><section><h2 id="1027831262#e-app-patch" data-toc="e-app-patch#App-Object-Express-Object.md-e-app-patch">e. app.patch()</h2><p id="1027831262#dghhwj_102"><span class="inline-code" id="1027831262#dghhwj_108">app.patch()</span> handles HTTP <span class="control" id="1027831262#dghhwj_109">PATCH</span> requests, used to update part of a resource (as opposed to <span class="inline-code" id="1027831262#dghhwj_110">PUT</span>, which replaces the entire resource).</p><div class="detached code-block" id="1027831262#dghhwj_103"><pre><code class="language-javascript">app.patch('/users/:id', (req, res) =&gt; {
  const userId = req.params.id;
  const { email } = req.body; // Assume we're only updating the email
  // Update the user's email in the database here
  res.json({ message: `User ${userId} email updated`, email });
});</code></pre></div><section><h3 id="1027831262#parameters" data-toc="parameters#App-Object-Express-Object.md-parameters">Parameters:</h3><ul class="list" id="1027831262#dghhwj_111" start="1"><li class="list-item" id="1027831262#dghhwj_112"><p><span class="control" id="1027831262#dghhwj_114">Path (string)</span>: The URL or endpoint, often with a dynamic parameter (e.g., <span class="inline-code" id="1027831262#dghhwj_115">/users/:id</span>).</p></li><li class="list-item" id="1027831262#dghhwj_113"><p><span class="control" id="1027831262#dghhwj_116">Callback Function</span>: Receives the partial update data in <span class="inline-code" id="1027831262#dghhwj_117">req.body</span>.</p></li></ul></section><section><h3 id="1027831262#example-partial-update" data-toc="example-partial-update#App-Object-Express-Object.md-example-partial-update">Example: Partial Update</h3><div class="detached code-block" id="1027831262#dghhwj_118"><pre><code class="language-javascript">app.patch('/profiles/:id', (req, res) =&gt; {
  const profileId = req.params.id;
  const updates = req.body; // Partial updates like { age: 30 }
  // Apply updates to the profile in the database
  res.json({ message: `Profile ${profileId} updated`, updates });
});</code></pre></div></section></section><section><h2 id="1027831262#f-app-use" data-toc="f-app-use#App-Object-Express-Object.md-f-app-use">f. app.use()</h2><p id="1027831262#dghhwj_121"><span class="inline-code" id="1027831262#dghhwj_128">app.use()</span> mounts middleware functions, which are functions that execute during the request-response cycle. Middleware can modify the <span class="inline-code" id="1027831262#dghhwj_129">Request</span> and <span class="inline-code" id="1027831262#dghhwj_130">Response</span> objects or terminate the request-response cycle.</p><section><h3 id="1027831262#middleware-example-global-middleware" data-toc="middleware-example-global-middleware#App-Object-Express-Object.md-middleware-example-global-middleware">Middleware Example: Global Middleware</h3><div class="detached code-block" id="1027831262#dghhwj_131"><pre><code class="language-javascript">app.use((req, res, next) =&gt; {
  console.log(`${req.method} request made to ${req.url}`);
  next(); // Pass control to the next middleware or route handler
});</code></pre></div></section><section><h3 id="1027831262#middleware-example-applying-to-a-specific-route" data-toc="middleware-example-applying-to-a-specific-route#App-Object-Express-Object.md-middleware-example-applying-to-a-specific-route">Middleware Example: Applying to a Specific Route</h3><p id="1027831262#dghhwj_132">You can apply middleware to specific routes or route groups by passing a path as the first argument to <span class="inline-code" id="1027831262#dghhwj_134">app.use()</span>.</p><div class="detached code-block" id="1027831262#dghhwj_133"><pre><code class="language-javascript">const authMiddleware = (req, res, next) =&gt; {
  const token = req.headers['authorization'];
  if (!token) return res.status(401).json({ message: 'Unauthorized' });
  // Verify token here (e.g., JWT verification)
  next();
};

app.use('/api/protected', authMiddleware, (req, res) =&gt; {
  res.json({ message: 'You have access to the protected route' });
});</code></pre></div></section><section><h3 id="1027831262#example-using-built-in-middleware" data-toc="example-using-built-in-middleware#App-Object-Express-Object.md-example-using-built-in-middleware">Example: Using Built-in Middleware</h3><p id="1027831262#dghhwj_135">Express provides built-in middleware to handle common tasks like parsing JSON and serving static files.</p><div class="detached code-block" id="1027831262#dghhwj_136"><pre><code class="language-javascript">// Built-in middleware to serve static files (HTML, CSS, images)
app.use(express.static('public'));

// Built-in middleware to parse incoming JSON data
app.use(express.json());

// Built-in middleware to parse URL-encoded data (from HTML forms)
app.use(express.urlencoded({ extended: true }));</code></pre></div></section><section><h3 id="1027831262#example-third-party-middleware" data-toc="example-third-party-middleware#App-Object-Express-Object.md-example-third-party-middleware">Example: Third-Party Middleware</h3><p id="1027831262#dghhwj_137">You can also use third-party middleware, such as <span class="inline-code" id="1027831262#dghhwj_140">morgan</span> for logging or <span class="inline-code" id="1027831262#dghhwj_141">cors</span> for Cross-Origin Resource Sharing.</p><div class="detached code-block" id="1027831262#dghhwj_138"><pre><code class="language-javascript">import cors from 'cors';
import morgan from 'morgan';

// Use morgan for logging requests
app.use(morgan('dev'));

// Enable CORS for all routes
app.use(cors());</code></pre></div></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-884366211">Request Object</h1><div class="container"><figure class="image-container"><img class="center image image-size" id="-884366211#-mu709g_3" alt="Requestobj" title="Requestobj" src="E:/curiculum/Express-Typescript-Docs/Writerside/images/requestobj.png" width="1583" height="692"><figcaption class="center-text">Requestobj</figcaption></figure></div><p id="-884366211#-mu709g_4">The Request object (<span class="inline-code" id="-884366211#-mu709g_12">req</span>) in Express represents the HTTP request and provides information about the request made to the server. It contains properties and methods to handle data such as query parameters, route parameters, headers, the request body, and much more.</p><section><h2 id="-884366211#a-what-is-response-object" data-toc="a-what-is-response-object#Request-Object.md-a-what-is-response-object">a. What is Response Object?</h2><p id="-884366211#-mu709g_14">While the Request object represents the incoming HTTP request, the <span class="control" id="-884366211#-mu709g_18">Response object (<span class="inline-code" id="-884366211#-mu709g_19">res</span>)</span> represents the HTTP response that an Express app sends when it gets an incoming request. It is used to send data back to the client (e.g., JSON, HTML, status codes, etc.).</p><p id="-884366211#-mu709g_15">Example:</p><div class="detached code-block" id="-884366211#-mu709g_16"><pre><code class="language-javascript">app.get('/example', (req, res) =&gt; {
  res.status(200).json({ message: 'Hello, world!' });
});</code></pre></div></section><section><h2 id="-884366211#b-request-object-methods" data-toc="b-request-object-methods#Request-Object.md-b-request-object-methods">b. Request Object Methods</h2><p id="-884366211#-mu709g_21">The Request object provides several methods and properties for handling client requests. Below are some important ones:</p><ul class="list" id="-884366211#-mu709g_22" start="1"><li class="list-item" id="-884366211#-mu709g_25"><p><span class="control" id="-884366211#-mu709g_31"><span class="inline-code" id="-884366211#-mu709g_33">req.query</span></span>: Access query parameters (e.g., <span class="inline-code" id="-884366211#-mu709g_32">/users?name=John</span>).</p></li><li class="list-item" id="-884366211#-mu709g_26"><p><span class="control" id="-884366211#-mu709g_34"><span class="inline-code" id="-884366211#-mu709g_36">req.params</span></span>: Access route parameters (e.g., <span class="inline-code" id="-884366211#-mu709g_35">/users/:id</span>).</p></li><li class="list-item" id="-884366211#-mu709g_27"><p><span class="control" id="-884366211#-mu709g_37"><span class="inline-code" id="-884366211#-mu709g_38">req.body</span></span>: Access the request body, commonly used in POST and PUT requests.</p></li><li class="list-item" id="-884366211#-mu709g_28"><p><span class="control" id="-884366211#-mu709g_39"><span class="inline-code" id="-884366211#-mu709g_40">req.headers</span></span>: Access headers sent by the client.</p></li><li class="list-item" id="-884366211#-mu709g_29"><p><span class="control" id="-884366211#-mu709g_41"><span class="inline-code" id="-884366211#-mu709g_42">req.method</span></span>: Get the HTTP method used in the request (GET, POST, etc.).</p></li><li class="list-item" id="-884366211#-mu709g_30"><p><span class="control" id="-884366211#-mu709g_43"><span class="inline-code" id="-884366211#-mu709g_44">req.url</span></span>: The full URL requested.</p></li></ul></section><section><h2 id="-884366211#i-query-parameters-req-query" data-toc="i-query-parameters-req-query#Request-Object.md-i-query-parameters-req-query">i. Query Parameters (req.query)</h2><p id="-884366211#-mu709g_46">Query parameters are typically used to pass optional data to the server in the URL, usually for filtering, sorting, limiting, or pagination. They are appended to the URL after a <span class="inline-code" id="-884366211#-mu709g_51">?</span> symbol.</p><section><h3 id="-884366211#accessing-query-parameters" data-toc="accessing-query-parameters#Request-Object.md-accessing-query-parameters">Accessing Query Parameters:</h3><div class="detached code-block" id="-884366211#-mu709g_52"><pre><code class="language-javascript">app.get('/users', (req, res) =&gt; {
  const { name, age } = req.query;
  res.json({ name, age });
});</code></pre></div></section><section><h3 id="-884366211#example-url" data-toc="example-url#Request-Object.md-example-url">Example URL:</h3><div class="detached code-block" id="-884366211#-mu709g_53"><pre><code class="language-none">/users?name=John&amp;age=25</code></pre></div><p id="-884366211#-mu709g_54">The above URL would populate <span class="inline-code" id="-884366211#-mu709g_57">req.query</span> as:</p><div class="detached code-block" id="-884366211#-mu709g_55"><pre><code class="language-json">{
  &quot;name&quot;: &quot;John&quot;,
  &quot;age&quot;: &quot;25&quot;
}</code></pre></div></section></section><section><h2 id="-884366211#ii-operations-which-require-query-params" data-toc="ii-operations-which-require-query-params#Request-Object.md-ii-operations-which-require-query-params">ii. Operations which Require Query Params</h2><section><h3 id="-884366211#a-filtering" data-toc="a-filtering#Request-Object.md-a-filtering">a. Filtering</h3><p id="-884366211#-mu709g_64">Filtering allows clients to retrieve specific data based on certain conditions. You can use query parameters to filter results.</p><p id="-884366211#-mu709g_65">Example:</p><div class="detached code-block" id="-884366211#-mu709g_66"><pre><code class="language-javascript">app.get('/products', (req, res) =&gt; {
  const { category } = req.query;
  // Logic to filter products based on category
  res.json({ message: `Filtered products by category: ${category}` });
});</code></pre></div></section><section><h3 id="-884366211#b-sorting" data-toc="b-sorting#Request-Object.md-b-sorting">b. Sorting</h3><p id="-884366211#-mu709g_67">Sorting allows clients to receive data in a specific order (e.g., ascending or descending based on a field).</p><p id="-884366211#-mu709g_68">Example:</p><div class="detached code-block" id="-884366211#-mu709g_69"><pre><code class="language-javascript">app.get('/products', (req, res) =&gt; {
  const { sortBy, order } = req.query;
  // Logic to sort products based on sortBy field and order ('asc' or 'desc')
  res.json({ message: `Sorted by ${sortBy} in ${order} order` });
});</code></pre></div><p id="-884366211#-mu709g_70">Example URL:</p><div class="detached code-block" id="-884366211#-mu709g_71"><pre><code class="language-none">/products?sortBy=price&amp;order=asc</code></pre></div></section><section><h3 id="-884366211#c-limiting" data-toc="c-limiting#Request-Object.md-c-limiting">c. Limiting</h3><p id="-884366211#-mu709g_72">Limiting allows you to control how many results are returned from a query. This is especially useful for large datasets.</p><p id="-884366211#-mu709g_73">Example:</p><div class="detached code-block" id="-884366211#-mu709g_74"><pre><code class="language-javascript">app.get('/products', (req, res) =&gt; {
  const { limit } = req.query;
  // Logic to limit the number of products returned
  res.json({ message: `Limited to ${limit} products` });
});</code></pre></div><p id="-884366211#-mu709g_75">Example URL:</p><div class="detached code-block" id="-884366211#-mu709g_76"><pre><code class="language-none">/products?limit=10</code></pre></div></section><section><h3 id="-884366211#d-pagination" data-toc="d-pagination#Request-Object.md-d-pagination">d. Pagination</h3><p id="-884366211#-mu709g_77">Pagination allows you to break large datasets into smaller chunks and fetch data page by page.</p><p id="-884366211#-mu709g_78">Example:</p><div class="detached code-block" id="-884366211#-mu709g_79"><pre><code class="language-javascript">app.get('/products', (req, res) =&gt; {
  const { page, pageSize } = req.query;
  const offset = (parseInt(page as string) - 1) * parseInt(pageSize as string);
  // Logic to return paginated results
  res.json({ message: `Page: ${page}, Page Size: ${pageSize}`, offset });
});</code></pre></div><p id="-884366211#-mu709g_80">Example URL:</p><div class="detached code-block" id="-884366211#-mu709g_81"><pre><code class="language-none">/products?page=2&amp;pageSize=10</code></pre></div></section></section><section><h2 id="-884366211#ii-route-parameters-req-params" data-toc="ii-route-parameters-req-params#Request-Object.md-ii-route-parameters-req-params">ii. Route Parameters (req.params)</h2><p id="-884366211#-mu709g_84">Route parameters are named URL segments that act as placeholders for data. They are defined in the route path with a colon (<span class="inline-code" id="-884366211#-mu709g_89">:</span>) and can be accessed using <span class="inline-code" id="-884366211#-mu709g_90">req.params</span>.</p><section><h3 id="-884366211#example" data-toc="example#Request-Object.md-example">Example:</h3><div class="detached code-block" id="-884366211#-mu709g_91"><pre><code class="language-javascript">app.get('/users/:id', (req, res) =&gt; {
  const { id } = req.params;
  // Logic to fetch user by id
  res.json({ message: `User ID: ${id}` });
});</code></pre></div><p id="-884366211#-mu709g_92">Example URL:</p><div class="detached code-block" id="-884366211#-mu709g_93"><pre><code class="language-none">/users/123</code></pre></div><p id="-884366211#-mu709g_94">In this case, <span class="inline-code" id="-884366211#-mu709g_98">req.params</span> would contain:</p><div class="detached code-block" id="-884366211#-mu709g_95"><pre><code class="language-json">{
  &quot;id&quot;: &quot;123&quot;
}</code></pre></div><p id="-884366211#-mu709g_96">Route parameters are often used when you want to reference a specific resource (like a user, product, or article) by its unique identifier.</p></section><section><h3 id="-884366211#i-operations-which-require-route-params" data-toc="i-operations-which-require-route-params#Request-Object.md-i-operations-which-require-route-params">i. Operations which Require Route Params</h3><section><h4 id="-884366211#a-fetching-a-single-resource" data-toc="a-fetching-a-single-resource#Request-Object.md-a-fetching-a-single-resource">a. Fetching a Single Resource</h4><p id="-884366211#-mu709g_102">You can use route parameters to fetch a specific resource based on a unique identifier (e.g., fetching a single user by their ID).</p><p id="-884366211#-mu709g_103">Example:</p><div class="detached code-block" id="-884366211#-mu709g_104"><pre><code class="language-javascript">app.get('/users/:id', (req, res) =&gt; {
  const { id } = req.params;
  // Fetch user by id
  res.json({ message: `Fetching user with ID: ${id}` });
});</code></pre></div></section><section><h4 id="-884366211#b-updating-a-specific-resource" data-toc="b-updating-a-specific-resource#Request-Object.md-b-updating-a-specific-resource">b. Updating a Specific Resource</h4><p id="-884366211#-mu709g_105">Route parameters can also be used for updating a specific resource.</p><p id="-884366211#-mu709g_106">Example:</p><div class="detached code-block" id="-884366211#-mu709g_107"><pre><code class="language-javascript">app.put('/users/:id', (req, res) =&gt; {
  const { id } = req.params;
  const { name, email } = req.body;
  // Update the user in the database
  res.json({ message: `User with ID ${id} updated`, name, email });
});</code></pre></div></section><section><h4 id="-884366211#c-deleting-a-specific-resource" data-toc="c-deleting-a-specific-resource#Request-Object.md-c-deleting-a-specific-resource">c. Deleting a Specific Resource</h4><p id="-884366211#-mu709g_108">You can use route parameters to delete a specific resource based on its unique ID.</p><p id="-884366211#-mu709g_109">Example:</p><div class="detached code-block" id="-884366211#-mu709g_110"><pre><code class="language-javascript">app.delete('/users/:id', (req, res) =&gt; {
  const { id } = req.params;
  // Delete the user from the database
  res.status(204).json({ message: `User with ID ${id} deleted` });
});</code></pre></div></section></section></section><section><h2 id="-884366211#summary" data-toc="summary#Request-Object.md-summary">Summary</h2><ul class="list" id="-884366211#-mu709g_112" start="1"><li class="list-item" id="-884366211#-mu709g_113"><p><span class="control" id="-884366211#-mu709g_115">Query Parameters (<span class="inline-code" id="-884366211#-mu709g_117">req.query</span>)</span>: Used for passing optional data like filtering, sorting, limiting, and pagination via URL queries (e.g., <span class="inline-code" id="-884366211#-mu709g_116">/users?name=John</span>).</p></li><li class="list-item" id="-884366211#-mu709g_114"><p><span class="control" id="-884366211#-mu709g_118">Route Parameters (<span class="inline-code" id="-884366211#-mu709g_120">req.params</span>)</span>: Used for passing dynamic data directly in the URL path (e.g., <span class="inline-code" id="-884366211#-mu709g_119">/users/:id</span>), commonly used for operations like fetching, updating, or deleting a resource.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1569161803">Response Object</h1><p id="1569161803#z6m3712_3">The <span class="control" id="1569161803#z6m3712_13">Response object (<span class="inline-code" id="1569161803#z6m3712_14">res</span>)</span> in Express is used to send the HTTP response to the client after a request is processed. It contains various methods that allow you to manipulate the response in different ways, such as sending JSON, setting the status code, sending files, or ending the request-response cycle.</p><section><h2 id="1569161803#a-what-is-the-response-object" data-toc="a-what-is-the-response-object#Response-Object.md-a-what-is-the-response-object">a. What is the Response Object?</h2><p id="1569161803#z6m3712_16">The <span class="inline-code" id="1569161803#z6m3712_19">res</span> object represents the HTTP response that an Express app sends when it receives an incoming request. It provides various methods to send different types of responses to the client, such as JSON data, plain text, HTML, or files.</p><section><h3 id="1569161803#example" data-toc="example#Response-Object.md-example">Example:</h3><div class="detached code-block" id="1569161803#z6m3712_20"><pre><code class="language-javascript">app.get('/example', (req, res) =&gt; {
  res.status(200).json({ message: 'Hello, World!' });
});</code></pre></div></section></section><section><h2 id="1569161803#b-response-methods" data-toc="b-response-methods#Response-Object.md-b-response-methods">b. Response Methods</h2><p id="1569161803#z6m3712_23">Express provides several useful methods within the <span class="inline-code" id="1569161803#z6m3712_26">res</span> object to handle various response types. Here&rsquo;s a breakdown of commonly used methods.</p></section><section><h2 id="1569161803#i-res-json" data-toc="i-res-json#Response-Object.md-i-res-json">i. res.json()</h2><p id="1569161803#z6m3712_28">The <span class="inline-code" id="1569161803#z6m3712_33">res.json()</span> method is used to send a JSON-formatted response. This method automatically sets the <span class="inline-code" id="1569161803#z6m3712_34">Content-Type</span> header to <span class="inline-code" id="1569161803#z6m3712_35">application/json</span>.</p><section><h3 id="1569161803#example" data-toc="example#Response-Object.md-example">Example:</h3><div class="detached code-block" id="1569161803#z6m3712_36"><pre><code class="language-javascript">app.get('/users', (req, res) =&gt; {
  const users = [{ id: 1, name: 'John Doe' }, { id: 2, name: 'Jane Doe' }];
  res.json(users);
});</code></pre></div><p id="1569161803#z6m3712_37">In this example, a JSON object (array of users) is sent as the response. The <span class="inline-code" id="1569161803#z6m3712_38">res.json()</span> method is ideal for RESTful APIs, where you often need to send structured JSON data to clients.</p></section><section><h3 id="1569161803#how-it-works" data-toc="how-it-works#Response-Object.md-how-it-works">How It Works:</h3><ul class="list" id="1569161803#z6m3712_39" start="1"><li class="list-item" id="1569161803#z6m3712_43"><p>Automatically converts JavaScript objects to JSON strings.</p></li><li class="list-item" id="1569161803#z6m3712_44"><p>Sets the <span class="inline-code" id="1569161803#z6m3712_45">Content-Type</span> header to <span class="inline-code" id="1569161803#z6m3712_46">application/json</span>.</p></li></ul><p id="1569161803#z6m3712_40">Example Output:</p><div class="detached code-block" id="1569161803#z6m3712_41"><pre><code class="language-json">[
  { &quot;id&quot;: 1, &quot;name&quot;: &quot;John Doe&quot; },
  { &quot;id&quot;: 2, &quot;name&quot;: &quot;Jane Doe&quot; }
]</code></pre></div></section></section><section><h2 id="1569161803#ii-res-status" data-toc="ii-res-status#Response-Object.md-ii-res-status">ii. res.status()</h2><p id="1569161803#z6m3712_48">The <span class="inline-code" id="1569161803#z6m3712_53">res.status()</span> method sets the HTTP status code of the response. Status codes are essential for indicating the result of an HTTP request (e.g., <span class="inline-code" id="1569161803#z6m3712_54">200</span> for success, <span class="inline-code" id="1569161803#z6m3712_55">404</span> for not found, <span class="inline-code" id="1569161803#z6m3712_56">500</span> for server errors).</p><section><h3 id="1569161803#example" data-toc="example#Response-Object.md-example">Example:</h3><div class="detached code-block" id="1569161803#z6m3712_57"><pre><code class="language-javascript">app.get('/notfound', (req, res) =&gt; {
  res.status(404).json({ message: 'Resource not found' });
});</code></pre></div><p id="1569161803#z6m3712_58">In this example, a 404 (Not Found) status is returned, along with a JSON message.</p></section><section><h3 id="1569161803#how-it-works" data-toc="how-it-works#Response-Object.md-how-it-works">How It Works:</h3><ul class="list" id="1569161803#z6m3712_59" start="1"><li class="list-item" id="1569161803#z6m3712_63"><p>Sets the HTTP status code for the response.</p></li><li class="list-item" id="1569161803#z6m3712_64"><p>Must be called before sending the final response with <span class="inline-code" id="1569161803#z6m3712_65">res.send()</span>, <span class="inline-code" id="1569161803#z6m3712_66">res.json()</span>, etc.</p></li></ul><p id="1569161803#z6m3712_60">Common Status Codes:</p><ul class="list" id="1569161803#z6m3712_61" start="1"><li class="list-item" id="1569161803#z6m3712_67"><p><span class="inline-code" id="1569161803#z6m3712_72">200</span> &ndash; OK (successful request)</p></li><li class="list-item" id="1569161803#z6m3712_68"><p><span class="inline-code" id="1569161803#z6m3712_73">201</span> &ndash; Created (resource successfully created)</p></li><li class="list-item" id="1569161803#z6m3712_69"><p><span class="inline-code" id="1569161803#z6m3712_74">400</span> &ndash; Bad Request (client-side error)</p></li><li class="list-item" id="1569161803#z6m3712_70"><p><span class="inline-code" id="1569161803#z6m3712_75">404</span> &ndash; Not Found (resource not found)</p></li><li class="list-item" id="1569161803#z6m3712_71"><p><span class="inline-code" id="1569161803#z6m3712_76">500</span> &ndash; Internal Server Error (server-side error)</p></li></ul></section></section><section><h2 id="1569161803#iii-res-send" data-toc="iii-res-send#Response-Object.md-iii-res-send">iii. res.send()</h2><p id="1569161803#z6m3712_78">The <span class="inline-code" id="1569161803#z6m3712_83">res.send()</span> method is used to send a response body of various types, including strings, buffers, or objects. If an object is passed, Express will automatically convert it to JSON (similar to <span class="inline-code" id="1569161803#z6m3712_84">res.json()</span>, but less explicit).</p><section><h3 id="1569161803#example" data-toc="example#Response-Object.md-example">Example:</h3><div class="detached code-block" id="1569161803#z6m3712_85"><pre><code class="language-javascript">app.get('/hello', (req, res) =&gt; {
  res.send('Hello, World!');
});</code></pre></div><p id="1569161803#z6m3712_86">This sends a plain text response to the client.</p></section><section><h3 id="1569161803#how-it-works" data-toc="how-it-works#Response-Object.md-how-it-works">How It Works:</h3><ul class="list" id="1569161803#z6m3712_87" start="1"><li class="list-item" id="1569161803#z6m3712_91"><p>Can send strings, arrays, buffers, or objects.</p></li><li class="list-item" id="1569161803#z6m3712_92"><p>Automatically sets the <span class="inline-code" id="1569161803#z6m3712_93">Content-Type</span> based on the argument type (e.g., <span class="inline-code" id="1569161803#z6m3712_94">text/plain</span> for strings, <span class="inline-code" id="1569161803#z6m3712_95">application/json</span> for objects).</p></li></ul><p id="1569161803#z6m3712_88">Example:</p><div class="detached code-block" id="1569161803#z6m3712_89"><pre><code class="language-javascript">app.get('/data', (req, res) =&gt; {
  res.send({ message: 'This is an object response' });
});</code></pre></div></section></section><section><h2 id="1569161803#iv-res-redirect" data-toc="iv-res-redirect#Response-Object.md-iv-res-redirect">iv. res.redirect()</h2><p id="1569161803#z6m3712_97">The <span class="inline-code" id="1569161803#z6m3712_102">res.redirect()</span> method is used to redirect the client to a different URL. It sends a <span class="inline-code" id="1569161803#z6m3712_103">302 Found</span> status code by default, but this can be changed to another redirect status code like <span class="inline-code" id="1569161803#z6m3712_104">301 Moved Permanently</span>.</p><section><h3 id="1569161803#example" data-toc="example#Response-Object.md-example">Example:</h3><div class="detached code-block" id="1569161803#z6m3712_105"><pre><code class="language-javascript">app.get('/old-route', (req, res) =&gt; {
  res.redirect('/new-route');
});</code></pre></div><p id="1569161803#z6m3712_106">In this example, a client requesting <span class="inline-code" id="1569161803#z6m3712_107">/old-route</span> will be redirected to <span class="inline-code" id="1569161803#z6m3712_108">/new-route</span>.</p></section><section><h3 id="1569161803#how-it-works" data-toc="how-it-works#Response-Object.md-how-it-works">How It Works:</h3><ul class="list" id="1569161803#z6m3712_109" start="1"><li class="list-item" id="1569161803#z6m3712_114"><p>By default, the status code is <span class="inline-code" id="1569161803#z6m3712_116">302</span> (temporary redirect).</p></li><li class="list-item" id="1569161803#z6m3712_115"><p>You can pass a status code as the first argument to specify a different type of redirect.</p></li></ul><p id="1569161803#z6m3712_110">Example:</p><div class="detached code-block" id="1569161803#z6m3712_111"><pre><code class="language-javascript">app.get('/permanent-redirect', (req, res) =&gt; {
  res.redirect(301, '/new-permanent-route');
});</code></pre></div><p id="1569161803#z6m3712_112">In this case, the server responds with a <span class="inline-code" id="1569161803#z6m3712_117">301 Moved Permanently</span> status, indicating that the resource has been moved to a new location.</p></section></section><section><h2 id="1569161803#v-res-download" data-toc="v-res-download#Response-Object.md-v-res-download">v. res.download()</h2><p id="1569161803#z6m3712_119">The <span class="inline-code" id="1569161803#z6m3712_124">res.download()</span> method prompts the client to download a file from the server. It automatically sets the appropriate headers so that the client knows it's receiving a file to download, rather than to render in the browser.</p><section><h3 id="1569161803#example" data-toc="example#Response-Object.md-example">Example:</h3><div class="detached code-block" id="1569161803#z6m3712_125"><pre><code class="language-javascript">app.get('/download', (req, res) =&gt; {
  const filePath = './files/sample.pdf';
  res.download(filePath, 'sample.pdf', (err) =&gt; {
    if (err) {
      res.status(500).send('Error downloading file');
    }
  });
});</code></pre></div><p id="1569161803#z6m3712_126">In this example, the client will download the file <span class="inline-code" id="1569161803#z6m3712_127">sample.pdf</span> from the server.</p></section><section><h3 id="1569161803#how-it-works" data-toc="how-it-works#Response-Object.md-how-it-works">How It Works:</h3><ul class="list" id="1569161803#z6m3712_128" start="1"><li class="list-item" id="1569161803#z6m3712_130"><p>Automatically sets the <span class="inline-code" id="1569161803#z6m3712_132">Content-Disposition</span> header to trigger the download.</p></li><li class="list-item" id="1569161803#z6m3712_131"><p>The second argument is optional and allows you to specify a custom filename for the downloaded file.</p></li></ul></section></section><section><h2 id="1569161803#vi-res-end" data-toc="vi-res-end#Response-Object.md-vi-res-end">vi. res.end()</h2><p id="1569161803#z6m3712_134">The <span class="inline-code" id="1569161803#z6m3712_139">res.end()</span> method is used to end the response process without sending any data. It is useful in situations where you need to terminate the connection, and no further data is to be sent.</p><section><h3 id="1569161803#example" data-toc="example#Response-Object.md-example">Example:</h3><div class="detached code-block" id="1569161803#z6m3712_140"><pre><code class="language-javascript">app.get('/close', (req, res) =&gt; {
  res.status(204).end(); // 204 No Content
});</code></pre></div><p id="1569161803#z6m3712_141">In this example, the <span class="inline-code" id="1569161803#z6m3712_142">res.end()</span> method is used to end the response without sending any content back to the client.</p></section><section><h3 id="1569161803#how-it-works" data-toc="how-it-works#Response-Object.md-how-it-works">How It Works:</h3><ul class="list" id="1569161803#z6m3712_143" start="1"><li class="list-item" id="1569161803#z6m3712_145"><p>Ends the response process.</p></li><li class="list-item" id="1569161803#z6m3712_146"><p>You should call this when you&rsquo;ve finished writing to the response and want to terminate the connection.</p></li><li class="list-item" id="1569161803#z6m3712_147"><p>It does not send any data or body content, just ends the response.</p></li></ul></section></section><section><h2 id="1569161803#summary" data-toc="summary#Response-Object.md-summary">Summary</h2><ul class="list" id="1569161803#z6m3712_148" start="1"><li class="list-item" id="1569161803#z6m3712_150"><p><span class="control" id="1569161803#z6m3712_156"><span class="inline-code" id="1569161803#z6m3712_159">res.json()</span></span>: Sends a JSON response. Automatically sets the <span class="inline-code" id="1569161803#z6m3712_157">Content-Type</span> header to <span class="inline-code" id="1569161803#z6m3712_158">application/json</span>.</p></li><li class="list-item" id="1569161803#z6m3712_151"><p><span class="control" id="1569161803#z6m3712_160"><span class="inline-code" id="1569161803#z6m3712_163">res.status()</span></span>: Sets the HTTP status code for the response. Should be called before <span class="inline-code" id="1569161803#z6m3712_161">res.send()</span> or <span class="inline-code" id="1569161803#z6m3712_162">res.json()</span>.</p></li><li class="list-item" id="1569161803#z6m3712_152"><p><span class="control" id="1569161803#z6m3712_164"><span class="inline-code" id="1569161803#z6m3712_165">res.send()</span></span>: Sends a response of various types (strings, objects, etc.). Automatically converts objects to JSON if needed.</p></li><li class="list-item" id="1569161803#z6m3712_153"><p><span class="control" id="1569161803#z6m3712_166"><span class="inline-code" id="1569161803#z6m3712_169">res.redirect()</span></span>: Redirects the client to a different URL. The default status code is <span class="inline-code" id="1569161803#z6m3712_167">302</span> (Found), but it can be changed to <span class="inline-code" id="1569161803#z6m3712_168">301</span> for permanent redirects.</p></li><li class="list-item" id="1569161803#z6m3712_154"><p><span class="control" id="1569161803#z6m3712_170"><span class="inline-code" id="1569161803#z6m3712_171">res.download()</span></span>: Prompts the client to download a file from the server.</p></li><li class="list-item" id="1569161803#z6m3712_155"><p><span class="control" id="1569161803#z6m3712_172"><span class="inline-code" id="1569161803#z6m3712_173">res.end()</span></span>: Ends the response process without sending any additional data. Used when no further data needs to be sent to the client.</p></li></ul><p id="1569161803#z6m3712_149">This collection of response methods helps you handle a variety of use cases, whether you're sending JSON data, redirecting users, or handling file downloads.</p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1338146957">Routing (Express.Router())</h1><p id="1338146957#-8g8xt0_3">Express provides a powerful and flexible way to define routing for your web application or API. The <span class="inline-code" id="1338146957#-8g8xt0_11">express.Router</span> is a modular, mountable route handler that allows you to organize your routes into separate files and group them logically.</p><p id="1338146957#-8g8xt0_4">Routing refers to how an application responds to client requests for a particular endpoint (URL path and HTTP method). Express routes can be simple, complex, or even organized into separate files using <span class="inline-code" id="1338146957#-8g8xt0_12">express.Router()</span>.</p><section><h2 id="1338146957#basic-routing" data-toc="basic-routing#Routing-Express-Router.md-basic-routing">Basic Routing</h2><p id="1338146957#-8g8xt0_14">Basic routing involves defining routes for HTTP methods (e.g., GET, POST, PUT, DELETE) using simple callback functions. This is typically used for handling a single endpoint.</p><section><h3 id="1338146957#example" data-toc="example#Routing-Express-Router.md-example">Example:</h3><div class="detached code-block" id="1338146957#-8g8xt0_17"><pre><code class="language-javascript">import express, { Request, Response } from 'express';

const app = express();

app.get('/home', (req: Request, res: Response) =&gt; {
  res.send('Welcome to the Home Page!');
});

app.post('/submit', (req: Request, res: Response) =&gt; {
  res.send('Form submitted!');
});

app.listen(3000, () =&gt; {
  console.log('Server is running on http://localhost:3000');
});</code></pre></div><p id="1338146957#-8g8xt0_18">In this example:</p><ul class="list" id="1338146957#-8g8xt0_19" start="1"><li class="list-item" id="1338146957#-8g8xt0_21"><p><span class="inline-code" id="1338146957#-8g8xt0_23">app.get('/home', ...)</span>: Handles HTTP GET requests to <span class="inline-code" id="1338146957#-8g8xt0_24">/home</span>.</p></li><li class="list-item" id="1338146957#-8g8xt0_22"><p><span class="inline-code" id="1338146957#-8g8xt0_25">app.post('/submit', ...)</span>: Handles HTTP POST requests to <span class="inline-code" id="1338146957#-8g8xt0_26">/submit</span>.</p></li></ul></section></section><section><h2 id="1338146957#complex-routing-with-express-router" data-toc="complex-routing-with-express-router#Routing-Express-Router.md-complex-routing-with-express-router">Complex Routing with express.Router</h2><p id="1338146957#-8g8xt0_28">As your application grows, managing all your routes in a single file becomes impractical. To address this, Express provides the <span class="inline-code" id="1338146957#-8g8xt0_33">Router()</span> function to create modular and mountable route handlers. Each router can handle its own set of routes and be exported from a file for use in the main application.</p><section><h3 id="1338146957#example-using-express-router-for-complex-routing" data-toc="example-using-express-router-for-complex-routing#Routing-Express-Router.md-example-using-express-router-for-complex-routing">Example: Using express.Router for Complex Routing</h3><div class="detached code-block" id="1338146957#-8g8xt0_35"><pre><code class="language-javascript">import express, { Request, Response } from 'express';

const router = express.Router();

// Route to get all users
router.get('/users', (req: Request, res: Response) =&gt; {
  res.json([{ id: 1, name: 'John Doe' }, { id: 2, name: 'Jane Doe' }]);
});

// Route to get a user by ID
router.get('/users/:id', (req: Request, res: Response) =&gt; {
  const { id } = req.params;
  res.json({ id, name: 'John Doe' });
});

// Route to create a new user
router.post('/users', (req: Request, res: Response) =&gt; {
  const { name } = req.body;
  res.status(201).json({ id: 3, name });
});

export default router;</code></pre></div></section><section><h3 id="1338146957#in-the-main-application" data-toc="in-the-main-application#Routing-Express-Router.md-in-the-main-application">In the main application:</h3><div class="detached code-block" id="1338146957#-8g8xt0_37"><pre><code class="language-javascript">import express from 'express';
import userRoutes from './routes/userRoutes'; // Importing router

const app = express();
app.use(express.json());

// Mount the user routes under /api
app.use('/api', userRoutes);

app.listen(3000, () =&gt; {
  console.log('Server is running on http://localhost:3000');
});</code></pre></div><p id="1338146957#-8g8xt0_38">In this example:</p><ul class="list" id="1338146957#-8g8xt0_39" start="1"><li class="list-item" id="1338146957#-8g8xt0_41"><p>We define several routes using <span class="inline-code" id="1338146957#-8g8xt0_44">express.Router()</span>.</p></li><li class="list-item" id="1338146957#-8g8xt0_42"><p>We then mount the router to the main application using <span class="inline-code" id="1338146957#-8g8xt0_45">app.use('/api', userRoutes)</span>.</p></li><li class="list-item" id="1338146957#-8g8xt0_43"><p>The API now has routes like <span class="inline-code" id="1338146957#-8g8xt0_46">/api/users</span> and <span class="inline-code" id="1338146957#-8g8xt0_47">/api/users/:id</span>.</p></li></ul></section></section><section><h2 id="1338146957#various-ways-to-structure-routes" data-toc="various-ways-to-structure-routes#Routing-Express-Router.md-various-ways-to-structure-routes">Various Ways to Structure Routes</h2><p id="1338146957#-8g8xt0_49">There are different ways to structure routes depending on the complexity and size of your application. Let&rsquo;s explore some common ways to organize routes in Express.</p><section><h3 id="1338146957#1-flat-structure-basic-applications" data-toc="1-flat-structure-basic-applications#Routing-Express-Router.md-1-flat-structure-basic-applications">1. Flat Structure (Basic Applications)</h3><p id="1338146957#-8g8xt0_55">For small applications, a simple flat structure is often sufficient:</p><div class="detached code-block" id="1338146957#-8g8xt0_56"><pre><code class="language-none">src/
  ├── app.ts        # Main application file
  └── routes/
      └── index.ts  # All routes defined in one file</code></pre></div><div class="detached code-block" id="1338146957#-8g8xt0_57"><pre><code class="language-javascript">// src/routes/index.ts
import express from 'express';

const router = express.Router();

router.get('/', (req, res) =&gt; res.send('Hello World'));
router.get('/about', (req, res) =&gt; res.send('About Page'));

export default router;

// src/app.ts
import express from 'express';
import routes from './routes/index';

const app = express();
app.use('/', routes);

app.listen(3000, () =&gt; console.log('Server running'));</code></pre></div><p id="1338146957#-8g8xt0_58">This is simple and ideal for applications with just a few routes.</p></section><section><h3 id="1338146957#2-modular-structure-medium-applications" data-toc="2-modular-structure-medium-applications#Routing-Express-Router.md-2-modular-structure-medium-applications">2. Modular Structure (Medium Applications)</h3><p id="1338146957#-8g8xt0_61">For larger applications, you might organize routes by resource (e.g., users, posts, products).</p><div class="detached code-block" id="1338146957#-8g8xt0_62"><pre><code class="language-none">src/
  ├── app.ts
  └── routes/
      ├── userRoutes.ts
      ├── postRoutes.ts
      └── index.ts</code></pre></div><div class="detached code-block" id="1338146957#-8g8xt0_63"><pre><code class="language-javascript">// src/routes/userRoutes.ts
import express from 'express';
const router = express.Router();

router.get('/', (req, res) =&gt; res.send('Get all users'));
router.post('/', (req, res) =&gt; res.send('Create user'));

export default router;

// src/routes/postRoutes.ts
import express from 'express';
const router = express.Router();

router.get('/', (req, res) =&gt; res.send('Get all posts'));
router.post('/', (req, res) =&gt; res.send('Create post'));

export default router;

// src/routes/index.ts
import express from 'express';
import userRoutes from './userRoutes';
import postRoutes from './postRoutes';

const router = express.Router();

router.use('/users', userRoutes);
router.use('/posts', postRoutes);

export default router;

// src/app.ts
import express from 'express';
import routes from './routes';

const app = express();
app.use('/api', routes);

app.listen(3000, () =&gt; console.log('Server running'));</code></pre></div><p id="1338146957#-8g8xt0_64">In this case:</p><ul class="list" id="1338146957#-8g8xt0_65" start="1"><li class="list-item" id="1338146957#-8g8xt0_67"><p>Routes are separated by resource (<span class="inline-code" id="1338146957#-8g8xt0_69">users</span>, <span class="inline-code" id="1338146957#-8g8xt0_70">posts</span>).</p></li><li class="list-item" id="1338146957#-8g8xt0_68"><p>The <span class="inline-code" id="1338146957#-8g8xt0_71">routes/index.ts</span> file imports and consolidates the other route files.</p></li></ul></section><section><h3 id="1338146957#3-advanced-structure-large-applications" data-toc="3-advanced-structure-large-applications#Routing-Express-Router.md-3-advanced-structure-large-applications">3. Advanced Structure (Large Applications)</h3><p id="1338146957#-8g8xt0_73">For large applications, you may want to include controllers, services, and middleware, each in separate directories to promote separation of concerns.</p><div class="detached code-block" id="1338146957#-8g8xt0_74"><pre><code class="language-none">src/
  ├── app.ts
  ├── controllers/
  │   ├── userController.ts
  │   └── postController.ts
  ├── routes/
  │   ├── userRoutes.ts
  │   └── postRoutes.ts
  └── services/
      ├── userService.ts
      └── postService.ts</code></pre></div><p id="1338146957#-8g8xt0_75"><span class="control" id="1338146957#-8g8xt0_80">Example</span>:</p><div class="detached code-block" id="1338146957#-8g8xt0_76"><pre><code class="language-javascript">// src/controllers/userController.ts
import { Request, Response } from 'express';
import { getAllUsers } from '../services/userService';

export const getUsers = (req: Request, res: Response) =&gt; {
  const users = getAllUsers();
  res.json(users);
};

// src/routes/userRoutes.ts
import express from 'express';
import { getUsers } from '../controllers/userController';

const router = express.Router();
router.get('/', getUsers);

export default router;

// src/app.ts
import express from 'express';
import userRoutes from './routes/userRoutes';

const app = express();
app.use('/api/users', userRoutes);

app.listen(3000, () =&gt; console.log('Server running'));</code></pre></div><p id="1338146957#-8g8xt0_77">This structure promotes clean code and separation of concerns. Each layer (controllers, services, routes) has its responsibility, which makes it easier to manage and scale.</p></section></section><section><h2 id="1338146957#best-practices-for-structuring-routes" data-toc="best-practices-for-structuring-routes#Routing-Express-Router.md-best-practices-for-structuring-routes">Best Practices for Structuring Routes</h2><ol class="list list-decimal" id="1338146957#-8g8xt0_82" type="1" start="1"><li class="list-item" id="1338146957#-8g8xt0_87"><p id="1338146957#-8g8xt0_95"><span class="control" id="1338146957#-8g8xt0_97">Organize by Feature or Resource</span>:</p><ul class="list" id="1338146957#-8g8xt0_96" start="1"><li class="list-item" id="1338146957#-8g8xt0_98"><p>Group related routes by resource (e.g., <span class="inline-code" id="1338146957#-8g8xt0_99">/users</span>, <span class="inline-code" id="1338146957#-8g8xt0_100">/posts</span>) rather than HTTP method (e.g., <span class="inline-code" id="1338146957#-8g8xt0_101">/getUser</span>, <span class="inline-code" id="1338146957#-8g8xt0_102">/createUser</span>). This promotes RESTful practices and cleaner route structures.</p></li></ul></li><li class="list-item" id="1338146957#-8g8xt0_88"><p id="1338146957#-8g8xt0_103"><span class="control" id="1338146957#-8g8xt0_105">Use <span class="inline-code" id="1338146957#-8g8xt0_106">express.Router</span> for Modular Code</span>:</p><ul class="list" id="1338146957#-8g8xt0_104" start="1"><li class="list-item" id="1338146957#-8g8xt0_107"><p>Define routes in separate files/modules using <span class="inline-code" id="1338146957#-8g8xt0_108">express.Router()</span>. This keeps your code modular, easier to maintain, and allows for cleaner imports in the main application.</p></li></ul></li><li class="list-item" id="1338146957#-8g8xt0_89"><p id="1338146957#-8g8xt0_109"><span class="control" id="1338146957#-8g8xt0_111">Use Route Controllers for Logic</span>:</p><ul class="list" id="1338146957#-8g8xt0_110" start="1"><li class="list-item" id="1338146957#-8g8xt0_112"><p>Avoid placing complex logic directly in route definitions. Instead, delegate business logic to controller functions, which handle processing and return the response.</p></li></ul></li><li class="list-item" id="1338146957#-8g8xt0_90"><p id="1338146957#-8g8xt0_113"><span class="control" id="1338146957#-8g8xt0_115">Use Middleware for Reusable Logic</span>:</p><ul class="list" id="1338146957#-8g8xt0_114" start="1"><li class="list-item" id="1338146957#-8g8xt0_116"><p>Implement middleware functions for common functionality like authentication, logging, or request validation. Apply middleware either globally or to specific routes.</p></li></ul></li><li class="list-item" id="1338146957#-8g8xt0_91"><p id="1338146957#-8g8xt0_117"><span class="control" id="1338146957#-8g8xt0_119">Separate Concerns</span>:</p><ul class="list" id="1338146957#-8g8xt0_118" start="1"><li class="list-item" id="1338146957#-8g8xt0_120"><p>Keep route definitions, controllers, services, and business logic in separate directories to maintain clear boundaries between different parts of the application.</p></li></ul></li><li class="list-item" id="1338146957#-8g8xt0_92"><p id="1338146957#-8g8xt0_121"><span class="control" id="1338146957#-8g8xt0_123">Keep the Router DRY (Don&rsquo;t Repeat Yourself)</span>:</p><ul class="list" id="1338146957#-8g8xt0_122" start="1"><li class="list-item" id="1338146957#-8g8xt0_124"><p>Avoid repeating common route prefixes. For example, mount resource routes under <span class="inline-code" id="1338146957#-8g8xt0_125">/api</span> once instead of specifying <span class="inline-code" id="1338146957#-8g8xt0_126">/api</span> for every route.</p></li></ul></li><li class="list-item" id="1338146957#-8g8xt0_93"><p id="1338146957#-8g8xt0_127"><span class="control" id="1338146957#-8g8xt0_129">Use Named Route Parameters for Dynamic Data</span>:</p><ul class="list" id="1338146957#-8g8xt0_128" start="1"><li class="list-item" id="1338146957#-8g8xt0_130"><p>Use route parameters like <span class="inline-code" id="1338146957#-8g8xt0_131">/users/:id</span> for accessing specific resources instead of relying on query parameters.</p></li></ul></li><li class="list-item" id="1338146957#-8g8xt0_94"><p id="1338146957#-8g8xt0_132"><span class="control" id="1338146957#-8g8xt0_134">Handle Errors in Routes</span>:</p><ul class="list" id="1338146957#-8g8xt0_133" start="1"><li class="list-item" id="1338146957#-8g8xt0_135"><p>Ensure that routes handle errors gracefully by catching exceptions and returning meaningful error responses with appropriate status codes.</p></li></ul></li></ol><p id="1338146957#-8g8xt0_83">Example of error handling:</p><div class="detached code-block" id="1338146957#-8g8xt0_84"><pre><code class="language-javascript">router.get('/:id', async (req: Request, res: Response, next: NextFunction) =&gt; {
  try {
    const user = await getUserById(req.params.id);
    if (!user) {
      return res.status(404).json({ message: 'User not found' });
    }
    res.json(user);
  } catch (error) {
    next(error);
  }
});</code></pre></div></section><section><h2 id="1338146957#summary" data-toc="summary#Routing-Express-Router.md-summary">Summary</h2><ul class="list" id="1338146957#-8g8xt0_136" start="1"><li class="list-item" id="1338146957#-8g8xt0_137"><p><span class="control" id="1338146957#-8g8xt0_141">Basic Routing</span>: Define simple routes using HTTP methods like <span class="inline-code" id="1338146957#-8g8xt0_142">GET</span>, <span class="inline-code" id="1338146957#-8g8xt0_143">POST</span>, <span class="inline-code" id="1338146957#-8g8xt0_144">PUT</span>, etc.</p></li><li class="list-item" id="1338146957#-8g8xt0_138"><p><span class="control" id="1338146957#-8g8xt0_145">Complex Routing</span>: Use <span class="inline-code" id="1338146957#-8g8xt0_146">express.Router()</span> to organize routes in a modular way for larger applications.</p></li><li class="list-item" id="1338146957#-8g8xt0_139"><p><span class="control" id="1338146957#-8g8xt0_147">Structure</span>: Depending on the application's size, routes can be organized into flat, modular, or advanced structures with separation of concerns (controllers, services, middleware).</p></li><li class="list-item" id="1338146957#-8g8xt0_140"><p><span class="control" id="1338146957#-8g8xt0_148">Best Practices</span>: Group routes by resource, delegate logic to controllers, use middleware for reusable logic, and handle errors properly.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="224957591">Serving static files &amp; Uploading files</h1><section><h2 id="224957591#7-serving-static-files-uploading-files-using-multer" data-toc="7-serving-static-files-uploading-files-using-multer#Serving-static-files-Uploading-files.md-7-serving-static-files-uploading-files-using-multer">7. Serving Static Files &amp; Uploading Files Using Multer</h2><p id="224957591#-51n7u6_11">In Express.js, serving static files like HTML, CSS, JavaScript, and images, as well as handling file uploads (e.g., user profile pictures, documents), is a common requirement for many web applications. Express provides built-in functionality for serving static files, and file uploads can be managed using <span class="control" id="224957591#-51n7u6_14">Multer</span>, a popular middleware for handling multipart/form-data, which is primarily used for uploading files.</p></section><section><h2 id="224957591#serving-static-files-in-express" data-toc="serving-static-files-in-express#Serving-static-files-Uploading-files.md-serving-static-files-in-express">Serving Static Files in Express</h2><p id="224957591#-51n7u6_16">To serve static files (e.g., images, CSS files, JavaScript files), you can use the built-in middleware <span class="inline-code" id="224957591#-51n7u6_21">express.static</span>. This middleware serves the files directly from the directory you specify.</p><section><h3 id="224957591#example-basic-setup-for-serving-static-files" data-toc="example-basic-setup-for-serving-static-files#Serving-static-files-Uploading-files.md-example-basic-setup-for-serving-static-files">Example: Basic Setup for Serving Static Files</h3><div class="detached code-block" id="224957591#-51n7u6_22"><pre><code class="language-javascript">import express from 'express';
import path from 'path';

const app = express();
const PORT = 3000;

// Serve static files from the &quot;public&quot; directory
app.use(express.static(path.join(__dirname, 'public')));

app.get('/', (req, res) =&gt; {
  res.send('Welcome to the homepage!');
});

app.listen(PORT, () =&gt; {
  console.log(`Server is running on http://localhost:${PORT}`);
});</code></pre></div></section><section><h3 id="224957591#directory-structure" data-toc="directory-structure#Serving-static-files-Uploading-files.md-directory-structure">Directory Structure:</h3><div class="detached code-block" id="224957591#-51n7u6_23"><pre><code class="language-none">src/
  ├── app.ts
  └── public/
      ├── index.html
      ├── styles.css
      └── script.js</code></pre></div><p id="224957591#-51n7u6_24">In this example:</p><ul class="list" id="224957591#-51n7u6_25" start="1"><li class="list-item" id="224957591#-51n7u6_26"><p><span class="control" id="224957591#-51n7u6_27"><span class="inline-code" id="224957591#-51n7u6_32">express.static(path.join(__dirname, 'public'))</span></span>: This middleware serves static files from the <span class="inline-code" id="224957591#-51n7u6_28">public</span> directory. Any file inside the <span class="inline-code" id="224957591#-51n7u6_29">public</span> folder can be accessed directly via a URL. For example, an image located at <span class="inline-code" id="224957591#-51n7u6_30">public/images/logo.png</span> can be accessed via <span class="inline-code" id="224957591#-51n7u6_31">http://localhost:3000/images/logo.png</span>.</p></li></ul></section><section><h3 id="224957591#serving-static-files-at-a-specific-route" data-toc="serving-static-files-at-a-specific-route#Serving-static-files-Uploading-files.md-serving-static-files-at-a-specific-route">Serving Static Files at a Specific Route:</h3><p id="224957591#-51n7u6_33">You can also mount static file serving to a specific route. For example:</p><div class="detached code-block" id="224957591#-51n7u6_34"><pre><code class="language-javascript">app.use('/static', express.static(path.join(__dirname, 'public')));</code></pre></div><p id="224957591#-51n7u6_35">Now, files in the <span class="inline-code" id="224957591#-51n7u6_37">public</span> folder will be served from <span class="inline-code" id="224957591#-51n7u6_38">http://localhost:3000/static/</span>. For example, the file <span class="inline-code" id="224957591#-51n7u6_39">public/images/logo.png</span> will be accessible via <span class="inline-code" id="224957591#-51n7u6_40">http://localhost:3000/static/images/logo.png</span>.</p></section></section><section><h2 id="224957591#uploading-files-using-multer" data-toc="uploading-files-using-multer#Serving-static-files-Uploading-files.md-uploading-files-using-multer">Uploading Files Using Multer</h2><p id="224957591#-51n7u6_42"><span class="control" id="224957591#-51n7u6_48">Multer</span> is a middleware for handling <span class="inline-code" id="224957591#-51n7u6_49">multipart/form-data</span>, primarily used for uploading files in Express applications. It allows you to handle file uploads easily and store them locally or upload them to cloud storage (e.g., AWS S3, Google Cloud).</p><section><h3 id="224957591#installation" data-toc="installation#Serving-static-files-Uploading-files.md-installation">Installation:</h3><div class="detached code-block" id="224957591#-51n7u6_50"><pre><code class="language-bash">npm install multer
npm install @types/multer --save-dev</code></pre></div></section><section><h3 id="224957591#basic-file-upload-example" data-toc="basic-file-upload-example#Serving-static-files-Uploading-files.md-basic-file-upload-example">Basic File Upload Example</h3><ol class="list list-decimal" id="224957591#-51n7u6_51" type="1" start="1"><li class="list-item" id="224957591#-51n7u6_55"><p><span class="control" id="224957591#-51n7u6_56">Set up Multer in your Express application</span>: Multer requires setting up a storage engine that defines how and where to store uploaded files.</p></li></ol><div class="detached code-block" id="224957591#-51n7u6_52"><pre><code class="language-javascript">import express from 'express';
import multer from 'multer';
import path from 'path';

const app = express();
const PORT = 3000;

// Set up Multer storage
const storage = multer.diskStorage({
  destination: (req, file, cb) =&gt; {
    cb(null, 'uploads/'); // Directory where files will be saved
  },
  filename: (req, file, cb) =&gt; {
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
    cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname)); // Custom filename
  }
});

const upload = multer({ storage });

app.use(express.static('public'));

// Simple file upload route
app.post('/upload', upload.single('file'), (req, res) =&gt; {
  res.send('File uploaded successfully!');
});

app.listen(PORT, () =&gt; {
  console.log(`Server running at http://localhost:${PORT}`);
});</code></pre></div><p id="224957591#-51n7u6_53">In this example:</p><ul class="list" id="224957591#-51n7u6_54" start="1"><li class="list-item" id="224957591#-51n7u6_57"><p><span class="control" id="224957591#-51n7u6_59"><span class="inline-code" id="224957591#-51n7u6_61">multer.diskStorage</span></span>: Defines the storage engine. The uploaded file is stored in the <span class="inline-code" id="224957591#-51n7u6_60">uploads</span> directory, and the file name is appended with a unique timestamp.</p></li><li class="list-item" id="224957591#-51n7u6_58"><p><span class="control" id="224957591#-51n7u6_62"><span class="inline-code" id="224957591#-51n7u6_64">upload.single('file')</span></span>: Middleware to handle single file uploads. The string <span class="inline-code" id="224957591#-51n7u6_63">'file'</span> should match the name attribute of the file input in your HTML form.</p></li></ul></section><section><h3 id="224957591#html-form-for-file-upload-public-folder" data-toc="html-form-for-file-upload-public-folder#Serving-static-files-Uploading-files.md-html-form-for-file-upload-public-folder">HTML Form for File Upload (Public Folder):</h3><div class="detached code-block" id="224957591#-51n7u6_65"><pre><code class="language-markup">&lt;!-- public/index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;title&gt;File Upload&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Upload a File&lt;/h1&gt;
  &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;
    &lt;button type=&quot;submit&quot;&gt;Upload&lt;/button&gt;
  &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div><p id="224957591#-51n7u6_66">In this form:</p><ul class="list" id="224957591#-51n7u6_67" start="1"><li class="list-item" id="224957591#-51n7u6_68"><p><span class="control" id="224957591#-51n7u6_69"><span class="inline-code" id="224957591#-51n7u6_70">enctype=&quot;multipart/form-data&quot;</span></span>: This is important for handling file uploads. Without it, the file won&rsquo;t be included in the form data sent to the server.</p></li></ul></section><section><h3 id="224957591#accessing-uploaded-file-information" data-toc="accessing-uploaded-file-information#Serving-static-files-Uploading-files.md-accessing-uploaded-file-information">Accessing Uploaded File Information:</h3><p id="224957591#-51n7u6_71">After the file is uploaded, you can access its details via <span class="inline-code" id="224957591#-51n7u6_76">req.file</span>.</p><div class="detached code-block" id="224957591#-51n7u6_72"><pre><code class="language-javascript">app.post('/upload', upload.single('file'), (req, res) =&gt; {
  console.log(req.file); // Information about the uploaded file
  res.send('File uploaded successfully!');
});</code></pre></div><p id="224957591#-51n7u6_73">The <span class="inline-code" id="224957591#-51n7u6_77">req.file</span> object contains useful information about the uploaded file, such as:</p><ul class="list" id="224957591#-51n7u6_74" start="1"><li class="list-item" id="224957591#-51n7u6_78"><p><span class="inline-code" id="224957591#-51n7u6_82">filename</span>: The name of the file on the server.</p></li><li class="list-item" id="224957591#-51n7u6_79"><p><span class="inline-code" id="224957591#-51n7u6_83">originalname</span>: The original name of the uploaded file.</p></li><li class="list-item" id="224957591#-51n7u6_80"><p><span class="inline-code" id="224957591#-51n7u6_84">mimetype</span>: The MIME type of the file.</p></li><li class="list-item" id="224957591#-51n7u6_81"><p><span class="inline-code" id="224957591#-51n7u6_85">size</span>: The size of the uploaded file.</p></li></ul></section></section><section><h2 id="224957591#uploading-multiple-files" data-toc="uploading-multiple-files#Serving-static-files-Uploading-files.md-uploading-multiple-files">Uploading Multiple Files</h2><p id="224957591#-51n7u6_87">You can also configure Multer to handle multiple file uploads at once.</p><div class="detached code-block" id="224957591#-51n7u6_88"><pre><code class="language-javascript">app.post('/uploads', upload.array('files', 5), (req, res) =&gt; {
  console.log(req.files); // Array of uploaded files
  res.send('Multiple files uploaded successfully!');
});</code></pre></div><p id="224957591#-51n7u6_89">In this example:</p><ul class="list" id="224957591#-51n7u6_90" start="1"><li class="list-item" id="224957591#-51n7u6_93"><p><span class="control" id="224957591#-51n7u6_94"><span class="inline-code" id="224957591#-51n7u6_97">upload.array('files', 5)</span></span>: This allows the client to upload up to 5 files at once. The <span class="inline-code" id="224957591#-51n7u6_95">files</span> field in the HTML form should match the name attribute in the <span class="inline-code" id="224957591#-51n7u6_96">input</span> tag.</p></li></ul><section><h3 id="224957591#example-html-form-for-multiple-files" data-toc="example-html-form-for-multiple-files#Serving-static-files-Uploading-files.md-example-html-form-for-multiple-files">Example HTML Form for Multiple Files:</h3><div class="detached code-block" id="224957591#-51n7u6_98"><pre><code class="language-markup">&lt;form action=&quot;/uploads&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
  &lt;input type=&quot;file&quot; name=&quot;files&quot; multiple /&gt;
  &lt;button type=&quot;submit&quot;&gt;Upload&lt;/button&gt;
&lt;/form&gt;</code></pre></div></section></section><section><h2 id="224957591#handling-file-types-and-size-limits" data-toc="handling-file-types-and-size-limits#Serving-static-files-Uploading-files.md-handling-file-types-and-size-limits">Handling File Types and Size Limits</h2><p id="224957591#-51n7u6_101">You can add validation in Multer to control the file type and size.</p><section><h3 id="224957591#restrict-file-type" data-toc="restrict-file-type#Serving-static-files-Uploading-files.md-restrict-file-type">Restrict File Type:</h3><p id="224957591#-51n7u6_105">You can use the <span class="inline-code" id="224957591#-51n7u6_107">fileFilter</span> option to allow only certain types of files (e.g., images).</p><div class="detached code-block" id="224957591#-51n7u6_106"><pre><code class="language-javascript">const upload = multer({
  storage,
  fileFilter: (req, file, cb) =&gt; {
    const fileTypes = /jpeg|jpg|png|gif/;
    const extName = fileTypes.test(path.extname(file.originalname).toLowerCase());
    const mimeType = fileTypes.test(file.mimetype);

    if (extName &amp;&amp; mimeType) {
      return cb(null, true);
    } else {
      cb(new Error('Only images are allowed!'));
    }
  }
});</code></pre></div></section><section><h3 id="224957591#restrict-file-size" data-toc="restrict-file-size#Serving-static-files-Uploading-files.md-restrict-file-size">Restrict File Size:</h3><p id="224957591#-51n7u6_108">You can restrict the size of uploaded files using the <span class="inline-code" id="224957591#-51n7u6_111">limits</span> option.</p><div class="detached code-block" id="224957591#-51n7u6_109"><pre><code class="language-javascript">const upload = multer({
  storage,
  limits: { fileSize: 1024 * 1024 * 2 } // Limit file size to 2MB
});</code></pre></div></section></section><section><h2 id="224957591#organizing-file-upload-logic" data-toc="organizing-file-upload-logic#Serving-static-files-Uploading-files.md-organizing-file-upload-logic">Organizing File Upload Logic</h2><p id="224957591#-51n7u6_113">For larger applications, you should organize file upload logic into a more modular structure. You can separate concerns by moving your file upload configurations and logic into separate files.</p><section><h3 id="224957591#example-structure" data-toc="example-structure#Serving-static-files-Uploading-files.md-example-structure">Example Structure:</h3><div class="detached code-block" id="224957591#-51n7u6_120"><pre><code class="language-none">src/
  ├── app.ts
  ├── controllers/
  │   └── uploadController.ts
  ├── routes/
  │   └── uploadRoutes.ts
  └── config/
      └── multerConfig.ts</code></pre></div><ul class="list" id="224957591#-51n7u6_121" start="1"><li class="list-item" id="224957591#-51n7u6_122"><p><span class="control" id="224957591#-51n7u6_125"><span class="inline-code" id="224957591#-51n7u6_126">multerConfig.ts</span></span>: Configuration for file uploads.</p></li><li class="list-item" id="224957591#-51n7u6_123"><p><span class="control" id="224957591#-51n7u6_127"><span class="inline-code" id="224957591#-51n7u6_128">uploadController.ts</span></span>: Logic for handling uploaded files.</p></li><li class="list-item" id="224957591#-51n7u6_124"><p><span class="control" id="224957591#-51n7u6_129"><span class="inline-code" id="224957591#-51n7u6_130">uploadRoutes.ts</span></span>: Defines the routes for handling file uploads.</p></li></ul></section><section><h3 id="224957591#example-multerconfig-ts" data-toc="example-multerconfig-ts#Serving-static-files-Uploading-files.md-example-multerconfig-ts">Example multerConfig.ts:</h3><div class="detached code-block" id="224957591#-51n7u6_132"><pre><code class="language-javascript">import multer from 'multer';
import path from 'path';

const storage = multer.diskStorage({
  destination: 'uploads/',
  filename: (req, file, cb) =&gt; {
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
    cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));
  }
});

export const upload = multer({
  storage,
  limits: { fileSize: 1024 * 1024 * 5 }, // 5MB limit
  fileFilter: (req, file, cb) =&gt; {
    const fileTypes = /jpeg|jpg|png|gif/;
    const extName = fileTypes.test(path.extname(file.originalname).toLowerCase());
    const mimeType = fileTypes.test(file.mimetype);

    if (extName &amp;&amp; mimeType) {
      return cb(null, true);
    } else {
      cb(new Error('Only images are allowed!'));
    }
  }
});</code></pre></div></section><section><h3 id="224957591#example-uploadcontroller-ts" data-toc="example-uploadcontroller-ts#Serving-static-files-Uploading-files.md-example-uploadcontroller-ts">Example uploadController.ts:</h3><div class="detached code-block" id="224957591#-51n7u6_135"><pre><code class="language-javascript">import { Request, Response } from 'express';

export const uploadFile = (req: Request, res: Response) =&gt; {
  if (!req.file) {
    return res.status(400).send('No file uploaded');
  }
  res.send('File uploaded successfully!');
};</code></pre></div></section><section><h3 id="224957591#example-uploadroutes-ts" data-toc="example-uploadroutes-ts#Serving-static-files-Uploading-files.md-example-uploadroutes-ts">Example uploadRoutes.ts:</h3><div class="detached code-block" id="224957591#-51n7u6_138"><pre><code class="language-javascript">import express from 'express';
import { upload } from '../config/multerConfig';
import

 { uploadFile } from '../controllers/uploadController';

const router = express.Router();

router.post('/upload', upload.single('file'), uploadFile);

export default router;</code></pre></div></section><section><h3 id="224957591#example-app-ts" data-toc="example-app-ts#Serving-static-files-Uploading-files.md-example-app-ts">Example app.ts:</h3><div class="detached code-block" id="224957591#-51n7u6_141"><pre><code class="language-javascript">import express from 'express';
import uploadRoutes from './routes/uploadRoutes';

const app = express();
app.use(express.json());
app.use('/api', uploadRoutes);

app.listen(3000, () =&gt; {
  console.log('Server running at http://localhost:3000');
});</code></pre></div></section></section><section><h2 id="224957591#summary" data-toc="summary#Serving-static-files-Uploading-files.md-summary">Summary</h2><ul class="list" id="224957591#-51n7u6_144" start="1"><li class="list-item" id="224957591#-51n7u6_145"><p><span class="control" id="224957591#-51n7u6_148">Serving Static Files</span>: Use the <span class="inline-code" id="224957591#-51n7u6_149">express.static()</span> middleware to serve static assets (like HTML, CSS, images) from a directory. These files can be accessed directly via their URL path.</p></li><li class="list-item" id="224957591#-51n7u6_146"><p><span class="control" id="224957591#-51n7u6_150">File Uploads with Multer</span>: Use Multer to handle file uploads by configuring storage options (e.g., where to store files) and handling multipart/form-data. You can restrict file size, type, and name uploads for security and consistency.</p></li><li class="list-item" id="224957591#-51n7u6_147"><p><span class="control" id="224957591#-51n7u6_151">Organizing Upload Logic</span>: For larger applications, separate concerns into different files (controllers, routes, configurations) to maintain modularity and clean code.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="2110734593">Middlewares</h1><p id="2110734593#z46lk9s_4">Express middlewares are functions that execute during the request-response cycle. They can perform various tasks such as parsing request bodies, logging, handling errors, rate-limiting, and more. Middlewares can be built-in, custom, or external libraries that you plug into your application.</p><section><h2 id="2110734593#middleware-types" data-toc="middleware-types#Middlewares.md-middleware-types">Middleware Types:</h2><ul class="list" id="2110734593#z46lk9s_14" start="1"><li class="list-item" id="2110734593#z46lk9s_16"><p><span class="control" id="2110734593#z46lk9s_18">Built-in</span>: Included in the Express framework.</p></li><li class="list-item" id="2110734593#z46lk9s_17"><p><span class="control" id="2110734593#z46lk9s_19">External</span>: Additional middleware provided by third-party libraries.</p></li></ul></section><section><h2 id="2110734593#a-inbuilt-middlewares" data-toc="a-inbuilt-middlewares#Middlewares.md-a-inbuilt-middlewares">a. Inbuilt Middlewares</h2><p id="2110734593#z46lk9s_21">Express has several built-in middlewares that handle common tasks like parsing request bodies. Two of the most commonly used built-in middlewares are <span class="inline-code" id="2110734593#z46lk9s_25">express.json()</span> and <span class="inline-code" id="2110734593#z46lk9s_26">express.urlencoded()</span>.</p><section><h3 id="2110734593#i-express-json" data-toc="i-express-json#Middlewares.md-i-express-json">i. express.json()</h3><p id="2110734593#z46lk9s_28">The <span class="inline-code" id="2110734593#z46lk9s_32">express.json()</span> middleware is used to parse incoming JSON payloads. It makes the body of the request available in <span class="inline-code" id="2110734593#z46lk9s_33">req.body</span>. This is commonly used in APIs where JSON data is submitted in POST or PUT requests.</p><div class="detached code-block" id="2110734593#z46lk9s_29"><pre><code class="language-javascript">import express from 'express';
const app = express();

app.use(express.json()); // Parses JSON requests

app.post('/data', (req, res) =&gt; {
  console.log(req.body); // Access the JSON data sent in the request
  res.send('Data received');
});

app.listen(3000, () =&gt; {
  console.log('Server is running on http://localhost:3000');
});</code></pre></div></section><section><h3 id="2110734593#ii-express-urlencoded-extended-true" data-toc="ii-express-urlencoded-extended-true#Middlewares.md-ii-express-urlencoded-extended-true">ii. express.urlencoded({ extended: true })</h3><p id="2110734593#z46lk9s_35">This middleware is used to parse URL-encoded payloads, which are usually submitted by HTML forms. It makes the form data available in <span class="inline-code" id="2110734593#z46lk9s_41">req.body</span>.</p><ul class="list" id="2110734593#z46lk9s_36" start="1"><li class="list-item" id="2110734593#z46lk9s_42"><p><span class="control" id="2110734593#z46lk9s_44"><span class="inline-code" id="2110734593#z46lk9s_45">extended: true</span></span>: Allows for richer objects and arrays to be encoded.</p></li><li class="list-item" id="2110734593#z46lk9s_43"><p><span class="control" id="2110734593#z46lk9s_46"><span class="inline-code" id="2110734593#z46lk9s_47">extended: false</span></span>: Uses the classic encoding of the query-string library.</p></li></ul><div class="detached code-block" id="2110734593#z46lk9s_37"><pre><code class="language-javascript">app.use(express.urlencoded({ extended: true })); // Parses URL-encoded requests

app.post('/submit', (req, res) =&gt; {
  console.log(req.body); // Access the form data submitted
  res.send('Form submitted');
});</code></pre></div></section></section><section><h2 id="2110734593#b-external-middlewares" data-toc="b-external-middlewares#Middlewares.md-b-external-middlewares">b. External Middlewares</h2><p id="2110734593#z46lk9s_49">Express has a large ecosystem of third-party middlewares. Here are some useful external middlewares you can integrate into your Express application:</p></section><section><h2 id="2110734593#i-express-rate-limit" data-toc="i-express-rate-limit#Middlewares.md-i-express-rate-limit">i. express-rate-limit</h2><p id="2110734593#z46lk9s_53">The <span class="inline-code" id="2110734593#z46lk9s_58">express-rate-limit</span> middleware helps you limit the number of requests a client can make to your API in a given time window. This is useful for preventing abuse (e.g., DDoS attacks) by limiting the frequency of requests.</p><section><h3 id="2110734593#installation" data-toc="installation#Middlewares.md-installation">Installation:</h3><div class="detached code-block" id="2110734593#z46lk9s_59"><pre><code class="language-bash">npm install express-rate-limit</code></pre></div></section><section><h3 id="2110734593#example-usage" data-toc="example-usage#Middlewares.md-example-usage">Example Usage:</h3><div class="detached code-block" id="2110734593#z46lk9s_60"><pre><code class="language-javascript">import express from 'express';
import rateLimit from 'express-rate-limit';

const app = express();

// Rate limit middleware
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // Limit each IP to 100 requests per windowMs
  message: 'Too many requests, please try again later.'
});

app.use('/api', limiter); // Apply the rate limit to all API routes

app.listen(3000, () =&gt; {
  console.log('Server running on http://localhost:3000');
});</code></pre></div></section></section><section><h2 id="2110734593#ii-pino-with-pino-pretty" data-toc="ii-pino-with-pino-pretty#Middlewares.md-ii-pino-with-pino-pretty">ii. pino (with pino-pretty)</h2><p id="2110734593#z46lk9s_63"><span class="inline-code" id="2110734593#z46lk9s_69">Pino</span> is a fast and lightweight logging library for Node.js. It's a great alternative to more verbose logging systems like <span class="inline-code" id="2110734593#z46lk9s_70">winston</span>. When combined with <span class="inline-code" id="2110734593#z46lk9s_71">pino-pretty</span>, the logs are formatted in a more human-readable way for development.</p><section><h3 id="2110734593#installation" data-toc="installation#Middlewares.md-installation">Installation:</h3><div class="detached code-block" id="2110734593#z46lk9s_72"><pre><code class="language-bash">npm install pino pino-pretty</code></pre></div></section><section><h3 id="2110734593#example-usage" data-toc="example-usage#Middlewares.md-example-usage">Example Usage:</h3><div class="detached code-block" id="2110734593#z46lk9s_73"><pre><code class="language-javascript">import express from 'express';
import pino from 'pino';
import pinoHttp from 'pino-http';

const logger = pino({ prettyPrint: true });
const app = express();

app.use(pinoHttp({ logger })); // Integrate Pino with Express

app.get('/', (req, res) =&gt; {
  req.log.info('Request received'); // Example log
  res.send('Hello, Pino logger!');
});

app.listen(3000, () =&gt; {
  logger.info('Server running on http://localhost:3000');
});</code></pre></div><p id="2110734593#z46lk9s_74">With <span class="inline-code" id="2110734593#z46lk9s_76">pino-pretty</span>, the logs are displayed in a cleaner, human-friendly format.</p></section></section><section><h2 id="2110734593#iii-prom-client" data-toc="iii-prom-client#Middlewares.md-iii-prom-client">iii. prom-client</h2><p id="2110734593#z46lk9s_78">The <span class="inline-code" id="2110734593#z46lk9s_84">prom-client</span> middleware helps integrate <span class="control" id="2110734593#z46lk9s_85">Prometheus</span> metrics into your Express application. This allows you to track various performance metrics like response times, request counts, and more.</p><section><h3 id="2110734593#installation" data-toc="installation#Middlewares.md-installation">Installation:</h3><div class="detached code-block" id="2110734593#z46lk9s_86"><pre><code class="language-bash">npm install prom-client</code></pre></div></section><section><h3 id="2110734593#example-usage" data-toc="example-usage#Middlewares.md-example-usage">Example Usage:</h3><div class="detached code-block" id="2110734593#z46lk9s_87"><pre><code class="language-javascript">import express from 'express';
import client from 'prom-client';

const app = express();

// Create metrics for response time
const restResponseTimeHistogram = new client.Histogram({
  name: 'rest_response_time_duration_seconds',
  help: 'REST API response time in seconds',
  labelNames: ['method', 'route', 'status_code'],
});

const databaseResponseTimeHistogram = new client.Histogram({
  name: 'database_response_time_duration_seconds',
  help: 'Database response time in seconds',
  labelNames: ['operation'],
});

// Middleware to start timer for response time
app.use((req, res, next) =&gt; {
  const end = restResponseTimeHistogram.startTimer();
  res.on('finish', () =&gt; {
    end({ method: req.method, route: req.route?.path, status_code: res.statusCode });
  });
  next();
});

app.get('/metrics', async (req, res) =&gt; {
  res.set('Content-Type', client.register.contentType);
  res.end(await client.register.metrics());
});

app.listen(3000, () =&gt; {
  console.log('Server running on http://localhost:3000');
});</code></pre></div></section><section><h3 id="2110734593#key-metrics" data-toc="key-metrics#Middlewares.md-key-metrics">Key Metrics:</h3><ol class="list list-decimal" id="2110734593#z46lk9s_88" type="1" start="1"><li class="list-item" id="2110734593#z46lk9s_90"><p><span class="control" id="2110734593#z46lk9s_92"><span class="inline-code" id="2110734593#z46lk9s_93">restResponseTimeHistogram</span></span>: Tracks the REST API's response time.</p></li><li class="list-item" id="2110734593#z46lk9s_91"><p><span class="control" id="2110734593#z46lk9s_94"><span class="inline-code" id="2110734593#z46lk9s_95">databaseResponseTimeHistogram</span></span>: Tracks response times for database queries (you would call this in your database service).</p></li></ol></section></section><section><h2 id="2110734593#iv-morgan" data-toc="iv-morgan#Middlewares.md-iv-morgan">iv. morgan</h2><p id="2110734593#z46lk9s_97"><span class="inline-code" id="2110734593#z46lk9s_102">morgan</span> is a popular HTTP request logger middleware. It provides detailed logs about requests made to your server, which can be very useful for debugging and monitoring.</p><section><h3 id="2110734593#installation" data-toc="installation#Middlewares.md-installation">Installation:</h3><div class="detached code-block" id="2110734593#z46lk9s_103"><pre><code class="language-bash">npm install morgan</code></pre></div></section><section><h3 id="2110734593#example-usage" data-toc="example-usage#Middlewares.md-example-usage">Example Usage:</h3><section><h4 id="2110734593#1-basic-logging-to-console" data-toc="1-basic-logging-to-console#Middlewares.md-1-basic-logging-to-console">1. Basic Logging to Console:</h4><div class="detached code-block" id="2110734593#z46lk9s_107"><pre><code class="language-javascript">import express from 'express';
import morgan from 'morgan';

const app = express();

// Use morgan for logging HTTP requests
app.use(morgan('dev')); // 'dev' is a pre-defined format

app.get('/', (req, res) =&gt; {
  res.send('Hello, Morgan Logger!');
});

app.listen(3000, () =&gt; {
  console.log('Server running on http://localhost:3000');
});</code></pre></div></section><section><h4 id="2110734593#2-logging-with-pino-using-pino-pretty" data-toc="2-logging-with-pino-using-pino-pretty#Middlewares.md-2-logging-with-pino-using-pino-pretty">2. Logging with pino (using pino-pretty):</h4><p id="2110734593#z46lk9s_109">You can replace <span class="inline-code" id="2110734593#z46lk9s_113">morgan</span> with <span class="inline-code" id="2110734593#z46lk9s_114">pino</span> for logging if you need high performance logging.</p><div class="detached code-block" id="2110734593#z46lk9s_110"><pre><code class="language-javascript">import express from 'express';
import pino from 'pino';
import pinoHttp from 'pino-http';

const logger = pino({ prettyPrint: true });

const app = express();
app.use(pinoHttp({ logger }));

app.get('/', (req, res) =&gt; {
  req.log.info('Logging request'); // Log using Pino
  res.send('Hello, Pino and Express!');
});

app.listen(3000, () =&gt; {
  logger.info('Server is running');
});</code></pre></div></section><section><h4 id="2110734593#3-writing-logs-to-a-file" data-toc="3-writing-logs-to-a-file#Middlewares.md-3-writing-logs-to-a-file">3. Writing Logs to a File:</h4><p id="2110734593#z46lk9s_115">You can also configure <span class="inline-code" id="2110734593#z46lk9s_118">morgan</span> to log requests to a file instead of the console.</p><div class="detached code-block" id="2110734593#z46lk9s_116"><pre><code class="language-javascript">import express from 'express';
import morgan from 'morgan';
import fs from 'fs';
import path from 'path';

const app = express();

// Create a write stream for logging into a file
const accessLogStream = fs.createWriteStream(path.join(__dirname, 'access.log'), { flags: 'a' });

// Use morgan for logging into a file
app.use(morgan('combined', { stream: accessLogStream }));

app.get('/', (req, res) =&gt; {
  res.send('Logging requests to a file');
});

app.listen(3000, () =&gt; {
  console.log('Server running on http://localhost:3000');
});</code></pre></div></section></section></section><section><h2 id="2110734593#v-swagger-swagger-ui-express-swagger-jsdoc" data-toc="v-swagger-swagger-ui-express-swagger-jsdoc#Middlewares.md-v-swagger-swagger-ui-express-swagger-jsdoc">v. Swagger (swagger-ui-express &amp; swagger-jsdoc)</h2><p id="2110734593#z46lk9s_120">Swagger is a set of tools to help document and visualize REST APIs. You can use <span class="inline-code" id="2110734593#z46lk9s_127">swagger-ui-express</span> to serve a Swagger UI and <span class="inline-code" id="2110734593#z46lk9s_128">swagger-jsdoc</span> to generate the OpenAPI specification (Swagger docs) from comments in your code.</p><section><h3 id="2110734593#installation" data-toc="installation#Middlewares.md-installation">Installation:</h3><div class="detached code-block" id="2110734593#z46lk9s_129"><pre><code class="language-bash">npm install swagger-ui-express swagger-jsdoc</code></pre></div></section><section><h3 id="2110734593#example-setup" data-toc="example-setup#Middlewares.md-example-setup">Example Setup:</h3><div class="detached code-block" id="2110734593#z46lk9s_130"><pre><code class="language-javascript">import express from 'express';
import swaggerUi from 'swagger-ui-express';
import swaggerJsdoc from 'swagger-jsdoc';

const app = express();

const swaggerOptions = {
  definition: {
    openapi: '3.0.0',
    info: {
      title: 'Express API Documentation',
      version: '1.0.0',
      description: 'A sample API'
    },
  },
  apis: ['./src/routes/*.ts'], // Path to your API route files
};

const swaggerDocs = swaggerJsdoc(swaggerOptions);

// Serve Swagger UI
app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerDocs));

// Example API route
app.get('/api', (req, res) =&gt; {
  res.send('API works!');
});

app.listen(3000, () =&gt; {
  console.log('Server running on http://localhost:3000');
});</code></pre></div></section><section><h3 id="2110734593#adding-swagger-documentation-to-routes" data-toc="adding-swagger-documentation-to-routes#Middlewares.md-adding-swagger-documentation-to-routes">Adding Swagger Documentation to Routes:</h3><p id="2110734593#z46lk9s_131">You can add Swagger documentation directly in your routes using comments.</p><div class="detached code-block" id="2110734593#z46lk9s_132"><pre><code class="language-javascript">/**
 * @swagger
 * /api:
 *   get:
 *     description: Get API status
 *    

 responses:
 *       200:
 *         description: Success
 */
app.get('/api', (req, res) =&gt; {
  res.send('API works!');
});</code></pre></div><p id="2110734593#z46lk9s_133">In this setup:</p><ul class="list" id="2110734593#z46lk9s_134" start="1"><li class="list-item" id="2110734593#z46lk9s_136"><p><span class="control" id="2110734593#z46lk9s_138"><span class="inline-code" id="2110734593#z46lk9s_139">swagger-ui-express</span></span>: Provides a UI to view and interact with the API documentation.</p></li><li class="list-item" id="2110734593#z46lk9s_137"><p><span class="control" id="2110734593#z46lk9s_140"><span class="inline-code" id="2110734593#z46lk9s_141">swagger-jsdoc</span></span>: Parses comments in your code and generates an OpenAPI specification.</p></li></ul></section></section><section><h2 id="2110734593#summary" data-toc="summary#Middlewares.md-summary">Summary</h2><ul class="list" id="2110734593#z46lk9s_142" start="1"><li class="list-item" id="2110734593#z46lk9s_143"><p id="2110734593#z46lk9s_145"><span class="control" id="2110734593#z46lk9s_147">Built-in Middlewares</span>:</p><ul class="list" id="2110734593#z46lk9s_146" start="1"><li class="list-item" id="2110734593#z46lk9s_148"><p><span class="inline-code" id="2110734593#z46lk9s_150">express.json()</span>: Parses incoming JSON requests.</p></li><li class="list-item" id="2110734593#z46lk9s_149"><p><span class="inline-code" id="2110734593#z46lk9s_151">express.urlencoded({ extended: true })</span>: Parses URL-encoded data (from HTML forms).</p></li></ul></li><li class="list-item" id="2110734593#z46lk9s_144"><p id="2110734593#z46lk9s_152"><span class="control" id="2110734593#z46lk9s_154">External Middlewares</span>:</p><ul class="list" id="2110734593#z46lk9s_153" start="1"><li class="list-item" id="2110734593#z46lk9s_155"><p><span class="control" id="2110734593#z46lk9s_160"><span class="inline-code" id="2110734593#z46lk9s_161">express-rate-limit</span></span>: Prevents abuse by limiting request rates.</p></li><li class="list-item" id="2110734593#z46lk9s_156"><p><span class="control" id="2110734593#z46lk9s_162"><span class="inline-code" id="2110734593#z46lk9s_164">pino</span></span>: High-performance logging library (with <span class="inline-code" id="2110734593#z46lk9s_163">pino-pretty</span> for human-readable logs).</p></li><li class="list-item" id="2110734593#z46lk9s_157"><p><span class="control" id="2110734593#z46lk9s_165"><span class="inline-code" id="2110734593#z46lk9s_166">prom-client</span></span>: Provides Prometheus metrics to monitor API performance.</p></li><li class="list-item" id="2110734593#z46lk9s_158"><p><span class="control" id="2110734593#z46lk9s_167"><span class="inline-code" id="2110734593#z46lk9s_168">morgan</span></span>: Simple HTTP request logging (to the console or a file).</p></li><li class="list-item" id="2110734593#z46lk9s_159"><p><span class="control" id="2110734593#z46lk9s_169"><span class="inline-code" id="2110734593#z46lk9s_170">swagger-ui-express</span> &amp; <span class="inline-code" id="2110734593#z46lk9s_171">swagger-jsdoc</span></span>: Automatically generate and serve API documentation via Swagger.</p></li></ul></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="329692679">Schema Validation (Zod)</h1><p id="329692679#-979a06_3"><span class="control" id="329692679#-979a06_14">Zod</span> is a TypeScript-first schema declaration and validation library. It provides a simple and declarative way to define and validate data schemas, which is especially useful when working with user input, API requests, and complex data models in Express.js applications.</p><p id="329692679#-979a06_4">Compared to other validation libraries (like Joi or Yup), Zod is tightly integrated with TypeScript, providing full type inference and static type safety, which can help prevent runtime errors and improve developer experience.</p><section><h2 id="329692679#why-zod" data-toc="why-zod#Schema-Validation-Zod.md-why-zod">Why Zod?</h2><ul class="list" id="329692679#-979a06_16" start="1"><li class="list-item" id="329692679#-979a06_19"><p><span class="control" id="329692679#-979a06_22">TypeScript-first</span>: Zod automatically infers TypeScript types from your schema, reducing redundancy.</p></li><li class="list-item" id="329692679#-979a06_20"><p><span class="control" id="329692679#-979a06_23">Declarative</span>: You define schemas once and use them for both validation and type-checking.</p></li><li class="list-item" id="329692679#-979a06_21"><p><span class="control" id="329692679#-979a06_24">Simple API</span>: Zod provides a clean and simple interface for creating schemas and validating data.</p></li></ul></section><section><h2 id="329692679#installation" data-toc="installation#Schema-Validation-Zod.md-installation">Installation</h2><p id="329692679#-979a06_26">To use Zod, first install it via npm:</p><div class="detached code-block" id="329692679#-979a06_27"><pre><code class="language-bash">npm install zod</code></pre></div></section><section><h2 id="329692679#basic-usage-of-zod" data-toc="basic-usage-of-zod#Schema-Validation-Zod.md-basic-usage-of-zod">Basic Usage of Zod</h2><p id="329692679#-979a06_31">Zod allows you to define schemas for various data types and validate data against those schemas. Here&rsquo;s an example of how to create a simple schema and validate an object:</p><section><h3 id="329692679#example-of-basic-validation" data-toc="example-of-basic-validation#Schema-Validation-Zod.md-example-of-basic-validation">Example of Basic Validation:</h3><div class="detached code-block" id="329692679#-979a06_34"><pre><code class="language-javascript">import { z } from 'zod';

const userSchema = z.object({
  id: z.number(),
  name: z.string().min(3, 'Name must be at least 3 characters long'),
  email: z.string().email(),
  age: z.number().positive().int().optional(), // Optional field
});

const userData = {
  id: 1,
  name: 'John Doe',
  email: 'john@example.com',
};

try {
  userSchema.parse(userData); // Validation successful
  console.log('User data is valid');
} catch (err) {
  console.log(err.errors); // Print validation errors
}</code></pre></div><p id="329692679#-979a06_35">In this example:</p><ul class="list" id="329692679#-979a06_36" start="1"><li class="list-item" id="329692679#-979a06_38"><p><span class="control" id="329692679#-979a06_42"><span class="inline-code" id="329692679#-979a06_43">z.number()</span></span>: Defines a number type.</p></li><li class="list-item" id="329692679#-979a06_39"><p><span class="control" id="329692679#-979a06_44"><span class="inline-code" id="329692679#-979a06_47">z.string()</span></span>: Defines a string type, with additional <span class="inline-code" id="329692679#-979a06_45">.min()</span> for length validation and <span class="inline-code" id="329692679#-979a06_46">.email()</span> for email format validation.</p></li><li class="list-item" id="329692679#-979a06_40"><p><span class="control" id="329692679#-979a06_48"><span class="inline-code" id="329692679#-979a06_49">z.number().positive()</span></span>: Ensures the number is positive.</p></li><li class="list-item" id="329692679#-979a06_41"><p><span class="control" id="329692679#-979a06_50"><span class="inline-code" id="329692679#-979a06_51">.optional()</span></span>: Specifies that the field is optional.</p></li></ul></section></section><section><h2 id="329692679#zod-with-express" data-toc="zod-with-express#Schema-Validation-Zod.md-zod-with-express">Zod with Express</h2><p id="329692679#-979a06_53">You can integrate Zod with Express for request validation, ensuring incoming data is valid before processing it in your application. Below are examples of how to use Zod for validating incoming data in routes.</p><section><h3 id="329692679#example-validating-request-body-in-an-express-route" data-toc="example-validating-request-body-in-an-express-route#Schema-Validation-Zod.md-example-validating-request-body-in-an-express-route">Example: Validating Request Body in an Express Route</h3><div class="detached code-block" id="329692679#-979a06_57"><pre><code class="language-javascript">import express from 'express';
import { z } from 'zod';

const app = express();
app.use(express.json());

const userSchema = z.object({
  name: z.string().min(3),
  email: z.string().email(),
  age: z.number().int().positive(),
});

app.post('/users', (req, res) =&gt; {
  try {
    // Validate request body against userSchema
    const userData = userSchema.parse(req.body);
    res.status(200).json({ message: 'User created successfully', data: userData });
  } catch (err) {
    res.status(400).json({ message: 'Validation failed', errors: err.errors });
  }
});

app.listen(3000, () =&gt; {
  console.log('Server running on http://localhost:3000');
});</code></pre></div><p id="329692679#-979a06_58">In this example:</p><ul class="list" id="329692679#-979a06_59" start="1"><li class="list-item" id="329692679#-979a06_60"><p><span class="control" id="329692679#-979a06_62"><span class="inline-code" id="329692679#-979a06_63">userSchema.parse(req.body)</span></span>: Validates the incoming request body against the defined schema. If validation passes, the user data is processed; if it fails, an error is returned.</p></li><li class="list-item" id="329692679#-979a06_61"><p><span class="control" id="329692679#-979a06_64">Error Handling</span>: If Zod&rsquo;s <span class="inline-code" id="329692679#-979a06_65">parse()</span> method throws an error, it will contain an array of validation errors, which can be sent back to the client.</p></li></ul></section><section><h3 id="329692679#example-request" data-toc="example-request#Schema-Validation-Zod.md-example-request">Example Request:</h3><div class="detached code-block" id="329692679#-979a06_66"><pre><code class="language-bash">curl -X POST http://localhost:3000/users -H &quot;Content-Type: application/json&quot; -d '{&quot;name&quot;: &quot;Jo&quot;, &quot;email&quot;: &quot;invalidemail&quot;, &quot;age&quot;: -5}'</code></pre></div><p id="329692679#-979a06_67">This would return:</p><div class="detached code-block" id="329692679#-979a06_68"><pre><code class="language-json">{
  &quot;message&quot;: &quot;Validation failed&quot;,
  &quot;errors&quot;: [
    { &quot;message&quot;: &quot;String must contain at least 3 character(s)&quot;, &quot;path&quot;: [&quot;name&quot;] },
    { &quot;message&quot;: &quot;Invalid email&quot;, &quot;path&quot;: [&quot;email&quot;] },
    { &quot;message&quot;: &quot;Number must be greater than 0&quot;, &quot;path&quot;: [&quot;age&quot;] }
  ]
}</code></pre></div></section></section><section><h2 id="329692679#complex-zod-schemas" data-toc="complex-zod-schemas#Schema-Validation-Zod.md-complex-zod-schemas">Complex Zod Schemas</h2><p id="329692679#-979a06_71">Zod allows you to build more complex schemas that include nested objects, arrays, enums, and more.</p><section><h3 id="329692679#nested-objects" data-toc="nested-objects#Schema-Validation-Zod.md-nested-objects">Nested Objects:</h3><p id="329692679#-979a06_76">You can define schemas for nested objects and validate them.</p><div class="detached code-block" id="329692679#-979a06_77"><pre><code class="language-javascript">const addressSchema = z.object({
  street: z.string(),
  city: z.string(),
  zipCode: z.string().regex(/^\d{5}$/, 'Invalid zip code format'),
});

const userSchema = z.object({
  id: z.number(),
  name: z.string(),
  email: z.string().email(),
  address: addressSchema, // Nested object
});

const userData = {
  id: 1,
  name: 'Jane Doe',
  email: 'jane@example.com',
  address: {
    street: '123 Main St',
    city: 'New York',
    zipCode: '10001',
  },
};

userSchema.parse(userData); // Validation passes</code></pre></div></section><section><h3 id="329692679#arrays" data-toc="arrays#Schema-Validation-Zod.md-arrays">Arrays:</h3><p id="329692679#-979a06_78">Zod allows you to validate arrays and ensure that every element in the array conforms to a schema.</p><div class="detached code-block" id="329692679#-979a06_79"><pre><code class="language-javascript">const postSchema = z.object({
  id: z.number(),
  title: z.string(),
});

const blogSchema = z.object({
  name: z.string(),
  posts: z.array(postSchema), // Array of posts
});

const blogData = {
  name: 'My Blog',
  posts: [
    { id: 1, title: 'First Post' },
    { id: 2, title: 'Second Post' },
  ],
};

blogSchema.parse(blogData); // Validation passes</code></pre></div></section><section><h3 id="329692679#enums" data-toc="enums#Schema-Validation-Zod.md-enums">Enums:</h3><p id="329692679#-979a06_80">You can define a set of valid values using Zod&rsquo;s <span class="inline-code" id="329692679#-979a06_83">z.enum()</span> method.</p><div class="detached code-block" id="329692679#-979a06_81"><pre><code class="language-javascript">const userTypeSchema = z.enum(['admin', 'user', 'guest']);

const userData = {
  id: 1,
  type: 'admin',
};

userTypeSchema.parse(userData.type); // Validation passes</code></pre></div></section></section><section><h2 id="329692679#asynchronous-validation" data-toc="asynchronous-validation#Schema-Validation-Zod.md-asynchronous-validation">Asynchronous Validation</h2><p id="329692679#-979a06_85">In some cases, validation might need to be asynchronous (e.g., validating data from an external API or checking if a record exists in a database). Zod allows you to write async validations with <span class="inline-code" id="329692679#-979a06_88">refine</span>.</p><section><h3 id="329692679#example-async-validation-with-refine" data-toc="example-async-validation-with-refine#Schema-Validation-Zod.md-example-async-validation-with-refine">Example: Async Validation with refine</h3><div class="detached code-block" id="329692679#-979a06_90"><pre><code class="language-javascript">const userSchema = z.object({
  email: z.string().email(),
}).refine(async (data) =&gt; {
  // Simulate checking if email exists in the database
  const emailExists = await fakeDatabaseCheck(data.email);
  return !emailExists;
}, {
  message: 'Email is already in use',
  path: ['email'],
});

async function fakeDatabaseCheck(email: string): Promise&lt;boolean&gt; {
  const existingEmails = ['existing@example.com'];
  return existingEmails.includes(email);
}

userSchema.parseAsync({ email: 'new@example.com' })
  .then(() =&gt; console.log('Valid email'))
  .catch(err =&gt; console.log('Validation failed', err.errors));</code></pre></div><p id="329692679#-979a06_91">In this example:</p><ul class="list" id="329692679#-979a06_92" start="1"><li class="list-item" id="329692679#-979a06_95"><p><span class="control" id="329692679#-979a06_97"><span class="inline-code" id="329692679#-979a06_98">refine()</span></span>: Adds a custom validation rule. Here, it checks if the email exists in a simulated database.</p></li><li class="list-item" id="329692679#-979a06_96"><p><span class="control" id="329692679#-979a06_99"><span class="inline-code" id="329692679#-979a06_100">parseAsync()</span></span>: Used for asynchronous schema validation.</p></li></ul></section></section><section><h2 id="329692679#custom-error-messages" data-toc="custom-error-messages#Schema-Validation-Zod.md-custom-error-messages">Custom Error Messages</h2><p id="329692679#-979a06_102">You can customize error messages to provide more meaningful feedback to the user.</p><div class="detached code-block" id="329692679#-979a06_103"><pre><code class="language-javascript">const userSchema = z.object({
  name: z.string().min(3, { message: 'Name must be at least 3 characters long' }),
  email: z.string().email({ message: 'Invalid email format' }),
});

try {
  userSchema.parse({ name: 'Jo', email: 'invalidemail' });
} catch (err) {
  console.log(err.errors);
}</code></pre></div><p id="329692679#-979a06_104">Output:</p><div class="detached code-block" id="329692679#-979a06_105"><pre><code class="language-json">[
  { &quot;message&quot;: &quot;Name must be at least 3 characters long&quot;, &quot;path&quot;: [&quot;name&quot;] },
  { &quot;message&quot;: &quot;Invalid email format&quot;, &quot;path&quot;: [&quot;email&quot;] }
]</code></pre></div></section><section><h2 id="329692679#integration-with-express-middleware" data-toc="integration-with-express-middleware#Schema-Validation-Zod.md-integration-with-express-middleware">Integration with Express Middleware</h2><p id="329692679#-979a06_109">You can create reusable validation middleware using Zod for Express. This middleware can be used to validate request bodies, query parameters, or route parameters.</p><section><h3 id="329692679#example-zod-validation-middleware" data-toc="example-zod-validation-middleware#Schema-Validation-Zod.md-example-zod-validation-middleware">Example: Zod Validation Middleware</h3><div class="detached code-block" id="329692679#-979a06_112"><pre><code class="language-javascript">import { Request, Response, NextFunction } from 'express';
import { z } from 'zod';

const validate = (schema: z.ZodSchema) =&gt; (req: Request, res: Response, next: NextFunction) =&gt; {
  try {
    schema.parse(req.body);
    next();
  } catch (err) {
    res.status(400).json({ errors: err.errors });
  }
};

const userSchema = z.object({
  name: z.string().min(3),
  email: z.string().email(),
});

app.post('/users', validate(userSchema), (req, res) =&gt; {
  res.status(200).json({ message: 'User created successfully' });
});</code></pre></div><p id="329692679#-979a06_113">In this example:</p><ul class="list" id="329692679#-979a06_114" start="1"><li class="list-item" id="329692679#-979a06_116"><p><span class="control" id="329692679#-979a06_117"><span class="inline-code" id="329692679#-979a06_118">validate</span></span>: Middleware that validates the request body against the provided schema and returns errors if validation fails.</p></li></ul></section></section><section><h2 id="329692679#summary" data-toc="summary#Schema-Validation-Zod.md-summary">Summary</h2><ul class="list" id="329692679#-979a06_119" start="1"><li class="list-item" id="329692679#-979a06_122"><p><span class="control" id="329692679#-979a06_126">Zod</span> is a TypeScript-first validation library that provides type-safe schemas for data validation.</p></li><li class="list-item" id="329692679#-979a06_123"><p><span class="control" id="329692679#-979a06_127">Basic Usage</span>: Zod schemas can be defined to validate simple types (strings, numbers) and more complex structures (nested objects, arrays, enums).</p></li><li class="list-item" id="329692679#-979a06_124"><p><span class="control" id="329692679#-979a06_128">Express Integration</span>: Zod can be integrated into Express routes to validate incoming request data. You can create reusable validation middleware for request bodies, query parameters, or route parameters.</p></li><li class="list-item" id="329692679#-979a06_125"><p>**Asynchronous Validation</p></li></ul><p id="329692679#-979a06_120">**: Use <span class="inline-code" id="329692679#-979a06_129">refine()</span> for custom async validation logic (e.g., checking database entries).</p><ul class="list" id="329692679#-979a06_121" start="1"><li class="list-item" id="329692679#-979a06_130"><p><span class="control" id="329692679#-979a06_132">Custom Error Messages</span>: You can provide more meaningful error messages using Zod&rsquo;s error message options.</p></li><li class="list-item" id="329692679#-979a06_131"><p><span class="control" id="329692679#-979a06_133">Middleware</span>: Zod can be wrapped into a middleware for cleaner and reusable validation handling in Express.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-407583414">JWT (Authentication &amp; Authorization)</h1><div class="container"><figure class="image-container"><img class="center image image-size" id="-407583414#gk5ywv_3" alt="Auth route" title="Auth route" src="E:/curiculum/Express-Typescript-Docs/Writerside/images/auth_route.png" width="1565" height="866"><figcaption class="center-text">Auth route</figcaption></figure></div><p id="-407583414#gk5ywv_4">JWT (JSON Web Token) is a compact and self-contained way of transmitting information between parties as a JSON object. It is often used for securing APIs by authenticating users via tokens rather than sessions.</p><p id="-407583414#gk5ywv_5">JWT consists of three parts:</p><ol class="list list-decimal" id="-407583414#gk5ywv_6" type="1" start="1"><li class="list-item" id="-407583414#gk5ywv_15"><p><span class="control" id="-407583414#gk5ywv_18">Header</span>: Contains information about the algorithm used (usually HS256).</p></li><li class="list-item" id="-407583414#gk5ywv_16"><p><span class="control" id="-407583414#gk5ywv_19">Payload</span>: Contains the claims (user data, permissions, etc.).</p></li><li class="list-item" id="-407583414#gk5ywv_17"><p><span class="control" id="-407583414#gk5ywv_20">Signature</span>: A unique string created by encoding the header and payload with a secret key.</p></li></ol><p id="-407583414#gk5ywv_7">In a typical JWT authentication setup, a client sends credentials (like email and password), the server validates them, and if successful, the server generates a JWT token, which the client can use to authenticate itself on subsequent requests.</p><section><h2 id="-407583414#a-token-creation" data-toc="a-token-creation#JWT-Authentication-Authorization.md-a-token-creation">a. Token Creation</h2><p id="-407583414#gk5ywv_22">To implement JWT in Express, you'll need the <span class="inline-code" id="-407583414#gk5ywv_28">jsonwebtoken</span> library to create and verify tokens.</p><section><h3 id="-407583414#installation" data-toc="installation#JWT-Authentication-Authorization.md-installation">Installation</h3><div class="detached code-block" id="-407583414#gk5ywv_30"><pre><code class="language-bash">npm install jsonwebtoken bcryptjs</code></pre></div><p id="-407583414#gk5ywv_31">Here, we'll also use <span class="inline-code" id="-407583414#gk5ywv_33">bcryptjs</span> for hashing passwords.</p></section><section><h3 id="-407583414#example-setup-generating-a-jwt-token" data-toc="example-setup-generating-a-jwt-token#JWT-Authentication-Authorization.md-example-setup-generating-a-jwt-token">Example Setup: Generating a JWT Token</h3><ol class="list list-decimal" id="-407583414#gk5ywv_35" type="1" start="1"><li class="list-item" id="-407583414#gk5ywv_38"><p><span class="control" id="-407583414#gk5ywv_39">Create a User Authentication Flow:</span></p></li></ol><ul class="list" id="-407583414#gk5ywv_36" start="1"><li class="list-item" id="-407583414#gk5ywv_40"><p>When the user logs in or signs up, the server generates a JWT token and sends it to the client. The client stores the token (usually in localStorage or cookies) and includes it in the <span class="inline-code" id="-407583414#gk5ywv_41">Authorization</span> header of subsequent requests.</p></li></ul></section><section><h3 id="-407583414#token-creation-example" data-toc="token-creation-example#JWT-Authentication-Authorization.md-token-creation-example">Token Creation Example</h3><div class="detached code-block" id="-407583414#gk5ywv_43"><pre><code class="language-javascript">import express from 'express';
import jwt from 'jsonwebtoken';
import bcrypt from 'bcryptjs';

const app = express();
const SECRET_KEY = 'your-secret-key'; // Ideally store this in environment variables

app.use(express.json());

// Mock user database
const users: { id: number, email: string, password: string }[] = [];

// Create a JWT token for a user
const createToken = (user: { id: number; email: string }) =&gt; {
  return jwt.sign({ id: user.id, email: user.email }, SECRET_KEY, { expiresIn: '1h' });
};

// Example user registration
app.post('/register', async (req, res) =&gt; {
  const { email, password } = req.body;

  // Hash the password before storing it
  const hashedPassword = await bcrypt.hash(password, 10);
  const newUser = { id: users.length + 1, email, password: hashedPassword };
  users.push(newUser);

  const token = createToken(newUser);
  res.status(201).json({ message: 'User registered successfully', token });
});

// Example user login
app.post('/login', async (req, res) =&gt; {
  const { email, password } = req.body;
  const user = users.find(u =&gt; u.email === email);

  if (!user || !(await bcrypt.compare(password, user.password))) {
    return res.status(401).json({ message: 'Invalid email or password' });
  }

  const token = createToken(user);
  res.json({ message: 'Login successful', token });
});

app.listen(3000, () =&gt; {
  console.log('Server running on http://localhost:3000');
});</code></pre></div><p id="-407583414#gk5ywv_44">In this setup:</p><ul class="list" id="-407583414#gk5ywv_45" start="1"><li class="list-item" id="-407583414#gk5ywv_47"><p><span class="control" id="-407583414#gk5ywv_49">Password Hashing</span>: User passwords are hashed using <span class="inline-code" id="-407583414#gk5ywv_50">bcryptjs</span> before being stored in the database (in this example, a simple in-memory array).</p></li><li class="list-item" id="-407583414#gk5ywv_48"><p><span class="control" id="-407583414#gk5ywv_51">JWT Token</span>: Upon successful login or registration, a JWT token is generated using <span class="inline-code" id="-407583414#gk5ywv_52">jwt.sign()</span>, with the user's ID and email as the payload. The token expires in 1 hour.</p></li></ul></section><section><h3 id="-407583414#example-request-for-token-creation-login" data-toc="example-request-for-token-creation-login#JWT-Authentication-Authorization.md-example-request-for-token-creation-login">Example Request for Token Creation (Login):</h3><div class="detached code-block" id="-407583414#gk5ywv_53"><pre><code class="language-bash">curl -X POST http://localhost:3000/login \
  -H &quot;Content-Type: application/json&quot; \
  -d '{&quot;email&quot;: &quot;john@example.com&quot;, &quot;password&quot;: &quot;secret&quot;}'</code></pre></div></section></section><section><h2 id="-407583414#b-user-management-api-authorization-authentication" data-toc="b-user-management-api-authorization-authentication#JWT-Authentication-Authorization.md-b-user-management-api-authorization-authentication">b. User Management API (Authorization &amp; Authentication)</h2><p id="-407583414#gk5ywv_56">JWT Authentication involves two key processes:</p><ol class="list list-decimal" id="-407583414#gk5ywv_57" type="1" start="1"><li class="list-item" id="-407583414#gk5ywv_62"><p><span class="control" id="-407583414#gk5ywv_64">Authentication</span>: Verifying the user's identity (logging in).</p></li><li class="list-item" id="-407583414#gk5ywv_63"><p><span class="control" id="-407583414#gk5ywv_65">Authorization</span>: Ensuring that a user has the correct permissions to access specific resources.</p></li></ol><section><h3 id="-407583414#1-authentication-protecting-routes-with-jwt" data-toc="1-authentication-protecting-routes-with-jwt#JWT-Authentication-Authorization.md-1-authentication-protecting-routes-with-jwt">1. Authentication: Protecting Routes with JWT</h3><p id="-407583414#gk5ywv_67">Once the token is created, the client sends the token in the <span class="inline-code" id="-407583414#gk5ywv_69">Authorization</span> header for protected routes. The server will verify the token using <span class="inline-code" id="-407583414#gk5ywv_70">jwt.verify()</span> to ensure that the token is valid.</p></section><section><h3 id="-407583414#example-of-protecting-a-route" data-toc="example-of-protecting-a-route#JWT-Authentication-Authorization.md-example-of-protecting-a-route">Example of Protecting a Route:</h3><div class="detached code-block" id="-407583414#gk5ywv_71"><pre><code class="language-javascript">// Middleware to verify the JWT token
const authenticateToken = (req: express.Request, res: express.Response, next: express.NextFunction) =&gt; {
  const authHeader = req.headers['authorization'];
  const token = authHeader &amp;&amp; authHeader.split(' ')[1]; // Bearer token

  if (!token) return res.status(401).json({ message: 'No token provided' });

  jwt.verify(token, SECRET_KEY, (err, user) =&gt; {
    if (err) return res.status(403).json({ message: 'Invalid or expired token' });

    req.user = user; // Attach user info to the request object
    next(); // Proceed to the next middleware or route handler
  });
};

// Protected route
app.get('/protected', authenticateToken, (req, res) =&gt; {
  res.json({ message: `Welcome, user with email ${req.user.email}`, user: req.user });
});</code></pre></div><p id="-407583414#gk5ywv_72">In this example:</p><ul class="list" id="-407583414#gk5ywv_73" start="1"><li class="list-item" id="-407583414#gk5ywv_74"><p><span class="control" id="-407583414#gk5ywv_76"><span class="inline-code" id="-407583414#gk5ywv_77">authenticateToken</span> Middleware</span>: Verifies the token sent by the client. If the token is valid, it adds the user data to the request object and allows access to the protected route.</p></li><li class="list-item" id="-407583414#gk5ywv_75"><p><span class="control" id="-407583414#gk5ywv_78">Protected Route</span>: Only accessible if the client sends a valid JWT token.</p></li></ul></section><section><h3 id="-407583414#example-request-to-a-protected-route" data-toc="example-request-to-a-protected-route#JWT-Authentication-Authorization.md-example-request-to-a-protected-route">Example Request to a Protected Route:</h3><div class="detached code-block" id="-407583414#gk5ywv_79"><pre><code class="language-bash">curl -X GET http://localhost:3000/protected \
  -H &quot;Authorization: Bearer &lt;your-jwt-token&gt;&quot;</code></pre></div><p id="-407583414#gk5ywv_80">If the token is valid, the server will return the protected data. Otherwise, it will respond with a <span class="inline-code" id="-407583414#gk5ywv_82">401 Unauthorized</span> or <span class="inline-code" id="-407583414#gk5ywv_83">403 Forbidden</span> status.</p></section></section><section><h2 id="-407583414#authorization-role-based-access-control-rbac" data-toc="authorization-role-based-access-control-rbac#JWT-Authentication-Authorization.md-authorization-role-based-access-control-rbac">Authorization: Role-based Access Control (RBAC)</h2><p id="-407583414#gk5ywv_85">You can add an additional layer of authorization by assigning roles to users (e.g., &quot;admin&quot;, &quot;user&quot;) and verifying their permissions when accessing certain routes.</p><section><h3 id="-407583414#example-role-based-authorization" data-toc="example-role-based-authorization#JWT-Authentication-Authorization.md-example-role-based-authorization">Example: Role-based Authorization</h3><ol class="list list-decimal" id="-407583414#gk5ywv_89" type="1" start="1"><li class="list-item" id="-407583414#gk5ywv_95"><p><span class="control" id="-407583414#gk5ywv_96">Adding Roles to JWT Token</span>: When generating the JWT token, include the user's role in the payload.</p></li></ol><div class="detached code-block" id="-407583414#gk5ywv_90"><pre><code class="language-javascript">const createToken = (user: { id: number; email: string; role: string }) =&gt; {
  return jwt.sign({ id: user.id, email: user.email, role: user.role }, SECRET_KEY, { expiresIn: '1h' });
};</code></pre></div><ol class="list list-decimal" id="-407583414#gk5ywv_91" type="1" start="2"><li class="list-item" id="-407583414#gk5ywv_97"><p><span class="control" id="-407583414#gk5ywv_98">Role-based Middleware</span>: Create middleware to check if the authenticated user has the correct role to access a resource.</p></li></ol><div class="detached code-block" id="-407583414#gk5ywv_92"><pre><code class="language-javascript">const authorizeRole = (role: string) =&gt; {
  return (req: express.Request, res: express.Response, next: express.NextFunction) =&gt; {
    if (req.user.role !== role) {
      return res.status(403).json({ message: 'Access forbidden: Insufficient permissions' });
    }
    next();
  };
};

// Example protected route only accessible by admins
app.get('/admin', authenticateToken, authorizeRole('admin'), (req, res) =&gt; {
  res.json({ message: 'Welcome Admin!' });
});</code></pre></div><p id="-407583414#gk5ywv_93">In this setup:</p><ul class="list" id="-407583414#gk5ywv_94" start="1"><li class="list-item" id="-407583414#gk5ywv_99"><p><span class="control" id="-407583414#gk5ywv_100"><span class="inline-code" id="-407583414#gk5ywv_101">authorizeRole</span> Middleware</span>: Checks if the authenticated user has the required role to access the route.</p></li></ul></section><section><h3 id="-407583414#example-user-login-with-role" data-toc="example-user-login-with-role#JWT-Authentication-Authorization.md-example-user-login-with-role">Example User Login with Role:</h3><div class="detached code-block" id="-407583414#gk5ywv_102"><pre><code class="language-javascript">// Mock user data with roles
const users: { id: number, email: string, password: string, role: string }[] = [
  { id: 1, email: 'admin@example.com', password: 'hashedpassword', role: 'admin' },
  { id: 2, email: 'user@example.com', password: 'hashedpassword', role: 'user' },
];</code></pre></div></section></section><section><h2 id="-407583414#handling-token-expiration-and-refresh-tokens" data-toc="handling-token-expiration-and-refresh-tokens#JWT-Authentication-Authorization.md-handling-token-expiration-and-refresh-tokens">Handling Token Expiration and Refresh Tokens</h2><p id="-407583414#gk5ywv_105">JWT tokens are often set to expire after a short time (e.g., 1 hour) to reduce security risks. You can issue a new token by implementing a <span class="control" id="-407583414#gk5ywv_109">refresh token</span> strategy.</p><ol class="list list-decimal" id="-407583414#gk5ywv_106" type="1" start="1"><li class="list-item" id="-407583414#gk5ywv_110"><p><span class="control" id="-407583414#gk5ywv_112">Access Token</span>: Short-lived token used for API requests.</p></li><li class="list-item" id="-407583414#gk5ywv_111"><p><span class="control" id="-407583414#gk5ywv_113">Refresh Token</span>: Longer-lived token stored securely on the client side, used to request a new access token when it expires.</p></li></ol><section><h3 id="-407583414#example-of-refresh-token-flow" data-toc="example-of-refresh-token-flow#JWT-Authentication-Authorization.md-example-of-refresh-token-flow">Example of Refresh Token Flow:</h3><div class="detached code-block" id="-407583414#gk5ywv_114"><pre><code class="language-javascript">const refreshTokens: string[] = []; // In-memory store for refresh tokens

// Generate a new refresh token
const createRefreshToken = (user: { id: number; email: string }) =&gt; {
  const refreshToken = jwt.sign({ id: user.id, email: user.email }, SECRET_KEY, { expiresIn: '7d' });
  refreshTokens.push(refreshToken); // Store refresh token
  return refreshToken;
};

// Route to generate new access token using refresh token
app.post('/token', (req, res) =&gt; {
  const { token } = req.body;
  if (!token || !refreshTokens.includes(token)) {
    return res.status(403).json({ message: 'Invalid refresh token' });
  }

  jwt.verify(token, SECRET_KEY, (err, user) =&gt; {
    if (err) return res.status(403).json({ message: 'Invalid refresh token' });

    const accessToken = createToken(user);
    res.json({ accessToken });
  });
});</code></pre></div><p id="-407583414#gk5ywv_115">In this setup:</p><ul class="list" id="-407583414#gk5ywv_116" start="1"><li class="list-item" id="-407583414#gk5ywv_118"><p><span class="control" id="-407583414#gk5ywv_120">Refresh Token Store</span>: Refresh tokens are stored in memory (for simplicity), but you should store them securely (e.g., in a database or Redis).</p></li><li class="list-item" id="-407583414#gk5ywv_119"><p><span class="control" id="-407583414#gk5ywv_121">Token Generation</span>: When the access token expires, the client sends the refresh token to the server to get a new access token.</p></li></ul></section></section><section><h2 id="-407583414#complete-user-management-api-example" data-toc="complete-user-management-api-example#JWT-Authentication-Authorization.md-complete-user-management-api-example">Complete User Management API Example</h2><div class="detached code-block" id="-407583414#gk5ywv_123"><pre><code class="language-javascript">import express from 'express';
import jwt from 'jsonwebtoken';
import bcrypt from 'bcryptjs';

const app = express();
const SECRET_KEY = 'your-secret-key';
const users:

 { id: number, email: string, password: string, role: string }[] = [];

app.use(express.json());

const createToken = (user: { id: number; email: string; role: string }) =&gt; {
  return jwt.sign({ id: user.id, email: user.email, role: user.role }, SECRET_KEY, { expiresIn: '1h' });
};

const authenticateToken = (req: express.Request, res: express.Response, next: express.NextFunction) =&gt; {
  const authHeader = req.headers['authorization'];
  const token = authHeader &amp;&amp; authHeader.split(' ')[1];
  if (!token) return res.status(401).json({ message: 'No token provided' });

  jwt.verify(token, SECRET_KEY, (err, user) =&gt; {
    if (err) return res.status(403).json({ message: 'Invalid or expired token' });
    req.user = user;
    next();
  });
};

// Register
app.post('/register', async (req, res) =&gt; {
  const { email, password, role } = req.body;
  const hashedPassword = await bcrypt.hash(password, 10);
  const newUser = { id: users.length + 1, email, password: hashedPassword, role };
  users.push(newUser);
  const token = createToken(newUser);
  res.status(201).json({ message: 'User registered', token });
});

// Login
app.post('/login', async (req, res) =&gt; {
  const { email, password } = req.body;
  const user = users.find(u =&gt; u.email === email);
  if (!user || !(await bcrypt.compare(password, user.password))) {
    return res.status(401).json({ message: 'Invalid credentials' });
  }
  const token = createToken(user);
  res.json({ message: 'Login successful', token });
});

// Protected route
app.get('/profile', authenticateToken, (req, res) =&gt; {
  res.json({ message: `Welcome, user with email ${req.user.email}`, user: req.user });
});

app.listen(3000, () =&gt; console.log('Server running on http://localhost:3000'));</code></pre></div></section><section><h2 id="-407583414#summary" data-toc="summary#JWT-Authentication-Authorization.md-summary">Summary</h2><ul class="list" id="-407583414#gk5ywv_126" start="1"><li class="list-item" id="-407583414#gk5ywv_127"><p><span class="control" id="-407583414#gk5ywv_131">Token Creation</span>: JWT tokens are generated using <span class="inline-code" id="-407583414#gk5ywv_132">jsonwebtoken</span>. They contain user data and expire after a set time.</p></li><li class="list-item" id="-407583414#gk5ywv_128"><p><span class="control" id="-407583414#gk5ywv_133">Authentication</span>: The token is sent in the <span class="inline-code" id="-407583414#gk5ywv_134">Authorization</span> header for protected routes and verified using middleware.</p></li><li class="list-item" id="-407583414#gk5ywv_129"><p><span class="control" id="-407583414#gk5ywv_135">Authorization</span>: Role-based access control (RBAC) can be implemented to restrict certain routes based on user roles.</p></li><li class="list-item" id="-407583414#gk5ywv_130"><p><span class="control" id="-407583414#gk5ywv_136">Refresh Tokens</span>: Used to refresh access tokens when they expire, allowing for secure and scalable authentication.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-2125346110">Developing An API</h1><p id="-2125346110#d9rm2n_3">Here's a step-by-step guide on how to create the API you shared from scratch using Node.js, TypeScript, Express, and various other tools and libraries that are shown in your code:</p><section><h2 id="-2125346110#project-overview" data-toc="project-overview#Developing-An-API.md-project-overview">Project Overview</h2><p id="-2125346110#d9rm2n_5">The two images depict how a typical JWT (JSON Web Token) based authentication flow and Express.js middleware architecture can work in an application built using TypeScript and Express.js.</p><section><h3 id="-2125346110#express-js-application-architecture" data-toc="express-js-application-architecture#Developing-An-API.md-express-js-application-architecture">Express.js Application Architecture</h3><div class="container"><figure class="image-container"><img class="center image image-size" id="-2125346110#d9rm2n_19" alt="App flow" title="App flow" src="E:/curiculum/Express-Typescript-Docs/Writerside/images/app%20flow.png" width="2212" height="556"><figcaption class="center-text">App flow</figcaption></figure></div><p id="-2125346110#d9rm2n_20">This diagram showcases how different parts of the application interact when a request is made.</p><ol class="list list-decimal" id="-2125346110#d9rm2n_21" type="1" start="1"><li class="list-item" id="-2125346110#d9rm2n_23"><p><span class="control" id="-2125346110#d9rm2n_29">HTTP Endpoint</span>: This represents an HTTP request sent to the server. It could be a request to a specific route like <span class="inline-code" id="-2125346110#d9rm2n_30">/api/users</span>.</p></li><li class="list-item" id="-2125346110#d9rm2n_24"><p><span class="control" id="-2125346110#d9rm2n_31">Middleware</span>: This is the middleware layer, which typically handles things like authentication, validation, logging, or error handling. In this case, it can be processing JWT tokens, such as validating tokens before requests are forwarded.</p></li><li class="list-item" id="-2125346110#d9rm2n_25"><p><span class="control" id="-2125346110#d9rm2n_32">Controller</span>: The controller is responsible for handling the business logic associated with the request. It might invoke specific services or methods to handle the logic of a request.</p></li><li class="list-item" id="-2125346110#d9rm2n_26"><p><span class="control" id="-2125346110#d9rm2n_33">Service</span>: The service layer contains the actual business logic and operations that the controller may require. It handles more specific tasks like interacting with external services or applying core business rules.</p></li><li class="list-item" id="-2125346110#d9rm2n_27"><p><span class="control" id="-2125346110#d9rm2n_28">Database</span>: The final component is the database, which the service interacts with to fetch, store, or modify data.</p></li></ol><p id="-2125346110#d9rm2n_22">In this Express.js setup, the middleware is critical for ensuring valid requests (like JWT token verification) before the controller logic is executed.</p></section><section><h3 id="-2125346110#how-this-works-together-in-express-js-with-jwt-and-typescript" data-toc="how-this-works-together-in-express-js-with-jwt-and-typescript#Developing-An-API.md-how-this-works-together-in-express-js-with-jwt-and-typescript">How this Works Together in Express.js with JWT and TypeScript:</h3><ul class="list" id="-2125346110#d9rm2n_34" start="1"><li class="list-item" id="-2125346110#d9rm2n_35"><p><span class="control" id="-2125346110#d9rm2n_38">Express.js</span>: Manages the routes, handling incoming HTTP requests, and applying middleware for validation.</p></li><li class="list-item" id="-2125346110#d9rm2n_36"><p><span class="control" id="-2125346110#d9rm2n_39">JWT</span>: Used to secure the routes and manage user sessions, validating tokens and issuing new ones if needed.</p></li><li class="list-item" id="-2125346110#d9rm2n_37"><p><span class="control" id="-2125346110#d9rm2n_40">TypeScript</span>: Adds type safety and structure, making it easier to develop large-scale applications while ensuring the right types are enforced at compile time.</p></li></ul></section><section><h3 id="-2125346110#jwt-authentication-flow" data-toc="jwt-authentication-flow#Developing-An-API.md-jwt-authentication-flow">JWT Authentication Flow</h3><div class="container"><figure class="image-container"><img class="center image image-size" id="-2125346110#d9rm2n_41" alt="Token flow" title="Token flow" src="E:/curiculum/Express-Typescript-Docs/Writerside/images/token%20flow.png" width="1636" height="1060"><figcaption class="center-text">Token flow</figcaption></figure></div><ol class="list list-decimal" id="-2125346110#d9rm2n_42" type="1" start="1"><li class="list-item" id="-2125346110#d9rm2n_43"><p><span class="control" id="-2125346110#d9rm2n_47">Authorized Request</span>: A request comes in with an access token.</p></li><li class="list-item" id="-2125346110#d9rm2n_44"><p><span class="control" id="-2125346110#d9rm2n_48">Is the Access Token Valid?</span>: </p><ul class="list" id="-2125346110#d9rm2n_49" start="1"><li class="list-item" id="-2125346110#d9rm2n_50"><p>The system first checks if the provided access token is valid (properly signed, etc.).</p></li><li class="list-item" id="-2125346110#d9rm2n_51"><p>If <span class="control" id="-2125346110#d9rm2n_53">No</span>, the system returns an unauthorized error.</p></li><li class="list-item" id="-2125346110#d9rm2n_52"><p>If <span class="control" id="-2125346110#d9rm2n_54">Yes</span>, it moves to the next step.</p></li></ul></li><li class="list-item" id="-2125346110#d9rm2n_45"><p><span class="control" id="-2125346110#d9rm2n_55">Has the Access Token Expired?</span>: </p><ul class="list" id="-2125346110#d9rm2n_56" start="1"><li class="list-item" id="-2125346110#d9rm2n_57"><p>The next check is whether the token has expired.</p></li><li class="list-item" id="-2125346110#d9rm2n_58"><p>If <span class="control" id="-2125346110#d9rm2n_60">No</span>, the request is processed, and it moves to the route handler.</p></li><li class="list-item" id="-2125346110#d9rm2n_59"><p>If <span class="control" id="-2125346110#d9rm2n_61">Yes</span>, it checks the next condition.</p></li></ul></li><li class="list-item" id="-2125346110#d9rm2n_46"><p><span class="control" id="-2125346110#d9rm2n_62">Is a Valid Refresh Token Included?</span>: </p><ul class="list" id="-2125346110#d9rm2n_63" start="1"><li class="list-item" id="-2125346110#d9rm2n_64"><p>If the token is expired, the system checks whether a valid refresh token is included in the request.</p></li><li class="list-item" id="-2125346110#d9rm2n_65"><p>If <span class="control" id="-2125346110#d9rm2n_67">Yes</span>, a new access token is issued, and the request is processed.</p></li><li class="list-item" id="-2125346110#d9rm2n_66"><p>If <span class="control" id="-2125346110#d9rm2n_68">No</span>, the system returns an unauthorized error.</p></li></ul></li></ol></section><section><h3 id="-2125346110#1-setting-up-the-project" data-toc="1-setting-up-the-project#Developing-An-API.md-1-setting-up-the-project">1. Setting Up the Project</h3><ol class="list list-decimal" id="-2125346110#d9rm2n_70" type="1" start="1"><li class="list-item" id="-2125346110#d9rm2n_72"><p id="-2125346110#d9rm2n_76"><span class="control" id="-2125346110#d9rm2n_79">Initialize the Node.js Project:</span></p><p id="-2125346110#d9rm2n_77">Open your terminal in the root directory where you want to create your project, then run:</p><div class="detached code-block" id="-2125346110#d9rm2n_78"><pre><code class="language-bash">mkdir user-management-api
cd user-management-api
npm init -y</code></pre></div></li><li class="list-item" id="-2125346110#d9rm2n_73"><p id="-2125346110#d9rm2n_80"><span class="control" id="-2125346110#d9rm2n_84">Install Required Dependencies:</span></p><p id="-2125346110#d9rm2n_81">Install the dependencies listed in the <span class="inline-code" id="-2125346110#d9rm2n_85">package.json</span> file from your project. These include <span class="inline-code" id="-2125346110#d9rm2n_86">express</span>, <span class="inline-code" id="-2125346110#d9rm2n_87">typescript</span>, <span class="inline-code" id="-2125346110#d9rm2n_88">zod</span>, <span class="inline-code" id="-2125346110#d9rm2n_89">bcrypt</span>, <span class="inline-code" id="-2125346110#d9rm2n_90">jsonwebtoken</span>, <span class="inline-code" id="-2125346110#d9rm2n_91">swagger-ui-express</span>, and others.</p><p id="-2125346110#d9rm2n_82">Run:</p><div class="detached code-block" id="-2125346110#d9rm2n_83"><pre><code class="language-bash">npm install express bcrypt cors dotenv helmet jsonwebtoken morgan multer pino pino-pretty prom-client swagger-jsdoc swagger-ui-express uuid zod</code></pre></div></li><li class="list-item" id="-2125346110#d9rm2n_74"><p id="-2125346110#d9rm2n_92"><span class="control" id="-2125346110#d9rm2n_95">Install Development Dependencies:</span></p><p id="-2125346110#d9rm2n_93">Install TypeScript and other development dependencies for type definitions and TypeScript compilation.</p><div class="detached code-block" id="-2125346110#d9rm2n_94"><pre><code class="language-bash">npm install -D @types/bcrypt @types/cors @types/express @types/jsonwebtoken @types/morgan @types/mssql @types/multer @types/node @types/swagger-jsdoc @types/swagger-ui-express tsx typescript</code></pre></div></li><li class="list-item" id="-2125346110#d9rm2n_75"><p id="-2125346110#d9rm2n_96"><span class="control" id="-2125346110#d9rm2n_99">Set Up TypeScript Configuration:</span></p><p id="-2125346110#d9rm2n_97">Create a <span class="inline-code" id="-2125346110#d9rm2n_100">tsconfig.json</span> file and configure it like this:</p><div class="detached code-block" id="-2125346110#d9rm2n_98"><pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;ES2022&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;rootDir&quot;: &quot;./src&quot;,
    &quot;outDir&quot;: &quot;./dist&quot;,
    &quot;esModuleInterop&quot;: true,
    &quot;forceConsistentCasingInFileNames&quot;: true,
    &quot;strict&quot;: true,
    &quot;skipLibCheck&quot;: true
  },
  &quot;exclude&quot;: [&quot;node_modules&quot;, &quot;dist&quot;],
  &quot;include&quot;: [&quot;src/**/*.ts&quot;]
}</code></pre></div></li></ol></section><section><h3 id="-2125346110#2-project-structure" data-toc="2-project-structure#Developing-An-API.md-2-project-structure">2. Project Structure</h3><p id="-2125346110#d9rm2n_102">Your project should have a folder structure similar to the one you provided:</p><div class="detached code-block" id="-2125346110#d9rm2n_103"><pre><code class="language-none">project-root
│
├── src
│   ├── config
│   ├── controllers
│   ├── middleware
│   ├── models
│   ├── routes
│   ├── schemas
│   ├── services
│   ├── types
│   ├── app.ts
│   ├── server.ts
├── .env
├── .gitignore
├── package.json
├── tsconfig.json
└── README.md</code></pre></div></section><section><h3 id="-2125346110#3-environment-variables" data-toc="3-environment-variables#Developing-An-API.md-3-environment-variables">3. Environment Variables</h3><p id="-2125346110#d9rm2n_107">Set up environment variables for sensitive data such as database credentials and JWT secrets. Create a <span class="inline-code" id="-2125346110#d9rm2n_111">.env</span> file with the following content:</p><div class="detached code-block" id="-2125346110#d9rm2n_108"><pre><code class="language-bash">PORT=5000
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_DATABASE=your_database
DB_SERVER=your_db_server
JWT_SECRET=your_jwt_secret</code></pre></div></section><section><h3 id="-2125346110#4-setting-up-express" data-toc="4-setting-up-express#Developing-An-API.md-4-setting-up-express">4. Setting Up Express</h3><p id="-2125346110#d9rm2n_113">In <span class="inline-code" id="-2125346110#d9rm2n_117">src/app.ts</span>, set up the basic Express application:</p><div class="detached code-block" id="-2125346110#d9rm2n_114"><pre><code class="language-javascript">// src/app.ts
import express, { Request, Response } from 'express';
import helmet from 'helmet';
import cors from 'cors';
import rateLimiter from './middleware/rateLimiter';
import userRoutes from './routes/userRoutes';
import productRoutes from './routes/productRoutes';
import setupSwagger from './config/swagger';
import { metricsMiddleware, metricsRoute } from './middleware/metrics';
import morgan from 'morgan';
import { config } from './config';

const app = express();

// Security middleware
app.use(helmet());

// Enable CORS
app.use(cors());

// Body parsing middleware
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Alternatively, using morgan
app.use(morgan('combined'));

// Rate limiting
app.use(rateLimiter);

// Metrics middleware
app.use(metricsMiddleware);

// Routes
app.use('/api', userRoutes);
app.use('/api/products', productRoutes);

// Metrics endpoint
app.get('/metrics', metricsRoute);

// Swagger documentation
setupSwagger(app, config.port);

// Health check
app.get('/health', (req: Request, res: Response) =&gt; {
  res.status(200).json({ status: 'UP' });
});

export default app;</code></pre></div></section><section><h3 id="-2125346110#5-user-routes-and-controllers" data-toc="5-user-routes-and-controllers#Developing-An-API.md-5-user-routes-and-controllers">5. User Routes and Controllers</h3><p id="-2125346110#d9rm2n_119">In <span class="inline-code" id="-2125346110#d9rm2n_123">src/routes/userRoutes.ts</span>, define your user-related routes:</p><div class="detached code-block" id="-2125346110#d9rm2n_120"><pre><code class="language-javascript">import express from 'express';
import {
  register,
  login,
  getUserSessions,
  logout,
  logoutFromAllSessions,
  getAllUsersController
} from '../controllers/userController';
import { requireUser } from '../middleware/requireUser';
import { deserializeUser } from '../middleware/deserializeUser';
import { refreshToken } from '../middleware/refreshToken';
import zodValidate from '../middleware/zodValidate';
import { registerSchema, loginSchema, logoutSchema, userIdSchema } from '../schemas/userSchemas';

const userRoutes = express.Router();

userRoutes.use(deserializeUser);

/**
 * @openapi
 * tags:
 *   name: Users
 *   description: User management and authentication
 */

/**
 * @openapi
 * /users/register:
 *   post:
 *     summary: Register a new user
 *     tags: [Users]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             $ref: '#/components/schemas/RegisterRequest'
 *     responses:
 *       201:
 *         description: User registered successfully
 *         content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/User'
 *       400:
 *         description: Bad request
 */
userRoutes.post('/users/register', zodValidate(registerSchema), register);

/**
 * @openapi
 * /users/login:
 *   post:
 *     summary: Login a user
 *     tags: [Users]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             $ref: '#/components/schemas/LoginRequest'
 *     responses:
 *       200:
 *         description: User logged in successfully
 *         content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/LoginResponse'
 *       401:
 *         description: Unauthorized
 */
userRoutes.post('/users/login', zodValidate(loginSchema), login);

/**
 * @openapi
 * /users/sessions:
 *   get:
 *     summary: Get user sessions
 *     tags: [Users]
 *     security:
 *       - bearerAuth: []
 *     responses:
 *       200:
 *         description: List of user sessions
 *         content:
 *           application/json:
 *             schema:
 *               type: array
 *               items:
 *                 $ref: '#/components/schemas/Session'
 *       401:
 *         description: Unauthorized
 */
userRoutes.get('/users/sessions', requireUser, getUserSessions);

/**
 * @openapi
 * /users/logout:
 *   post:
 *     summary: Logout from current session
 *     tags: [Users]
 *     security:
 *       - bearerAuth: []
 *     responses:
 *       200:
 *         description: Logged out successfully
 *       401:
 *         description: Unauthorized
 */
userRoutes.post('/users/logout', zodValidate(logoutSchema), requireUser, logout);

/**
 * @openapi
 * /users/logout-all:
 *   post:
 *     summary: Logout from all sessions
 *     tags: [Users]
 *     security:
 *       - bearerAuth: []
 *     responses:
 *       200:
 *         description: Logged out from all sessions successfully
 *       401:
 *         description: Unauthorized
 */
userRoutes.post('/users/logout-all', zodValidate(userIdSchema), deserializeUser, requireUser, logoutFromAllSessions);

/**
 * @openapi
 * /users:
 *   get:
 *     summary: Get all users
 *     tags: [Users]
 *     security:
 *       - bearerAuth: []
 *     responses:
 *       200:
 *         description: List of all users
 *         content:
 *           application/json:
 *             schema:
 *               type: array
 *               items:
 *                 $ref: '#/components/schemas/User'
 *       401:
 *         description: Unauthorized
 */
userRoutes.get('/users', requireUser, getAllUsersController);

/**
 * @openapi
 * /users/refresh-token:
 *   post:
 *     summary: Refresh access token
 *     tags: [Users]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             $ref: '#/components/schemas/RefreshTokenRequest'
 *     responses:
 *       200:
 *         description: Tokens refreshed successfully
 *         content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/RefreshTokenResponse'
 *       401:
 *         description: Unauthorized
 */
userRoutes.post('/users/refresh-token', refreshToken);

export default userRoutes;</code></pre></div></section><section><h3 id="-2125346110#6-user-controller" data-toc="6-user-controller#Developing-An-API.md-6-user-controller">6. User Controller</h3><p id="-2125346110#d9rm2n_125">In <span class="inline-code" id="-2125346110#d9rm2n_129">src/controllers/userController.ts</span>, implement the controller logic for each endpoint:</p><div class="detached code-block" id="-2125346110#d9rm2n_126"><pre><code class="language-javascript">// src/controllers/userController.ts
import { Request, Response } from 'express';
import { deleteAllSessions, deleteSession, getAllUsers, getSessions, loginUser, registerUser } from '../services/userService';
import { AuthRequest } from &quot;../middleware/deserializeUser&quot;;
import { RegisterRequest } from '../models/User';

// User Registration Endpoint
export const register = async (req: Request, res: Response) =&gt; {
    const newUser: RegisterRequest = req.body;
    const profileImage = req.file?.path;

    try {
        const user = await registerUser(newUser.username, newUser.email, newUser.password, profileImage);
        res.status(201).json({ message: 'User registered successfully.', user: { id: user.id, username: user.username, email: user.email } });
    } catch (error: any) {
        res.status(500).json({ message: 'Registration failed.', error: error.message });
    }
};

// User Login Endpoint
export const login = async (req: Request, res: Response) =&gt; {
    const { email, password } = req.body;

    try {
        const { accessToken, refreshToken, user } = await loginUser(email, password);
        res.status(200).json({ message: 'Login successful', accessToken, refreshToken, user });
    } catch (error: any) {
        res.status(401).json({ message: 'Login failed', error: error.message });
    }
};

// Get all Sessions : getting all active sessions for the current user:
export const getUserSessions = async (req: AuthRequest, res: Response) =&gt; {
    if (!req.user) {
        return res.status(401).json({ message: 'Unauthorized' });
    }

    const userId = req.user.id;  // Ensure to attach the user in the deserialization process
    console.log(userId)
    try {
        const sessions = await getSessions(userId);
        res.status(200).json(sessions);
    } catch (error: any) {
        res.status(500).json({ message: 'Could not retrieve sessions', error: error.message });
    }
};

// Delete Session (logout from a single device)
export const logout = async (req: Request, res: Response) =&gt; {
    const { refreshToken } = req.body; // The refresh token to invalidate

    try {
        await deleteSession(refreshToken);
        res.status(200).json({ message: 'Logged out successfully' });
    } catch (error) {
        res.status(500).json({ message: 'Failed to log out', error });
    }
};

// Delete All Session (logout from all devices)
export const logoutFromAllSessions = async (req: AuthRequest, res: Response) =&gt; {
    const userId = (req as any).user.id;

    try {
        await deleteAllSessions(userId);
        res.status(200).json({ message: 'Logged out from all devices' });
    } catch (error) {
        res.status(500).json({ message: 'Failed to log out from all devices', error });
    }
};

// Get All Users Endpoint
export const getAllUsersController = async (req: Request, res: Response) =&gt; {
    try {
        const users = await getAllUsers();
        res.status(200).json({ users });
    } catch (error) {
        res.status(500).json({ message: 'Failed to retrieve users.', error });
    }
};</code></pre></div></section><section><h3 id="-2125346110#7-user-service" data-toc="7-user-service#Developing-An-API.md-7-user-service">7. User Service</h3><p id="-2125346110#d9rm2n_131">In <span class="inline-code" id="-2125346110#d9rm2n_135">src/services/userService.ts</span>, create the actual logic for handling user data, sessions, and authentication:</p><div class="detached code-block" id="-2125346110#d9rm2n_132"><pre><code class="language-javascript">// src/services/userService.ts
import db from '../config/db';
import { User, LoginResponse } from '../models/User';
import bcrypt from 'bcrypt';
import { v4 as uuidv4 } from 'uuid';
import jwt from 'jsonwebtoken';
import { config } from '../config';


//register user
export const registerUser = async (username: string, email: string, password: string, profileImage?: string): Promise&lt;User&gt; =&gt; {
    const hashedPassword = await bcrypt.hash(password, 10);
    const user: User = {
        id: uuidv4(),
        username,
        email,
        password: hashedPassword,
        profileImage,
        createdAt: new Date(),
        updatedAt: new Date(),
    };

    await db.poolConnect;
    const request = db.pool.request();
    await request
        .input('id', db.sql.VarChar, user.id)
        .input('username', db.sql.VarChar, user.username)
        .input('email', db.sql.VarChar, user.email)
        .input('password', db.sql.VarChar, user.password)
        .input('profileImage', db.sql.VarChar, user.profileImage || null)
        .input('createdAt', db.sql.DateTime, user.createdAt)
        .input('updatedAt', db.sql.DateTime, user.updatedAt)
        .query(`
            INSERT INTO Users (id, username, email, password, profileImage, createdAt, updatedAt)
            VALUES (@id, @username, @email, @password, @profileImage, @createdAt, @updatedAt)
        `);
    return user;
};

// login user
export const loginUser = async (email: string, password: string): Promise&lt;LoginResponse&gt; =&gt; {
    const user = await getUserByEmail(email);
   
    if (!user) throw new Error('User not Found')

    const isPasswordValid = await bcrypt.compare(password, user.password);

    if (!isPasswordValid) throw new Error('Invalid credentials');

    const accessToken = jwt.sign({ id: user.id, email: user.email }, config.jwtSecret, { expiresIn: '15m' });
    const refreshToken = jwt.sign({ id: user.id, email: user.email }, config.jwtSecret, { expiresIn: '7d' });

    await storeRefreshToken(user.id, refreshToken);

    return {
        accessToken,
        refreshToken,
        user: {
            id: user.id,
            username: user.username,
            email: user.email,
        },
    };
};

// get user via email
export const getUserByEmail = async (email: string): Promise&lt;User&gt; =&gt; {
    await db.poolConnect;
    const request = db.pool.request();
    const result = await request
        .input('email', db.sql.VarChar, email)
        .query('SELECT * FROM users WHERE email = @email')

    return result.recordset[0];
}
// read all users
export const getAllUsers = async (): Promise&lt;Partial&lt;User&gt;[]&gt; =&gt; {
    await db.poolConnect;
    const request = db.pool.request();
    const result = await request.query('SELECT id, username, email, profileImage, createdAt FROM Users');

    const users: Partial&lt;User&gt;[] = result.recordset;

    return users;
};

//update user 
export const updateUser = async (id: string, updatedFields: Partial&lt;User&gt;): Promise&lt;User&gt; =&gt; {
    const { username, email, profileImage, password } = updatedFields;

    await db.poolConnect;
    const request = db.pool.request();

    if (password) {
        updatedFields.password = await bcrypt.hash(password, 10);
    }

    await request
        .input('id', db.sql.VarChar, id)
        .input('username', db.sql.VarChar, username || null)
        .input('email', db.sql.VarChar, email || null)
        .input('profileImage', db.sql.VarChar, profileImage || null)
        .input('password', db.sql.VarChar, updatedFields.password || null)
        .input('updatedAt', db.sql.DateTime, new Date())
        .query(`
        UPDATE Users
        SET 
          username = ISNULL(@username, username),
          email = ISNULL(@email, email),
          password = ISNULL(@password, password),
          profileImage = ISNULL(@profileImage, profileImage),
          updatedAt = @updatedAt
        WHERE id = @id
      `);

    const updatedUser = await request
        .input('id', db.sql.VarChar, id)
        .query('SELECT * FROM Users WHERE id = @id');

    return updatedUser.recordset[0];
};

// delete user 
export const deleteUser = async (id: string): Promise&lt;void&gt; =&gt; {
    await db.poolConnect;
    const request = db.pool.request();

    await request.input('id', db.sql.VarChar, id).query('DELETE FROM Users WHERE id = @id');
};

// active sessions
export const getSessions = async (userId: string): Promise&lt;{ refreshToken: string, createdAt: Date, updatedAt: Date }[]&gt; =&gt; {
    await db.poolConnect;
    const request = db.pool.request();

    const result = await request
        .input('userId', db.sql.VarChar, userId)
        .query('SELECT refreshToken, createdAt, updatedAt FROM Sessions WHERE userId = @userId');

    return result.recordset;
};

// Refresh Token
export const refreshAccessToken = async (refreshToken: string): Promise&lt;string&gt; =&gt; {
    try {
        // Verify the refresh token
        const decoded = jwt.verify(refreshToken, config.jwtSecret) as { id: string, email: string };
        const { id, email } = decoded;

        await db.poolConnect;
        const request = db.pool.request();

        // Check if the refresh token exists in the sessions table
        const result = await request
            .input('refreshToken', db.sql.VarChar, refreshToken)
            .query('SELECT * FROM Sessions WHERE refreshToken = @refreshToken');

        if (!result.recordset.length) {
            throw new Error('Invalid refresh token');
        }

        // If valid, issue a new access token
        const newAccessToken = jwt.sign({ id, email }, config.jwtSecret, { expiresIn: '15m' });

        return newAccessToken;
    } catch (error: any) {
        throw new Error('Could not refresh access token: ' + error.message);
    }
};

// delete session(logout)
export const deleteSession = async (refreshToken: string): Promise&lt;void&gt; =&gt; {
    await db.poolConnect;
    const request = db.pool.request();

    // Remove the refresh token from the Sessions table
    await request
        .input('refreshToken', db.sql.VarChar, refreshToken)
        .query('DELETE FROM Sessions WHERE refreshToken = @refreshToken');
};

/** Delete All Sessions (Logout from all devices)
 * This is a useful service to log a user out from all sessions (all devices).
 * */
export const deleteAllSessions = async (userId: string): Promise&lt;void&gt; =&gt; {
    await db.poolConnect;
    const request = db.pool.request();

    // Remove all sessions for the user
    await request
        .input('userId', db.sql.VarChar, userId)
        .query('DELETE FROM Sessions WHERE userId = @userId');
};

// Helper to store refresh token
const storeRefreshToken = async (userId: string, refreshToken: string) =&gt; {
    await db.poolConnect;
    const request = db.pool.request();
    await request
        .input('userId', db.sql.VarChar, userId)
        .input('refreshToken', db.sql.VarChar, refreshToken)
        .query(`
        INSERT INTO Sessions (userId, refreshToken, createdAt, updatedAt)
        VALUES (@userId, @refreshToken, GETDATE(), GETDATE())
    `);
};</code></pre></div></section><section><h3 id="-2125346110#8-swagger-documentation" data-toc="8-swagger-documentation#Developing-An-API.md-8-swagger-documentation">8. Swagger Documentation</h3><p id="-2125346110#d9rm2n_137">You can generate Swagger API documentation using <span class="inline-code" id="-2125346110#d9rm2n_140">swagger-jsdoc</span>. Here's an example <span class="inline-code" id="-2125346110#d9rm2n_141">swagger.ts</span> configuration:</p><div class="detached code-block" id="-2125346110#d9rm2n_138"><pre><code class="language-javascript">import { Express, Request, Response } from &quot;express&quot;;
import swaggerJsdoc from &quot;swagger-jsdoc&quot;;
import swaggerUi from &quot;swagger-ui-express&quot;;
import logger from &quot;../middleware/logger&quot;;

const options: swaggerJsdoc.Options = {
    definition: {
        openapi: &quot;3.0.0&quot;,
        info: {
            title: &quot;User Management API Docs&quot;,
            version: &quot;1.0&quot;,
            description: &quot;API documentation for the User Management system.&quot;,
            license: {
                name: 'MIT License',
                url: &quot;https://github.com/kelcho-spense/Express-Typescript-Course/blob/main/LICENSE&quot;
            }
        },
        servers: [
            {
                url: &quot;http://localhost:8000/api&quot;, // Set your base URL here
                description: &quot;Local server&quot;
            }
        ],
        components: {
            securitySchemes: {
                bearerAuth: {
                    type: &quot;http&quot;,
                    scheme: &quot;bearer&quot;,
                    bearerFormat: &quot;JWT&quot;,
                },
            },
        },
        security: [
            {
                bearerAuth: [],
            },
        ],
    },
    apis: [&quot;./src/routes/*.ts&quot;, &quot;./src/models/*.ts&quot;],
};

const swaggerSpec = swaggerJsdoc(options);

function swaggerDocs(app: Express, port: number) {
    // Swagger page
    app.use(&quot;/docs&quot;, swaggerUi.serve, swaggerUi.setup(swaggerSpec));

    // Docs in JSON format
    app.get(&quot;/docs.json&quot;, (req: Request, res: Response) =&gt; {
        res.setHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);
        res.send(swaggerSpec);
    });

    logger.info(`Docs available at http://localhost:${port}/docs`);
}

export default swaggerDocs;</code></pre></div></section><section><h3 id="-2125346110#9-middlewares" data-toc="9-middlewares#Developing-An-API.md-9-middlewares">9. middlewares</h3><ul class="list" id="-2125346110#d9rm2n_143" start="1"><li class="list-item" id="-2125346110#d9rm2n_158"><p><span class="inline-code" id="-2125346110#d9rm2n_159">deserializeUser.ts</span></p></li></ul><div class="detached code-block" id="-2125346110#d9rm2n_144"><pre><code class="language-javascript">// src/middleware/deserializeUser.ts
import { Request, Response, NextFunction } from 'express';
import jwt from 'jsonwebtoken';
import { config } from '../config';
import { User } from '../models/User';
import { refreshAccessToken } from '../services/userService';

interface AuthRequest extends Request {
    user?: User;
}

export const deserializeUser = async (req: AuthRequest, res: Response, next: NextFunction) =&gt; {
    const token = req.headers.authorization?.split(' ')[1];
    if (!token) return res.status(401).json({ message: 'Unauthorized' });

    try {
        const decoded = jwt.verify(token, config.jwtSecret) as User;
        req.user = decoded;
        next();
    } catch (error: any) {
        // Detect token expiration
        if (error.name === 'TokenExpiredError') {
            const refreshToken = req.headers['x-refresh-token'];

            if (!refreshToken) {
                return res.status(401).json({ message: 'Token expired and no refresh token provided' });
            }

            // Attempt to refresh the token
            try {
                const newAccessToken = await refreshAccessToken(refreshToken as string);
                res.setHeader('x-access-token', newAccessToken);

                // Reattempt the original request after issuing the new token
                const decoded = jwt.verify(newAccessToken, config.jwtSecret) as User;
                req.user = decoded;
                next();
            } catch (refreshError) {
                return res.status(403).json({ message: 'Could not refresh token' });
            }
        } else {
            return res.status(401).json({ message: 'Invalid token' });
        }
    }
};

export type { AuthRequest };</code></pre></div><ul class="list" id="-2125346110#d9rm2n_145" start="1"><li class="list-item" id="-2125346110#d9rm2n_160"><p><span class="inline-code" id="-2125346110#d9rm2n_161">logger.ts</span></p></li></ul><div class="detached code-block" id="-2125346110#d9rm2n_146"><pre><code class="language-javascript">import pino from 'pino'

const logger = pino({
    base: {
        pid: false
    },
    transport: {
        target: 'pino-pretty',
        options: {
            colorize: true
        }
    }
})

export default logger;

/**
 * Pino is a fast, lightweight, and highly configurable logger built on
 * V8's built-in JSON.stringify() function. It's a low-overhead alternative
 * to other popular loggers like Morgan and Winston.
 *
 * The &quot;base&quot; option removes the process ID from the log output, which is
 * not necessary for our use case.
 *
 * The &quot;transport&quot; option is used to customize the log output. In this case,
 * we're using the &quot;pino-pretty&quot; transport, which formats the log output in
 * a human-readable format. The &quot;colorize&quot; option is set to true, which adds
 * color to the log output.
 */</code></pre></div><ul class="list" id="-2125346110#d9rm2n_147" start="1"><li class="list-item" id="-2125346110#d9rm2n_162"><p><span class="inline-code" id="-2125346110#d9rm2n_163">metrics.ts</span></p></li></ul><div class="detached code-block" id="-2125346110#d9rm2n_148"><pre><code class="language-javascript">// src/middleware/metrics.ts
import { Request, Response, NextFunction } from 'express';
import client from 'prom-client';

const collectDefaultMetrics = client.collectDefaultMetrics;
collectDefaultMetrics();

const httpRequestDurationMicroseconds = new client.Histogram({
    name: 'http_request_duration_ms',
    help: 'Duration of HTTP requests in ms',
    labelNames: ['method', 'route', 'status_code'],
    buckets: [50, 100, 300, 500, 1000, 3000],
});

const metricsMiddleware = (req: Request, res: Response, next: NextFunction) =&gt; {
    const start = Date.now();

    res.on('finish', () =&gt; {
        const duration = Date.now() - start;
        httpRequestDurationMicroseconds
            .labels(req.method, req.route ? req.route.path : req.path, res.statusCode.toString())
            .observe(duration);
    });

    next();
};

const metricsRoute = async (req: Request, res: Response) =&gt; {
    res.set('Content-Type', client.register.contentType);
    res.end(await client.register.metrics());
};

export { metricsMiddleware, metricsRoute };</code></pre></div><ul class="list" id="-2125346110#d9rm2n_149" start="1"><li class="list-item" id="-2125346110#d9rm2n_164"><p><span class="inline-code" id="-2125346110#d9rm2n_165">rateLimiter.ts</span></p></li></ul><div class="detached code-block" id="-2125346110#d9rm2n_150"><pre><code class="language-javascript">import rateLimit from 'express-rate-limit';

const limiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 100, // limit each IP to 100 requests per windowMs
    standardHeaders: 'draft-7', // draft-6: `RateLimit-*` headers; draft-7: combined `RateLimit` header
    legacyHeaders: false, // Disable the `X-RateLimit-*` headers.
    message: 'Too many requests from this IP, please try again later.',
});
export default limiter;

/**
 * The `limiter` is a middleware that limits the number of requests
 * that can be made from a single IP address within a given time
 * window (15 minutes in this case). If the limit is exceeded, the
 * middleware will return a 429 status code and the message
 * &quot;Too many requests from this IP, please try again later.&quot;.
 *
 * The `standardHeaders` option is set to `'draft-7'` which means
 * the middleware will use the combined `RateLimit` header. The
 * `legacyHeaders` option is set to `false` which means the
 * middleware will not use the `X-RateLimit-*` headers.
 *
 * The `windowMs` option is set to `15 * 60 * 1000` which means
 * the middleware will count the number of requests made within
 * the last 15 minutes. The `max` option is set to `100` which
 * means the middleware will allow up to 100 requests from a
 * single IP address within the given time window.
 *
 * The `message` option is set to the string &quot;Too many requests
 * from this IP, please try again later.&quot; which is the message
 * that will be returned when the limit is exceeded.
 */</code></pre></div><ul class="list" id="-2125346110#d9rm2n_151" start="1"><li class="list-item" id="-2125346110#d9rm2n_166"><p><span class="inline-code" id="-2125346110#d9rm2n_167">refreshToken.ts</span></p></li></ul><div class="detached code-block" id="-2125346110#d9rm2n_152"><pre><code class="language-javascript">import { config } from '../config';
import { Request, Response } from 'express';
import jwt from 'jsonwebtoken';

export const refreshToken = async (req: Request, res: Response) =&gt; {
    const { refreshToken } = req.body;
    if (!refreshToken) return res.status(403).json({ message: 'Token expired, login required' });

    try {
        const decoded = jwt.verify(refreshToken, config.jwtSecret) as { id: string; email: string };
        const newAccessToken = jwt.sign({ id: decoded.id, email: decoded.email }, config.jwtSecret, { expiresIn: '15m' });
        res.setHeader('Authorization', `Bearer ${newAccessToken}`);
        return res.json({ accessToken: newAccessToken });
    } catch (error) {
        return res.status(403).json({ message: 'Invalid refresh token' });
    }
};</code></pre></div><ul class="list" id="-2125346110#d9rm2n_153" start="1"><li class="list-item" id="-2125346110#d9rm2n_168"><p><span class="inline-code" id="-2125346110#d9rm2n_169">requireUser.ts</span></p></li></ul><div class="detached code-block" id="-2125346110#d9rm2n_154"><pre><code class="language-javascript">import { Response, NextFunction } from 'express';
import { AuthRequest } from './deserializeUser'

export const requireUser = (req: AuthRequest, res: Response, next: NextFunction) =&gt; {
    if (!req.user) return res.status(401).json({ message: 'Unauthorized: No user found' });
    next();
};</code></pre></div><ul class="list" id="-2125346110#d9rm2n_155" start="1"><li class="list-item" id="-2125346110#d9rm2n_170"><p><span class="inline-code" id="-2125346110#d9rm2n_171">zodValidate.ts</span></p></li></ul><div class="detached code-block" id="-2125346110#d9rm2n_156"><pre><code class="language-javascript">import { ZodSchema } from 'zod';
import { Request, Response, NextFunction } from 'express';

const zodValidate = (schema: ZodSchema&lt;any&gt;) =&gt; (req: Request, res: Response, next: NextFunction) =&gt; {
    try {
        schema.parse({
            body: req.body,
            query: req.query,
            params: req.params,
        });
        next();
    } catch (error: any) {
        res.status(400).json({
            error: error.errors,
        });
    }
};

export default zodValidate;

/**This is a middleware function named validate that takes a Zod schema as an argument.
 * It validates incoming HTTP requests against the provided schema. If the request is valid,
 * it calls the next middleware function (next()).
 * If the request is invalid, it returns a 400 error response with the validation errors. 
 *  */</code></pre></div></section><section><h3 id="-2125346110#10-running-the-project" data-toc="10-running-the-project#Developing-An-API.md-10-running-the-project">10. Running the Project</h3><p id="-2125346110#d9rm2n_173">Once everything is set up:</p><ol class="list list-decimal" id="-2125346110#d9rm2n_174" type="1" start="1"><li class="list-item" id="-2125346110#d9rm2n_178"><p id="-2125346110#d9rm2n_180">Run TypeScript compilation:</p><div class="detached code-block" id="-2125346110#d9rm2n_181"><pre><code class="language-bash">npx tsc</code></pre></div></li><li class="list-item" id="-2125346110#d9rm2n_179"><p id="-2125346110#d9rm2n_182">Run the development server using <span class="inline-code" id="-2125346110#d9rm2n_184">tsx</span>:</p><div class="detached code-block" id="-2125346110#d9rm2n_183"><pre><code class="language-bash">npm run dev</code></pre></div></li></ol><p id="-2125346110#d9rm2n_175">You should now be able to test your API on <span class="inline-code" id="-2125346110#d9rm2n_185">http://localhost:5000</span> and access Swagger documentation at <span class="inline-code" id="-2125346110#d9rm2n_186">http://localhost:5000/docs</span>.</p></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1688204177">Sending Emails Programmatically</h1><p id="1688204177#-9ryfn4_3">This guide provides a hands-on approach to sending emails programmatically using Express.js with TypeScript. We'll utilize the popular Nodemailer (<a href="https://nodemailer.com/about/">https://nodemailer.com/about/</a>) library to handle email sending. By the end of this tutorial, you'll have a simple API endpoint that can send emails based on client requests.</p><section><h2 id="1688204177#setup" data-toc="setup#Sending-Emails-Programmatically.md-setup">Setup</h2><section><h3 id="1688204177#1-initialize-the-project" data-toc="1-initialize-the-project#Sending-Emails-Programmatically.md-1-initialize-the-project">1. Initialize the Project</h3><p id="1688204177#-9ryfn4_13">First, create a new directory for your project and initialize it with npm:</p><div class="detached code-block" id="1688204177#-9ryfn4_14"><pre><code class="language-bash">mkdir express-email-ts
cd express-email-ts
npm init -y</code></pre></div></section><section><h3 id="1688204177#2-install-dependencies" data-toc="2-install-dependencies#Sending-Emails-Programmatically.md-2-install-dependencies">2. Install Dependencies</h3><p id="1688204177#-9ryfn4_15">Install the necessary packages:</p><div class="detached code-block" id="1688204177#-9ryfn4_16"><pre><code class="language-bash">npm install express nodemailer dotenv
npm install --save-dev typescript @types/express @types/node ts-node-dev</code></pre></div><ul class="list" id="1688204177#-9ryfn4_17" start="1"><li class="list-item" id="1688204177#-9ryfn4_18"><p><span class="control" id="1688204177#-9ryfn4_23">express</span>: Web framework for Node.js</p></li><li class="list-item" id="1688204177#-9ryfn4_19"><p><span class="control" id="1688204177#-9ryfn4_24">nodemailer</span>: Module to send emails</p></li><li class="list-item" id="1688204177#-9ryfn4_20"><p><span class="control" id="1688204177#-9ryfn4_25">dotenv</span>: Loads environment variables from a <span class="inline-code" id="1688204177#-9ryfn4_26">.env</span> file</p></li><li class="list-item" id="1688204177#-9ryfn4_21"><p><span class="control" id="1688204177#-9ryfn4_27">typescript</span>, <span class="control" id="1688204177#-9ryfn4_28">ts-node-dev</span>: For TypeScript support</p></li><li class="list-item" id="1688204177#-9ryfn4_22"><p><span class="control" id="1688204177#-9ryfn4_29">@types/*</span>: Type definitions for TypeScript</p></li></ul></section><section><h3 id="1688204177#3-configure-typescript" data-toc="3-configure-typescript#Sending-Emails-Programmatically.md-3-configure-typescript">3. Configure TypeScript</h3><p id="1688204177#-9ryfn4_30">Initialize a TypeScript configuration:</p><div class="detached code-block" id="1688204177#-9ryfn4_31"><pre><code class="language-bash">npx tsc --init</code></pre></div><p id="1688204177#-9ryfn4_32">Modify the <span class="inline-code" id="1688204177#-9ryfn4_34">tsconfig.json</span> as needed. A basic configuration might look like this:</p><div class="detached code-block" id="1688204177#-9ryfn4_33"><pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;ES6&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;outDir&quot;: &quot;./dist&quot;,
    &quot;rootDir&quot;: &quot;./src&quot;,
    &quot;strict&quot;: true,
    &quot;esModuleInterop&quot;: true
  }
}</code></pre></div></section><section><h3 id="1688204177#4-set-up-project-structure" data-toc="4-set-up-project-structure#Sending-Emails-Programmatically.md-4-set-up-project-structure">4. Set Up Project Structure</h3><p id="1688204177#-9ryfn4_35">Create the following structure:</p><div class="detached code-block" id="1688204177#-9ryfn4_36"><pre><code class="language-none">express-email-ts/
├── src/
│   ├── index.ts
│   └── email.ts
├── .env
├── package.json
└── tsconfig.json</code></pre></div></section></section><section><h2 id="1688204177#implementation" data-toc="implementation#Sending-Emails-Programmatically.md-implementation">Implementation</h2><section><h3 id="1688204177#1-configure-environment-variables" data-toc="1-configure-environment-variables#Sending-Emails-Programmatically.md-1-configure-environment-variables">1. Configure Environment Variables</h3><p id="1688204177#-9ryfn4_41">Create a <span class="inline-code" id="1688204177#-9ryfn4_44">.env</span> file in the root directory to store sensitive information like email credentials:</p><div class="detached code-block" id="1688204177#-9ryfn4_42"><pre><code class="language-bash">PORT=3000
EMAIL_SERVICE=Gmail
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-email-password</code></pre></div><p id="1688204177#-9ryfn4_43"><span class="control" id="1688204177#-9ryfn4_45">Note:</span> For Gmail, you might need to enable Less Secure Apps (<a href="https://myaccount.google.com/lesssecureapps">https://myaccount.google.com/lesssecureapps</a>) or use App Passwords (<a href="https://support.google.com/accounts/answer/185833">https://support.google.com/accounts/answer/185833</a>).</p></section><section><h3 id="1688204177#2-create-the-email-module" data-toc="2-create-the-email-module#Sending-Emails-Programmatically.md-2-create-the-email-module">2. Create the Email Module</h3><p id="1688204177#-9ryfn4_48">Create <span class="inline-code" id="1688204177#-9ryfn4_50">src/email.ts</span> to handle email sending logic:</p><div class="detached code-block" id="1688204177#-9ryfn4_49"><pre><code class="language-javascript">// src/email.ts
import nodemailer from 'nodemailer';
import dotenv from 'dotenv';

dotenv.config();

interface EmailOptions {
  to: string;
  subject: string;
  text: string;
  html?: string;
}

const transporter = nodemailer.createTransport({
  service: process.env.EMAIL_SERVICE, // e.g., 'Gmail'
  auth: {
    user: process.env.EMAIL_USER,
    pass: process.env.EMAIL_PASS,
  },
});

export const sendEmail = async (options: EmailOptions) =&gt; {
  const mailOptions = {
    from: process.env.EMAIL_USER,
    to: options.to,
    subject: options.subject,
    text: options.text,
    html: options.html || options.text,
  };

  try {
    const info = await transporter.sendMail(mailOptions);
    console.log('Email sent: ', info.response);
    return info;
  } catch (error) {
    console.error('Error sending email: ', error);
    throw error;
  }
};</code></pre></div></section><section><h3 id="1688204177#3-set-up-the-express-server" data-toc="3-set-up-the-express-server#Sending-Emails-Programmatically.md-3-set-up-the-express-server">3. Set Up the Express Server</h3><p id="1688204177#-9ryfn4_51">Create <span class="inline-code" id="1688204177#-9ryfn4_53">src/index.ts</span> to define the API endpoint:</p><div class="detached code-block" id="1688204177#-9ryfn4_52"><pre><code class="language-javascript">// src/index.ts
import express, { Request, Response } from 'express';
import { sendEmail } from './email';
import dotenv from 'dotenv';

dotenv.config();

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware to parse JSON
app.use(express.json());

app.post('/send-email', async (req: Request, res: Response) =&gt; {
  const { to, subject, text, html } = req.body;

  if (!to || !subject || !text) {
    return res.status(400).json({ message: 'Missing required fields: to, subject, text' });
  }

  try {
    await sendEmail({ to, subject, text, html });
    res.status(200).json({ message: 'Email sent successfully' });
  } catch (error) {
    res.status(500).json({ message: 'Failed to send email', error });
  }
});

app.get('/', (req: Request, res: Response) =&gt; {
  res.send('Email Service is running.');
});

app.listen(PORT, () =&gt; {
  console.log(`Server is running on port ${PORT}`);
});</code></pre></div></section><section><h3 id="1688204177#4-update-package-json-scripts" data-toc="4-update-package-json-scripts#Sending-Emails-Programmatically.md-4-update-package-json-scripts">4. Update package.json Scripts</h3><p id="1688204177#-9ryfn4_55">Add a script to run the server with <span class="inline-code" id="1688204177#-9ryfn4_58">ts-node-dev</span> for hot-reloading:</p><div class="detached code-block" id="1688204177#-9ryfn4_56"><pre><code class="language-json">&quot;scripts&quot;: {
  &quot;start&quot;: &quot;ts-node-dev src/index.ts&quot;
}</code></pre></div></section></section><section><h2 id="1688204177#running-the-application" data-toc="running-the-application#Sending-Emails-Programmatically.md-running-the-application">Running the Application</h2><ol class="list list-decimal" id="1688204177#-9ryfn4_59" type="1" start="1"><li class="list-item" id="1688204177#-9ryfn4_60"><p id="1688204177#-9ryfn4_62"><span class="control" id="1688204177#-9ryfn4_66">Start the Server</span></p><div class="detached code-block" id="1688204177#-9ryfn4_63"><pre><code class="language-bash">npm start</code></pre></div><p id="1688204177#-9ryfn4_64">You should see:</p><div class="detached code-block" id="1688204177#-9ryfn4_65"><pre><code class="language-none">Server is running on port 3000</code></pre></div></li><li class="list-item" id="1688204177#-9ryfn4_61"><p id="1688204177#-9ryfn4_67"><span class="control" id="1688204177#-9ryfn4_75">Send a Test Email</span></p><p id="1688204177#-9ryfn4_68">Use a tool like Postman (<a href="https://www.postman.com/">https://www.postman.com/</a>) or <span class="inline-code" id="1688204177#-9ryfn4_77">curl</span> to send a POST request to <span class="inline-code" id="1688204177#-9ryfn4_78">http://localhost:3000/send-email</span> with a JSON body:</p><div class="detached code-block" id="1688204177#-9ryfn4_69"><pre><code class="language-json">{
  &quot;to&quot;: &quot;recipient@example.com&quot;,
  &quot;subject&quot;: &quot;Test Email&quot;,
  &quot;text&quot;: &quot;Hello! This is a test email sent from Express.js with TypeScript.&quot;,
  &quot;html&quot;: &quot;&lt;p&gt;Hello! This is a &lt;strong&gt;test email&lt;/strong&gt; sent from Express.js with TypeScript.&lt;/p&gt;&quot;
}</code></pre></div><p id="1688204177#-9ryfn4_70"><span class="control" id="1688204177#-9ryfn4_79">Using <span class="inline-code" id="1688204177#-9ryfn4_80">curl</span>:</span></p><div class="detached code-block" id="1688204177#-9ryfn4_71"><pre><code class="language-bash">curl -X POST http://localhost:3000/send-email \
  -H &quot;Content-Type: application/json&quot; \
  -d '{
    &quot;to&quot;: &quot;recipient@example.com&quot;,
    &quot;subject&quot;: &quot;Test Email&quot;,
    &quot;text&quot;: &quot;Hello! This is a test email sent from Express.js with TypeScript.&quot;,
    &quot;html&quot;: &quot;&lt;p&gt;Hello! This is a &lt;strong&gt;test email&lt;/strong&gt; sent from Express.js with TypeScript.&lt;/p&gt;&quot;
  }'</code></pre></div><p id="1688204177#-9ryfn4_72"><span class="control" id="1688204177#-9ryfn4_81">Expected Response:</span></p><div class="detached code-block" id="1688204177#-9ryfn4_73"><pre><code class="language-json">{
  &quot;message&quot;: &quot;Email sent successfully&quot;
}</code></pre></div><p id="1688204177#-9ryfn4_74">Check the recipient's inbox to verify the email was received.</p></li></ol></section><section><h2 id="1688204177#error-handling-and-validation" data-toc="error-handling-and-validation#Sending-Emails-Programmatically.md-error-handling-and-validation">Error Handling and Validation</h2><p id="1688204177#-9ryfn4_82">For production-ready applications, consider enhancing error handling and validating input data. Libraries like Joi (<a href="https://joi.dev/">https://joi.dev/</a>) or express-validator (<a href="https://express-validator.github.io/docs/">https://express-validator.github.io/docs/</a>) can help with robust validation.</p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1923585412">Managing Cron Jobs and Background Services</h1><p id="1923585412#-3i66bf_3">We'll utilize the node-cron (<a href="https://www.npmjs.com/package/node-cron">https://www.npmjs.com/package/node-cron</a>) library for scheduling tasks and demonstrate how to integrate background services seamlessly into your Express application.</p><section><h2 id="1923585412#setup" data-toc="setup#Managing-Cron-Jobs-and-Background-Services.md-setup">Setup</h2><section><h3 id="1923585412#1-initialize-the-project" data-toc="1-initialize-the-project#Managing-Cron-Jobs-and-Background-Services.md-1-initialize-the-project">1. Initialize the Project</h3><p id="1923585412#-3i66bf_14">First, create a new directory for your project and initialize it with npm:</p><div class="detached code-block" id="1923585412#-3i66bf_15"><pre><code class="language-bash">mkdir express-cron-ts
cd express-cron-ts
npm init -y</code></pre></div></section><section><h3 id="1923585412#2-install-dependencies" data-toc="2-install-dependencies#Managing-Cron-Jobs-and-Background-Services.md-2-install-dependencies">2. Install Dependencies</h3><p id="1923585412#-3i66bf_16">Install the necessary packages:</p><div class="detached code-block" id="1923585412#-3i66bf_17"><pre><code class="language-bash">npm install express node-cron dotenv
npm install --save-dev typescript @types/express @types/node ts-node-dev</code></pre></div><ul class="list" id="1923585412#-3i66bf_18" start="1"><li class="list-item" id="1923585412#-3i66bf_19"><p><span class="control" id="1923585412#-3i66bf_24">express</span>: Web framework for Node.js</p></li><li class="list-item" id="1923585412#-3i66bf_20"><p><span class="control" id="1923585412#-3i66bf_25">node-cron</span>: Task scheduler for running cron jobs</p></li><li class="list-item" id="1923585412#-3i66bf_21"><p><span class="control" id="1923585412#-3i66bf_26">dotenv</span>: Loads environment variables from a <span class="inline-code" id="1923585412#-3i66bf_27">.env</span> file</p></li><li class="list-item" id="1923585412#-3i66bf_22"><p><span class="control" id="1923585412#-3i66bf_28">typescript</span>, <span class="control" id="1923585412#-3i66bf_29">ts-node-dev</span>: For TypeScript support</p></li><li class="list-item" id="1923585412#-3i66bf_23"><p><span class="control" id="1923585412#-3i66bf_30">@types/*</span>: Type definitions for TypeScript</p></li></ul></section><section><h3 id="1923585412#3-configure-typescript" data-toc="3-configure-typescript#Managing-Cron-Jobs-and-Background-Services.md-3-configure-typescript">3. Configure TypeScript</h3><p id="1923585412#-3i66bf_31">Initialize a TypeScript configuration:</p><div class="detached code-block" id="1923585412#-3i66bf_32"><pre><code class="language-bash">npx tsc --init</code></pre></div><p id="1923585412#-3i66bf_33">Modify the <span class="inline-code" id="1923585412#-3i66bf_35">tsconfig.json</span> as needed. A basic configuration might look like this:</p><div class="detached code-block" id="1923585412#-3i66bf_34"><pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;ES6&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;outDir&quot;: &quot;./dist&quot;,
    &quot;rootDir&quot;: &quot;./src&quot;,
    &quot;strict&quot;: true,
    &quot;esModuleInterop&quot;: true
  }
}</code></pre></div></section><section><h3 id="1923585412#4-set-up-project-structure" data-toc="4-set-up-project-structure#Managing-Cron-Jobs-and-Background-Services.md-4-set-up-project-structure">4. Set Up Project Structure</h3><p id="1923585412#-3i66bf_36">Create the following structure:</p><div class="detached code-block" id="1923585412#-3i66bf_37"><pre><code class="language-none">express-cron-ts/
├── src/
│   ├── index.ts
│   ├── jobs/
│   │   └── exampleJob.ts
├── .env
├── package.json
└── tsconfig.json</code></pre></div></section></section><section><h2 id="1923585412#implementation" data-toc="implementation#Managing-Cron-Jobs-and-Background-Services.md-implementation">Implementation</h2><section><h3 id="1923585412#1-configure-environment-variables" data-toc="1-configure-environment-variables#Managing-Cron-Jobs-and-Background-Services.md-1-configure-environment-variables">1. Configure Environment Variables</h3><p id="1923585412#-3i66bf_42">Create a <span class="inline-code" id="1923585412#-3i66bf_45">.env</span> file in the root directory to store configuration variables:</p><div class="detached code-block" id="1923585412#-3i66bf_43"><pre><code class="language-bash">PORT=3000
CRON_SCHEDULE=*/5 * * * *</code></pre></div><ul class="list" id="1923585412#-3i66bf_44" start="1"><li class="list-item" id="1923585412#-3i66bf_46"><p><span class="control" id="1923585412#-3i66bf_48">PORT</span>: Port number for the Express server</p></li><li class="list-item" id="1923585412#-3i66bf_47"><p><span class="control" id="1923585412#-3i66bf_49">CRON_SCHEDULE</span>: Cron expression defining the schedule (e.g., every 5 minutes)</p></li></ul></section><section><h3 id="1923585412#2-create-a-cron-job-module" data-toc="2-create-a-cron-job-module#Managing-Cron-Jobs-and-Background-Services.md-2-create-a-cron-job-module">2. Create a Cron Job Module</h3><p id="1923585412#-3i66bf_50">Create <span class="inline-code" id="1923585412#-3i66bf_52">src/jobs/exampleJob.ts</span> to define a sample cron job:</p><div class="detached code-block" id="1923585412#-3i66bf_51"><pre><code class="language-ts">// src/jobs/exampleJob.ts
import cron, { ScheduledTask } from 'node-cron';

export class ExampleJob {
  private task: ScheduledTask;

  constructor() {
    // Define the cron schedule from environment variables or use a default
    const schedule = process.env.CRON_SCHEDULE || '*/5 * * * *';
    this.task = cron.schedule(schedule, this.run, {
      scheduled: false, // Prevents the job from starting automatically
    });
  }

  // The task to run
  private async run() {
    try {
      console.log(`[${new Date().toISOString()}] ExampleJob is running.`);
      // Add your task logic here (e.g., database cleanup, sending reports)
    } catch (error) {
      console.error('Error running ExampleJob:', error);
    }
  }

  // Start the cron job
  public start() {
    this.task.start();
    console.log('ExampleJob has started.');
  }

  // Stop the cron job
  public stop() {
    this.task.stop();
    console.log('ExampleJob has stopped.');
  }
}</code></pre></div></section><section><h3 id="1923585412#3-set-up-the-express-server" data-toc="3-set-up-the-express-server#Managing-Cron-Jobs-and-Background-Services.md-3-set-up-the-express-server">3. Set Up the Express Server</h3><p id="1923585412#-3i66bf_53">Create <span class="inline-code" id="1923585412#-3i66bf_57">src/index.ts</span> to define the Express server and manage background jobs:</p><div class="detached code-block" id="1923585412#-3i66bf_54"><pre><code class="language-ts">// src/index.ts
import express, { Request, Response } from 'express';
import dotenv from 'dotenv';
import { ExampleJob } from './jobs/exampleJob';

dotenv.config();

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware to parse JSON
app.use(express.json());

// Initialize background jobs
const exampleJob = new ExampleJob();

// Start all scheduled jobs
exampleJob.start();

// API Endpoint to check server status
app.get('/', (req: Request, res: Response) =&gt; {
  res.send('Background Service is running.');
});

// API Endpoint to manually trigger the ExampleJob
app.post('/trigger-job', async (req: Request, res: Response) =&gt; {
  try {
    await exampleJob['run'](); // Accessing the private run method for demonstration
    res.status(200).json({ message: 'ExampleJob executed successfully.' });
  } catch (error) {
    res.status(500).json({ message: 'Failed to execute ExampleJob.', error });
  }
});

// API Endpoint to start the ExampleJob
app.post('/start-job', (req: Request, res: Response) =&gt; {
  exampleJob.start();
  res.status(200).json({ message: 'ExampleJob started.' });
});

// API Endpoint to stop the ExampleJob
app.post('/stop-job', (req: Request, res: Response) =&gt; {
  exampleJob.stop();
  res.status(200).json({ message: 'ExampleJob stopped.' });
});

// Handle graceful shutdown
const shutdown = () =&gt; {
  console.log('Shutting down server...');
  exampleJob.stop();
  process.exit(0);
};

process.on('SIGINT', shutdown);
process.on('SIGTERM', shutdown);

// Start the Express server
app.listen(PORT, () =&gt; {
  console.log(`Server is running on port ${PORT}`);
});</code></pre></div><p id="1923585412#-3i66bf_55"><span class="control" id="1923585412#-3i66bf_58">Notes:</span></p><ul class="list" id="1923585412#-3i66bf_56" start="1"><li class="list-item" id="1923585412#-3i66bf_59"><p><span class="control" id="1923585412#-3i66bf_62">ExampleJob Class</span>: Encapsulates the cron job logic, allowing you to start and stop the job as needed.</p></li><li class="list-item" id="1923585412#-3i66bf_60"><p><span class="control" id="1923585412#-3i66bf_63">API Endpoints</span>: </p><ul class="list" id="1923585412#-3i66bf_64" start="1"><li class="list-item" id="1923585412#-3i66bf_65"><p><span class="inline-code" id="1923585412#-3i66bf_69">GET /</span>: Check if the service is running.</p></li><li class="list-item" id="1923585412#-3i66bf_66"><p><span class="inline-code" id="1923585412#-3i66bf_70">POST /trigger-job</span>: Manually trigger the cron job.</p></li><li class="list-item" id="1923585412#-3i66bf_67"><p><span class="inline-code" id="1923585412#-3i66bf_71">POST /start-job</span>: Start the cron job.</p></li><li class="list-item" id="1923585412#-3i66bf_68"><p><span class="inline-code" id="1923585412#-3i66bf_72">POST /stop-job</span>: Stop the cron job.</p></li></ul></li><li class="list-item" id="1923585412#-3i66bf_61"><p><span class="control" id="1923585412#-3i66bf_73">Graceful Shutdown</span>: Ensures that cron jobs are stopped when the server shuts down.</p></li></ul></section><section><h3 id="1923585412#4-update-package-json-scripts" data-toc="4-update-package-json-scripts#Managing-Cron-Jobs-and-Background-Services.md-4-update-package-json-scripts">4. Update package.json Scripts</h3><p id="1923585412#-3i66bf_75">Add a script to run the server with <span class="inline-code" id="1923585412#-3i66bf_78">ts-node-dev</span> for hot-reloading:</p><div class="detached code-block" id="1923585412#-3i66bf_76"><pre><code class="language-json">&quot;scripts&quot;: {
  &quot;start&quot;: &quot;ts-node-dev src/index.ts&quot;
}</code></pre></div></section></section><section><h2 id="1923585412#running-the-application" data-toc="running-the-application#Managing-Cron-Jobs-and-Background-Services.md-running-the-application">Running the Application</h2><ol class="list list-decimal" id="1923585412#-3i66bf_79" type="1" start="1"><li class="list-item" id="1923585412#-3i66bf_80"><p id="1923585412#-3i66bf_83"><span class="control" id="1923585412#-3i66bf_87">Start the Server</span></p><div class="detached code-block" id="1923585412#-3i66bf_84"><pre><code class="language-bash">npm start</code></pre></div><p id="1923585412#-3i66bf_85">You should see output similar to:</p><div class="detached code-block" id="1923585412#-3i66bf_86"><pre><code class="language-none">Server is running on port 3000
ExampleJob has started.</code></pre></div></li><li class="list-item" id="1923585412#-3i66bf_81"><p id="1923585412#-3i66bf_88"><span class="control" id="1923585412#-3i66bf_91">Verify Scheduled Job Execution</span></p><p id="1923585412#-3i66bf_89">Every 5 minutes (as per the default cron schedule), you should see logs like:</p><div class="detached code-block" id="1923585412#-3i66bf_90"><pre><code class="language-none">[2024-04-27T12:00:00.000Z] ExampleJob is running.</code></pre></div></li><li class="list-item" id="1923585412#-3i66bf_82"><p id="1923585412#-3i66bf_92"><span class="control" id="1923585412#-3i66bf_94">Interact with API Endpoints</span></p><ul class="list" id="1923585412#-3i66bf_93" start="1"><li class="list-item" id="1923585412#-3i66bf_95"><p id="1923585412#-3i66bf_99"><span class="control" id="1923585412#-3i66bf_103">Check Server Status</span></p><div class="detached code-block" id="1923585412#-3i66bf_100"><pre><code class="language-bash">curl http://localhost:3000/</code></pre></div><p id="1923585412#-3i66bf_101"><span class="control" id="1923585412#-3i66bf_104">Response:</span></p><div class="detached code-block" id="1923585412#-3i66bf_102"><pre><code class="language-none">Background Service is running.</code></pre></div></li><li class="list-item" id="1923585412#-3i66bf_96"><p id="1923585412#-3i66bf_105"><span class="control" id="1923585412#-3i66bf_109">Manually Trigger the Job</span></p><div class="detached code-block" id="1923585412#-3i66bf_106"><pre><code class="language-bash">curl -X POST http://localhost:3000/trigger-job</code></pre></div><p id="1923585412#-3i66bf_107"><span class="control" id="1923585412#-3i66bf_110">Response:</span></p><div class="detached code-block" id="1923585412#-3i66bf_108"><pre><code class="language-json">{
  &quot;message&quot;: &quot;ExampleJob executed successfully.&quot;
}</code></pre></div></li><li class="list-item" id="1923585412#-3i66bf_97"><p id="1923585412#-3i66bf_111"><span class="control" id="1923585412#-3i66bf_116">Start the Job</span></p><p id="1923585412#-3i66bf_112">If the job is stopped, you can start it:</p><div class="detached code-block" id="1923585412#-3i66bf_113"><pre><code class="language-bash">curl -X POST http://localhost:3000/start-job</code></pre></div><p id="1923585412#-3i66bf_114"><span class="control" id="1923585412#-3i66bf_117">Response:</span></p><div class="detached code-block" id="1923585412#-3i66bf_115"><pre><code class="language-json">{
  &quot;message&quot;: &quot;ExampleJob started.&quot;
}</code></pre></div></li><li class="list-item" id="1923585412#-3i66bf_98"><p id="1923585412#-3i66bf_118"><span class="control" id="1923585412#-3i66bf_123">Stop the Job</span></p><p id="1923585412#-3i66bf_119">To stop the cron job:</p><div class="detached code-block" id="1923585412#-3i66bf_120"><pre><code class="language-bash">curl -X POST http://localhost:3000/stop-job</code></pre></div><p id="1923585412#-3i66bf_121"><span class="control" id="1923585412#-3i66bf_124">Response:</span></p><div class="detached code-block" id="1923585412#-3i66bf_122"><pre><code class="language-json">{
  &quot;message&quot;: &quot;ExampleJob stopped.&quot;
}</code></pre></div></li></ul></li></ol></section><section><h2 id="1923585412#error-handling-and-validation" data-toc="error-handling-and-validation#Managing-Cron-Jobs-and-Background-Services.md-error-handling-and-validation">Error Handling and Validation</h2><p id="1923585412#-3i66bf_125">For production-ready applications, consider enhancing error handling and validating input data. Libraries like Joi (<a href="https://joi.dev/">https://joi.dev/</a>) or express-validator (<a href="https://express-validator.github.io/docs/">https://express-validator.github.io/docs/</a>) can help with robust validation. Additionally, implement logging mechanisms (e.g., using Winston (<a href="https://github.com/winstonjs/winston">https://github.com/winstonjs/winston</a>)) for better monitoring of background tasks.</p></section><section><h2 id="1923585412#scaling-background-services" data-toc="scaling-background-services#Managing-Cron-Jobs-and-Background-Services.md-scaling-background-services">Scaling Background Services</h2><p id="1923585412#-3i66bf_129">While <span class="inline-code" id="1923585412#-3i66bf_132">node-cron</span> is suitable for simple scheduling needs, more complex applications might require advanced job queues or background processing systems. Consider the following alternatives for scalability and reliability:</p><ul class="list" id="1923585412#-3i66bf_130" start="1"><li class="list-item" id="1923585412#-3i66bf_133"><p><span class="control" id="1923585412#-3i66bf_136">Bull (<a href="https://github.com/OptimalBits/bull">https://github.com/OptimalBits/bull</a>)</span>: A Redis-based queue system for handling distributed jobs.</p></li><li class="list-item" id="1923585412#-3i66bf_134"><p><span class="control" id="1923585412#-3i66bf_138">Agenda (<a href="https://github.com/agenda/agenda">https://github.com/agenda/agenda</a>)</span>: A light-weight job scheduling library for Node.js backed by MongoDB.</p></li><li class="list-item" id="1923585412#-3i66bf_135"><p><span class="control" id="1923585412#-3i66bf_140">Bee-Queue (<a href="https://github.com/bee-queue/bee-queue">https://github.com/bee-queue/bee-queue</a>)</span>: A simple, fast, robust job queue for Node.js backed by Redis.</p></li></ul><p id="1923585412#-3i66bf_131">These tools offer features like job retries, concurrency control, and persistent storage, which are essential for large-scale applications.</p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1670429095">EJS Templating Engine</h1><p id="-1670429095#-yrzjaw_3">This guide provides a comprehensive introduction to using the EJS (Embedded JavaScript) templating engine within an Express.js application written in TypeScript. We'll explore the basic syntax of EJS, demonstrate its use in email templating, and cover other common applications such as rendering dynamic web pages.</p><section><h2 id="-1670429095#introduction-to-templating-engines-and-ejs" data-toc="introduction-to-templating-engines-and-ejs#EJS-Templating-Engine.md-introduction-to-templating-engines-and-ejs">Introduction to Templating Engines and EJS</h2><section><h3 id="-1670429095#what-is-a-templating-engine" data-toc="what-is-a-templating-engine#EJS-Templating-Engine.md-what-is-a-templating-engine">What is a Templating Engine?</h3><p id="-1670429095#-yrzjaw_9">A templating engine allows you to generate dynamic HTML (or other text-based formats) by embedding code within templates. This enables the creation of dynamic content based on data, user input, or other variables. Templating engines are essential for rendering views in web applications, generating emails, and more.</p></section><section><h3 id="-1670429095#why-ejs" data-toc="why-ejs#EJS-Templating-Engine.md-why-ejs">Why EJS?</h3><p id="-1670429095#-yrzjaw_10">EJS (<a href="https://ejs.co/">https://ejs.co/</a>) is a simple and flexible templating engine for Node.js. It uses plain JavaScript syntax within templates, making it easy to learn and integrate, especially if you're already familiar with JavaScript. EJS is versatile and can be used for rendering web pages, generating emails, and other text-based outputs.</p><p id="-1670429095#-yrzjaw_11"><span class="control" id="-1670429095#-yrzjaw_14">Key Features of EJS:</span></p><ul class="list" id="-1670429095#-yrzjaw_12" start="1"><li class="list-item" id="-1670429095#-yrzjaw_15"><p><span class="control" id="-1670429095#-yrzjaw_19">Simplicity:</span> Easy to learn with straightforward syntax.</p></li><li class="list-item" id="-1670429095#-yrzjaw_16"><p><span class="control" id="-1670429095#-yrzjaw_20">Flexibility:</span> Can be used for various purposes beyond web pages, such as email templates.</p></li><li class="list-item" id="-1670429095#-yrzjaw_17"><p><span class="control" id="-1670429095#-yrzjaw_21">Integration:</span> Seamlessly integrates with Express.js and TypeScript.</p></li><li class="list-item" id="-1670429095#-yrzjaw_18"><p><span class="control" id="-1670429095#-yrzjaw_22">Extensibility:</span> Supports partials and includes for reusable components.</p></li></ul></section></section><section><h2 id="-1670429095#basic-syntax-of-ejs" data-toc="basic-syntax-of-ejs#EJS-Templating-Engine.md-basic-syntax-of-ejs">Basic Syntax of EJS</h2><p id="-1670429095#-yrzjaw_23">Understanding the basic syntax of EJS is crucial before integrating it into your projects. EJS templates are essentially HTML files with embedded JavaScript code.</p><section><h3 id="-1670429095#variables" data-toc="variables#EJS-Templating-Engine.md-variables">Variables</h3><p id="-1670429095#-yrzjaw_28">To embed variables within your template, use <span class="inline-code" id="-1670429095#-yrzjaw_30">&lt;%= %&gt;</span> for escaping and <span class="inline-code" id="-1670429095#-yrzjaw_31">&lt;%- %&gt;</span> for unescaped content.</p><div class="detached code-block" id="-1670429095#-yrzjaw_29"><pre><code class="language-markup">&lt;!-- Escaped Output --&gt;
&lt;p&gt;Hello, &lt;%= username %&gt;!&lt;/p&gt;

&lt;!-- Unescaped Output (Use with caution) --&gt;
&lt;p&gt;Content: &lt;%- content %&gt;&lt;/p&gt;</code></pre></div></section><section><h3 id="-1670429095#control-flow" data-toc="control-flow#EJS-Templating-Engine.md-control-flow">Control Flow</h3><p id="-1670429095#-yrzjaw_32">EJS supports standard JavaScript control flow statements like <span class="inline-code" id="-1670429095#-yrzjaw_34">if</span>, <span class="inline-code" id="-1670429095#-yrzjaw_35">for</span>, <span class="inline-code" id="-1670429095#-yrzjaw_36">each</span>, etc.</p><div class="detached code-block" id="-1670429095#-yrzjaw_33"><pre><code class="language-markup">&lt;!-- If Statement --&gt;
&lt;% if (user.isAdmin) { %&gt;
  &lt;p&gt;Welcome, admin!&lt;/p&gt;
&lt;% } else { %&gt;
  &lt;p&gt;Welcome, user!&lt;/p&gt;
&lt;% } %&gt;

&lt;!-- For Loop --&gt;
&lt;ul&gt;
  &lt;% for(let i = 0; i &lt; items.length; i++) { %&gt;
    &lt;li&gt;&lt;%= items[i] %&gt;&lt;/li&gt;
  &lt;% } %&gt;
&lt;/ul&gt;

&lt;!-- ForEach Loop --&gt;
&lt;ul&gt;
  &lt;% items.forEach(function(item) { %&gt;
    &lt;li&gt;&lt;%= item %&gt;&lt;/li&gt;
  &lt;% }); %&gt;
&lt;/ul&gt;</code></pre></div></section><section><h3 id="-1670429095#includes" data-toc="includes#EJS-Templating-Engine.md-includes">Includes</h3><p id="-1670429095#-yrzjaw_37">EJS allows you to include other EJS files within a template, promoting reusability.</p><div class="detached code-block" id="-1670429095#-yrzjaw_38"><pre><code class="language-markup">&lt;!-- Including a Header Partial --&gt;
&lt;%- include('partials/header') %&gt;

&lt;!-- Including a Footer Partial --&gt;
&lt;%- include('partials/footer') %&gt;</code></pre></div></section><section><h3 id="-1670429095#comments" data-toc="comments#EJS-Templating-Engine.md-comments">Comments</h3><p id="-1670429095#-yrzjaw_39">Comments in EJS templates are not rendered in the output.</p><div class="detached code-block" id="-1670429095#-yrzjaw_40"><pre><code class="language-markup">&lt;%# This is a comment and won't be rendered %&gt;</code></pre></div></section></section><section><h2 id="-1670429095#hands-on-implementation" data-toc="hands-on-implementation#EJS-Templating-Engine.md-hands-on-implementation">Hands-On Implementation</h2><p id="-1670429095#-yrzjaw_41">Let's implement EJS in an Express.js application using TypeScript. We'll create an API endpoint that sends templated emails using EJS.</p><section><h3 id="-1670429095#prerequisites" data-toc="prerequisites#EJS-Templating-Engine.md-prerequisites">Prerequisites</h3><ul class="list" id="-1670429095#-yrzjaw_52" start="1"><li class="list-item" id="-1670429095#-yrzjaw_53"><p><span class="control" id="-1670429095#-yrzjaw_56">Node.js</span> (v14 or later)</p></li><li class="list-item" id="-1670429095#-yrzjaw_54"><p><span class="control" id="-1670429095#-yrzjaw_57">npm</span> or <span class="control" id="-1670429095#-yrzjaw_58">yarn</span></p></li><li class="list-item" id="-1670429095#-yrzjaw_55"><p>Basic knowledge of <span class="control" id="-1670429095#-yrzjaw_59">TypeScript</span> and <span class="control" id="-1670429095#-yrzjaw_60">Express.js</span></p></li></ul></section><section><h3 id="-1670429095#1-initialize-the-project" data-toc="1-initialize-the-project#EJS-Templating-Engine.md-1-initialize-the-project">1. Initialize the Project</h3><p id="-1670429095#-yrzjaw_61">Create a new directory for your project and initialize it with npm:</p><div class="detached code-block" id="-1670429095#-yrzjaw_62"><pre><code class="language-bash">mkdir express-ejs-email-ts
cd express-ejs-email-ts
npm init -y</code></pre></div></section><section><h3 id="-1670429095#2-install-dependencies" data-toc="2-install-dependencies#EJS-Templating-Engine.md-2-install-dependencies">2. Install Dependencies</h3><p id="-1670429095#-yrzjaw_63">Install the necessary packages:</p><div class="detached code-block" id="-1670429095#-yrzjaw_64"><pre><code class="language-bash">npm install express nodemailer ejs dotenv
npm install --save-dev typescript @types/express @types/node ts-node-dev</code></pre></div><p id="-1670429095#-yrzjaw_65"><span class="control" id="-1670429095#-yrzjaw_69">Dependencies:</span></p><ul class="list" id="-1670429095#-yrzjaw_66" start="1"><li class="list-item" id="-1670429095#-yrzjaw_70"><p><span class="control" id="-1670429095#-yrzjaw_74">express</span>: Web framework for Node.js</p></li><li class="list-item" id="-1670429095#-yrzjaw_71"><p><span class="control" id="-1670429095#-yrzjaw_75">nodemailer</span>: Module to send emails</p></li><li class="list-item" id="-1670429095#-yrzjaw_72"><p><span class="control" id="-1670429095#-yrzjaw_76">ejs</span>: Templating engine</p></li><li class="list-item" id="-1670429095#-yrzjaw_73"><p><span class="control" id="-1670429095#-yrzjaw_77">dotenv</span>: Loads environment variables from a <span class="inline-code" id="-1670429095#-yrzjaw_78">.env</span> file</p></li></ul><p id="-1670429095#-yrzjaw_67"><span class="control" id="-1670429095#-yrzjaw_79">Dev Dependencies:</span></p><ul class="list" id="-1670429095#-yrzjaw_68" start="1"><li class="list-item" id="-1670429095#-yrzjaw_80"><p><span class="control" id="-1670429095#-yrzjaw_82">typescript</span>, <span class="control" id="-1670429095#-yrzjaw_83">ts-node-dev</span>: For TypeScript support</p></li><li class="list-item" id="-1670429095#-yrzjaw_81"><p><span class="control" id="-1670429095#-yrzjaw_84">@types/*</span>: Type definitions for TypeScript</p></li></ul></section><section><h3 id="-1670429095#3-configure-typescript" data-toc="3-configure-typescript#EJS-Templating-Engine.md-3-configure-typescript">3. Configure TypeScript</h3><p id="-1670429095#-yrzjaw_85">Initialize a TypeScript configuration:</p><div class="detached code-block" id="-1670429095#-yrzjaw_86"><pre><code class="language-bash">npx tsc --init</code></pre></div><p id="-1670429095#-yrzjaw_87">Modify the <span class="inline-code" id="-1670429095#-yrzjaw_89">tsconfig.json</span> as needed. A basic configuration might look like this:</p><div class="detached code-block" id="-1670429095#-yrzjaw_88"><pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;ES6&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;outDir&quot;: &quot;./dist&quot;,
    &quot;rootDir&quot;: &quot;./src&quot;,
    &quot;strict&quot;: true,
    &quot;esModuleInterop&quot;: true
  }
}</code></pre></div></section><section><h3 id="-1670429095#4-set-up-project-structure" data-toc="4-set-up-project-structure#EJS-Templating-Engine.md-4-set-up-project-structure">4. Set Up Project Structure</h3><p id="-1670429095#-yrzjaw_90">Create the following structure:</p><div class="detached code-block" id="-1670429095#-yrzjaw_91"><pre><code class="language-none">express-ejs-email-ts/
├── src/
│   ├── templates/
│   │   └── welcomeEmail.ejs
│   ├── index.ts
│   └── email.ts
├── .env
├── package.json
└── tsconfig.json</code></pre></div></section><section><h3 id="-1670429095#5-create-ejs-templates" data-toc="5-create-ejs-templates#EJS-Templating-Engine.md-5-create-ejs-templates">5. Create EJS Templates</h3><p id="-1670429095#-yrzjaw_92">Create an EJS template for the email. For example, <span class="inline-code" id="-1670429095#-yrzjaw_96">src/templates/welcomeEmail.ejs</span>:</p><div class="detached code-block" id="-1670429095#-yrzjaw_93"><pre><code class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;title&gt;Welcome Email&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Welcome, &lt;%= username %&gt;!&lt;/h1&gt;
  &lt;p&gt;Thank you for signing up. We're excited to have you on board.&lt;/p&gt;
  
  &lt;% if (isAdmin) { %&gt;
    &lt;p&gt;You have administrative privileges.&lt;/p&gt;
  &lt;% } else { %&gt;
    &lt;p&gt;You are a regular user.&lt;/p&gt;
  &lt;% } %&gt;
  
  &lt;h2&gt;Your Interests:&lt;/h2&gt;
  &lt;ul&gt;
    &lt;% interests.forEach(function(interest) { %&gt;
      &lt;li&gt;&lt;%= interest %&gt;&lt;/li&gt;
    &lt;% }); %&gt;
  &lt;/ul&gt;
  
  &lt;p&gt;Best regards,&lt;br/&gt;The Team&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div><p id="-1670429095#-yrzjaw_94"><span class="control" id="-1670429095#-yrzjaw_97">Explanation:</span></p><ul class="list" id="-1670429095#-yrzjaw_95" start="1"><li class="list-item" id="-1670429095#-yrzjaw_98"><p><span class="control" id="-1670429095#-yrzjaw_101">Variables:</span> <span class="inline-code" id="-1670429095#-yrzjaw_102">&lt;%= username %&gt;</span> injects the <span class="inline-code" id="-1670429095#-yrzjaw_103">username</span> variable.</p></li><li class="list-item" id="-1670429095#-yrzjaw_99"><p><span class="control" id="-1670429095#-yrzjaw_104">Control Flow:</span> The <span class="inline-code" id="-1670429095#-yrzjaw_105">if</span> statement displays different content based on the <span class="inline-code" id="-1670429095#-yrzjaw_106">isAdmin</span> flag.</p></li><li class="list-item" id="-1670429095#-yrzjaw_100"><p><span class="control" id="-1670429095#-yrzjaw_107">Loop:</span> Iterates over the <span class="inline-code" id="-1670429095#-yrzjaw_108">interests</span> array to list user interests.</p></li></ul></section><section><h3 id="-1670429095#6-configure-express-to-use-ejs" data-toc="6-configure-express-to-use-ejs#EJS-Templating-Engine.md-6-configure-express-to-use-ejs">6. Configure Express to Use EJS</h3><p id="-1670429095#-yrzjaw_109">While EJS is primarily used for rendering HTML pages, we'll leverage it for email templating by rendering EJS templates to HTML strings.</p><p id="-1670429095#-yrzjaw_110">Create <span class="inline-code" id="-1670429095#-yrzjaw_114">src/email.ts</span> to handle email sending logic with EJS templating:</p><div class="detached code-block" id="-1670429095#-yrzjaw_111"><pre><code class="language-javascript">// src/email.ts
import nodemailer from 'nodemailer';
import dotenv from 'dotenv';
import ejs from 'ejs';
import path from 'path';

dotenv.config();

interface EmailOptions {
  to: string;
  subject: string;
  template: string; // Path to the EJS template
  data: any;        // Data to inject into the template
}

export const sendTemplatedEmail = async (options: EmailOptions) =&gt; {
  // Create a transporter
  const transporter = nodemailer.createTransport({
    service: process.env.EMAIL_SERVICE, // e.g., 'Gmail'
    auth: {
      user: process.env.EMAIL_USER,
      pass: process.env.EMAIL_PASS,
    },
  });

  // Resolve the template path
  const templatePath = path.join(__dirname, 'templates', options.template);

  try {
    // Render the EJS template to HTML
    const html = await ejs.renderFile(templatePath, options.data);

    // Define mail options
    const mailOptions = {
      from: process.env.EMAIL_USER,
      to: options.to,
      subject: options.subject,
      html: html,
    };

    // Send the email
    const info = await transporter.sendMail(mailOptions);
    console.log('Email sent:', info.response);
    return info;
  } catch (error) {
    console.error('Error sending email:', error);
    throw error;
  }
};</code></pre></div><p id="-1670429095#-yrzjaw_112"><span class="control" id="-1670429095#-yrzjaw_115">Explanation:</span></p><ul class="list" id="-1670429095#-yrzjaw_113" start="1"><li class="list-item" id="-1670429095#-yrzjaw_116"><p><span class="control" id="-1670429095#-yrzjaw_120">Nodemailer Transporter:</span> Configured using environment variables for service, user, and password.</p></li><li class="list-item" id="-1670429095#-yrzjaw_117"><p><span class="control" id="-1670429095#-yrzjaw_121">EJS Rendering:</span> <span class="inline-code" id="-1670429095#-yrzjaw_122">ejs.renderFile</span> is used to render the specified EJS template with provided data.</p></li><li class="list-item" id="-1670429095#-yrzjaw_118"><p><span class="control" id="-1670429095#-yrzjaw_123">Mail Options:</span> Defines the sender, recipient, subject, and HTML content.</p></li><li class="list-item" id="-1670429095#-yrzjaw_119"><p><span class="control" id="-1670429095#-yrzjaw_124">Sending Email:</span> Uses <span class="inline-code" id="-1670429095#-yrzjaw_125">transporter.sendMail</span> to send the email.</p></li></ul></section><section><h3 id="-1670429095#7-implement-email-sending-with-ejs-templates" data-toc="7-implement-email-sending-with-ejs-templates#EJS-Templating-Engine.md-7-implement-email-sending-with-ejs-templates">7. Implement Email Sending with EJS Templates</h3><p id="-1670429095#-yrzjaw_126">Create <span class="inline-code" id="-1670429095#-yrzjaw_130">src/index.ts</span> to define the Express server and API endpoints for sending templated emails:</p><div class="detached code-block" id="-1670429095#-yrzjaw_127"><pre><code class="language-javascript">// src/index.ts
import express, { Request, Response } from 'express';
import dotenv from 'dotenv';
import { sendTemplatedEmail } from './email';

dotenv.config();

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware to parse JSON
app.use(express.json());

// API Endpoint to send a welcome email
app.post('/send-welcome-email', async (req: Request, res: Response) =&gt; {
  const { to, username, isAdmin, interests } = req.body;

  if (!to || !username || !isAdmin || !interests) {
    return res.status(400).json({ message: 'Missing required fields: to, username, isAdmin, interests' });
  }

  try {
    await sendTemplatedEmail({
      to,
      subject: 'Welcome to Our Service!',
      template: 'welcomeEmail.ejs',
      data: { username, isAdmin, interests },
    });
    res.status(200).json({ message: 'Welcome email sent successfully.' });
  } catch (error) {
    res.status(500).json({ message: 'Failed to send welcome email.', error });
  }
});

// API Endpoint to check server status
app.get('/', (req: Request, res: Response) =&gt; {
  res.send('EJS Email Service is running.');
});

// Handle graceful shutdown
const shutdown = () =&gt; {
  console.log('Shutting down server...');
  process.exit(0);
};

process.on('SIGINT', shutdown);
process.on('SIGTERM', shutdown);

// Start the Express server
app.listen(PORT, () =&gt; {
  console.log(`Server is running on port ${PORT}`);
});</code></pre></div><p id="-1670429095#-yrzjaw_128"><span class="control" id="-1670429095#-yrzjaw_131">Explanation:</span></p><ul class="list" id="-1670429095#-yrzjaw_129" start="1"><li class="list-item" id="-1670429095#-yrzjaw_132"><p><span class="control" id="-1670429095#-yrzjaw_135">POST <span class="inline-code" id="-1670429095#-yrzjaw_137">/send-welcome-email</span>:</span> Accepts JSON data to send a welcome email using the <span class="inline-code" id="-1670429095#-yrzjaw_136">welcomeEmail.ejs</span> template.</p></li><li class="list-item" id="-1670429095#-yrzjaw_133"><p><span class="control" id="-1670429095#-yrzjaw_138">GET <span class="inline-code" id="-1670429095#-yrzjaw_139">/</span>:</span> Simple endpoint to verify that the server is running.</p></li><li class="list-item" id="-1670429095#-yrzjaw_134"><p><span class="control" id="-1670429095#-yrzjaw_140">Graceful Shutdown:</span> Ensures the server exits cleanly on termination signals.</p></li></ul></section><section><h3 id="-1670429095#8-update-package-json-scripts" data-toc="8-update-package-json-scripts#EJS-Templating-Engine.md-8-update-package-json-scripts">8. Update package.json Scripts</h3><p id="-1670429095#-yrzjaw_142">Add a script to run the server with <span class="inline-code" id="-1670429095#-yrzjaw_145">ts-node-dev</span> for hot-reloading:</p><div class="detached code-block" id="-1670429095#-yrzjaw_143"><pre><code class="language-json">&quot;scripts&quot;: {
  &quot;start&quot;: &quot;ts-node-dev src/index.ts&quot;
}</code></pre></div></section><section><h3 id="-1670429095#9-running-the-application" data-toc="9-running-the-application#EJS-Templating-Engine.md-9-running-the-application">9. Running the Application</h3><section><h4 id="-1670429095#1-configure-environment-variables" data-toc="1-configure-environment-variables#EJS-Templating-Engine.md-1-configure-environment-variables">1. Configure Environment Variables</h4><p id="-1670429095#-yrzjaw_149">Create a <span class="inline-code" id="-1670429095#-yrzjaw_153">.env</span> file in the root directory to store sensitive information and configuration variables:</p><div class="detached code-block" id="-1670429095#-yrzjaw_150"><pre><code class="language-bash">PORT=3000
EMAIL_SERVICE=Gmail
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-email-password</code></pre></div><p id="-1670429095#-yrzjaw_151"><span class="control" id="-1670429095#-yrzjaw_154">Important:</span></p><ul class="list" id="-1670429095#-yrzjaw_152" start="1"><li class="list-item" id="-1670429095#-yrzjaw_155"><p>Replace <span class="inline-code" id="-1670429095#-yrzjaw_157">your-email@gmail.com</span> and <span class="inline-code" id="-1670429095#-yrzjaw_158">your-email-password</span> with your actual email credentials.</p></li><li class="list-item" id="-1670429095#-yrzjaw_156"><p>For Gmail, you might need to enable Less Secure Apps (<a href="https://myaccount.google.com/lesssecureapps">https://myaccount.google.com/lesssecureapps</a>) or use App Passwords (<a href="https://support.google.com/accounts/answer/185833">https://support.google.com/accounts/answer/185833</a>).</p></li></ul></section><section><h4 id="-1670429095#2-start-the-server" data-toc="2-start-the-server#EJS-Templating-Engine.md-2-start-the-server">2. Start the Server</h4><div class="detached code-block" id="-1670429095#-yrzjaw_161"><pre><code class="language-bash">npm start</code></pre></div><p id="-1670429095#-yrzjaw_162">You should see output similar to:</p><div class="detached code-block" id="-1670429095#-yrzjaw_163"><pre><code class="language-none">Server is running on port 3000</code></pre></div></section><section><h4 id="-1670429095#3-send-a-test-welcome-email" data-toc="3-send-a-test-welcome-email#EJS-Templating-Engine.md-3-send-a-test-welcome-email">3. Send a Test Welcome Email</h4><p id="-1670429095#-yrzjaw_164">Use a tool like Postman (<a href="https://www.postman.com/">https://www.postman.com/</a>) or <span class="inline-code" id="-1670429095#-yrzjaw_172">curl</span> to send a POST request to <span class="inline-code" id="-1670429095#-yrzjaw_173">http://localhost:3000/send-welcome-email</span> with a JSON body:</p><div class="detached code-block" id="-1670429095#-yrzjaw_165"><pre><code class="language-json">{
  &quot;to&quot;: &quot;recipient@example.com&quot;,
  &quot;username&quot;: &quot;JohnDoe&quot;,
  &quot;isAdmin&quot;: true,
  &quot;interests&quot;: [&quot;Coding&quot;, &quot;Reading&quot;, &quot;Gaming&quot;]
}</code></pre></div><p id="-1670429095#-yrzjaw_166"><span class="control" id="-1670429095#-yrzjaw_174">Using <span class="inline-code" id="-1670429095#-yrzjaw_175">curl</span>:</span></p><div class="detached code-block" id="-1670429095#-yrzjaw_167"><pre><code class="language-bash">curl -X POST http://localhost:3000/send-welcome-email \
  -H &quot;Content-Type: application/json&quot; \
  -d '{
    &quot;to&quot;: &quot;recipient@example.com&quot;,
    &quot;username&quot;: &quot;JohnDoe&quot;,
    &quot;isAdmin&quot;: true,
    &quot;interests&quot;: [&quot;Coding&quot;, &quot;Reading&quot;, &quot;Gaming&quot;]
  }'</code></pre></div><p id="-1670429095#-yrzjaw_168"><span class="control" id="-1670429095#-yrzjaw_176">Expected Response:</span></p><div class="detached code-block" id="-1670429095#-yrzjaw_169"><pre><code class="language-json">{
  &quot;message&quot;: &quot;Welcome email sent successfully.&quot;
}</code></pre></div><p id="-1670429095#-yrzjaw_170">Check the recipient's inbox to verify that the email was received with the rendered EJS template.</p></section></section></section></article></div></section></div></body></html>